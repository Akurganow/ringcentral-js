!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("es6-promise"),require("node-fetch"),require("pubnub")):"function"==typeof define&&define.amd?define([,,"pubnub"],t):"object"==typeof exports?exports.SDK=t(require("es6-promise"),require("node-fetch"),require("pubnub")):(e.RingCentral=e.RingCentral||{},e.RingCentral.SDK=t(e[void 0],e[void 0],e[void 0]))}(this,function(e,t,r){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="/build/",t(0)}([function(e,t,r){r(1),e.exports=r(2)},function(e,t){(function(t){!function(t){"use strict";function r(e,t,r,n){var o=Object.create((t||i).prototype),s=new p(n||[]);return o._invoke=f(e,r,s),o}function n(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(n){return{type:"throw",arg:n}}}function i(){}function o(){}function s(){}function u(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function a(e){this.arg=e}function c(e){function t(t,r){var n=e[t](r),s=n.value;return s instanceof a?Promise.resolve(s.arg).then(i,o):Promise.resolve(s).then(function(e){return n.value=e,n})}function r(e,r){function i(){return t(e,r)}return n=n?n.then(i,i):new Promise(function(e){e(i())})}"object"==typeof process&&process.domain&&(t=process.domain.bind(t));var n,i=t.bind(e,"next"),o=t.bind(e,"throw");t.bind(e,"return");this._invoke=r}function f(e,t,r){var i=g;return function(o,s){if(i===x)throw new Error("Generator is already running");if(i===E){if("throw"===o)throw s;return v()}for(;;){var u=r.delegate;if(u){if("return"===o||"throw"===o&&u.iterator[o]===y){r.delegate=null;var a=u.iterator["return"];if(a){var c=n(a,u.iterator,s);if("throw"===c.type){o="throw",s=c.arg;continue}}if("return"===o)continue}var c=n(u.iterator[o],u.iterator,s);if("throw"===c.type){r.delegate=null,o="throw",s=c.arg;continue}o="next",s=y;var f=c.arg;if(!f.done)return i=k,f;r[u.resultName]=f.value,r.next=u.nextLoc,r.delegate=null}if("next"===o)r._sent=s,i===k?r.sent=s:r.sent=y;else if("throw"===o){if(i===g)throw i=E,s;r.dispatchException(s)&&(o="next",s=y)}else"return"===o&&r.abrupt("return",s);i=x;var c=n(e,t,r);if("normal"===c.type){i=r.done?E:k;var f={value:c.arg,done:r.done};if(c.arg!==O)return f;r.delegate&&"next"===o&&(s=y)}else"throw"===c.type&&(i=E,o="throw",s=c.arg)}}}function l(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function h(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(l,this),this.reset(!0)}function d(e){if(e){var t=e[b];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function i(){for(;++r<e.length;)if(_.call(e,r))return i.value=e[r],i.done=!1,i;return i.value=y,i.done=!0,i};return n.next=n}}return{next:v}}function v(){return{value:y,done:!0}}var y,_=Object.prototype.hasOwnProperty,b="function"==typeof Symbol&&Symbol.iterator||"@@iterator",m="object"==typeof e,w=t.regeneratorRuntime;if(w)return void(m&&(e.exports=w));w=t.regeneratorRuntime=m?e.exports:{},w.wrap=r;var g="suspendedStart",k="suspendedYield",x="executing",E="completed",O={},T=s.prototype=i.prototype;o.prototype=T.constructor=s,s.constructor=o,o.displayName="GeneratorFunction",w.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return t?t===o||"GeneratorFunction"===(t.displayName||t.name):!1},w.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):e.__proto__=s,e.prototype=Object.create(T),e},w.awrap=function(e){return new a(e)},u(c.prototype),w.async=function(e,t,n,i){var o=new c(r(e,t,n,i));return w.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},u(T),T[b]=function(){return this},T.toString=function(){return"[object Generator]"},w.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},w.values=d,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=y,this.done=!1,this.delegate=null,this.tryEntries.forEach(h),!e)for(var t in this)"t"===t.charAt(0)&&_.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=y)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,n){return o.type="throw",o.arg=e,r.next=t,!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var s=_.call(i,"catchLoc"),u=_.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&_.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?this.next=i.finallyLoc:this.complete(o),O},complete:function(e,t){if("throw"===e.type)throw e.arg;"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=e.arg,this.next="end"):"normal"===e.type&&t&&(this.next=t)},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),h(r),O}},"catch":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;h(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:d(e),resultName:t,nextLoc:r},O}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this)}).call(t,function(){return this}())},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var u=r(3),a=i(u),c=r(8),f=n(c),l=r(4),h=i(l),p=r(9),d=n(p),v=r(10),y=n(v),_=r(11),b=n(_),m=r(13),w=n(m),g=r(12),k=i(g),x=r(14),E=n(x),O=r(16),T=n(O),R=r(15),P=n(R),S=r(17),j=n(S),C=r(18),q=n(C),M=r(19),F=n(M),L=r(21),I=n(L),A=r(22),N=n(A),U=function(){function e(t){o(this,e),t=t||{},this._cache=new f["default"](h.localStorage,t.cachePrefix),this._client=t.client||new b["default"],this._platform=new j["default"](this._client,this._cache,t.server,t.appKey,t.appSecret),this._pubnubFactory=t.pubnubFactory||h.PUBNUB}return s(e,[{key:"platform",value:function(){return this._platform}},{key:"createSubscription",value:function(){return new I["default"](this._pubnubFactory,this._platform)}},{key:"createCachedSubscription",value:function(e){return new N["default"](this._pubnubFactory,this._platform,this._cache,e)}},{key:"cache",value:function(){return this._cache}}]),e}();U.version="2.0.1",U.server={sandbox:"https://platform.devtest.ringcentral.com",production:"https://platform.ringcentral.com"},U.core={Cache:f["default"],Observable:d["default"],Utils:a,Externals:h,Queue:y["default"]},U.http={Client:b["default"],ApiResponse:w["default"],Utils:k},U.platform={Auth:q["default"],Platform:j["default"]},U.subscription={Subscription:I["default"]},U.mocks={Client:E["default"],Registry:P["default"],Mock:T["default"]},U.pubnub={PubnubMockFactory:F["default"]},t["default"]=U},function(e,t,r){"use strict";function n(e){var t=[];return e=e||{},Object.keys(e).forEach(function(r){var n=e[r];s(n)?n.forEach(function(e){t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n))}),t.join("&")}function i(e){var t={};return e.split("&").forEach(function(e){if(e=decodeURIComponent(e),-1==e.indexOf("="))t[e.trim()]=!0;else{var r=e.split("="),n=r[0].trim(),i=r[1].trim();n in t?(n in t&&!s(t[n])&&(t[n]=[t[n]]),t[n].push(i)):t[n]=i}}),t}function o(e){return"function"==typeof e}function s(e){return Array.isArray?Array.isArray(e):"array"==typeof e}function u(t,r,n){e.exports.stopPolling(n),r=r||1e3;var i=function o(e){return e=e||r,r=e,setTimeout(function(){t(o,e)},e)};return i()}function a(e){e&&clearTimeout(e)}function c(){return"undefined"!=typeof process}function f(){return"undefined"!=typeof window}function l(e){return new h.Promise(function(t,r){setTimeout(function(){t(null)},e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.queryStringify=n,t.parseQueryString=i,t.isFunction=o,t.isArray=s,t.poll=u,t.stopPolling=a,t.isNodeJS=c,t.isBrowser=f,t.delay=l;var h=r(4)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.localStorage=t.PUBNUB=t.Headers=t.Response=t.Request=t.fetch=t.Promise=void 0;var i=r(5),o=n(i),s=r(6),u=n(s),a=r(7),c=n(a),f=new Function("return this")(),l=(t.Promise=o["default"]&&o["default"].Promise||f.Promise,t.fetch=f.fetch||u["default"]);t.Request=f.Request||l.Request,t.Response=f.Response||l.Response,t.Headers=f.Headers||l.Headers,t.PUBNUB=f.PUBNUB||c["default"],t.localStorage="undefined"!=typeof f.localStorage?f.localStorage:{}},function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t,n){r(this,e),this.setPrefix(n),this._storage=t}return n(e,[{key:"setPrefix",value:function(t){return this._prefix=t||e.defaultPrefix,this}},{key:"setItem",value:function(e,t){return this._storage[this._prefixKey(e)]=JSON.stringify(t),this}},{key:"removeItem",value:function(e){return delete this._storage[this._prefixKey(e)],this}},{key:"getItem",value:function(e){var t=this._storage[this._prefixKey(e)];return t?JSON.parse(t):null}},{key:"clean",value:function(){for(var e in this._storage)this._storage.hasOwnProperty(e)&&0===e.indexOf(this._prefix)&&delete this._storage[e];return this}},{key:"_prefixKey",value:function(e){return this._prefix+e}}]),e}();i.defaultPrefix="rc-",t["default"]=i},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){r(this,e),this.off()}return n(e,[{key:"hasListeners",value:function(e){return e in this._listeners}},{key:"on",value:function(e,t){var r=this;if("string"==typeof e&&(e=[e]),!e)throw new Error("No events to subscribe to");if("function"!=typeof t)throw new Error("Callback must be a function");return e.forEach(function(e){r.hasListeners(e)||(r._listeners[e]=[]),r._listeners[e].push(t)}),this}},{key:"emit",value:function(e){for(var t=this,r=arguments.length,n=Array(r>1?r-1:0),i=1;r>i;i++)n[i-1]=arguments[i];var o=null;return this.hasListeners(e)?(this._listeners[e].some(function(e){return o=e.apply(t,n),o===!1}),o):null}},{key:"off",value:function(e,t){var r=this;if(e)if(t){if(!this.hasListeners(e))return this;this._listeners[e].forEach(function(n,i){n===t&&delete r._listeners[e][i]})}else delete this._listeners[e];else this._listeners={};return this}}]),e}();t["default"]=i},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(4),s=r(3),u=function(){function e(t,r){n(this,e),this._cache=t,this._cacheId=r,this._promise=null}return i(e,[{key:"isPaused",value:function(){var t=this._cache.getItem(this._cacheId);return!!t&&Date.now()-parseInt(t)<e._releaseTimeout}},{key:"pause",value:function(){return this._cache.setItem(this._cacheId,Date.now()),this}},{key:"resume",value:function(){return this._cache.removeItem(this._cacheId),this}},{key:"poll",value:function(){var t=this;return this._promise?this._promise:(this._promise=new o.Promise(function(r,n){(0,s.poll)(function(e){return t.isPaused()?e():(t._promise=null,t.resume(),void r(null))},e._pollInterval)}),this._promise)}}]),e}();u._pollInterval=250,u._releaseTimeout=5e3,t["default"]=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return function(){var t=e.apply(this,arguments);return new c.Promise(function(e,r){function n(i,o){try{var s=t[i](o),u=s.value}catch(a){return void r(a)}s.done?e(u):c.Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}n("next")})}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var c=r(4),f=r(3),l=r(12),h=r(9),p=n(h),d=r(13),v=n(d),y=function(e){function t(){var e,r,n,i;o(this,t);for(var u=arguments.length,a=Array(u),c=0;u>c;c++)a[c]=arguments[c];return r=n=s(this,(e=Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),n.events={beforeRequest:"beforeRequest",requestSuccess:"requestSuccess",requestError:"requestError"},i=r,s(n,i)}return u(t,e),a(t,[{key:"sendRequest",value:function(){var e=i(regeneratorRuntime.mark(function t(e){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=new v["default"](e),t.prev=1,this.emit(this.events.beforeRequest,r),t.next=5,this._loadResponse(e);case 5:if(r._response=t.sent,!r._isMultipart()&&!r._isJson()){t.next=10;break}return t.next=9,r.response().text();case 9:r._text=t.sent;case 10:if(r.ok()){t.next=12;break}throw new Error("Response has unsuccessful status");case 12:return this.emit(this.events.requestSuccess,r),t.abrupt("return",r);case 16:throw t.prev=16,t.t0=t["catch"](1),t.t0.apiResponse||(t.t0=this.makeError(t.t0,r)),this.emit(this.events.requestError,t.t0),t.t0;case 21:case"end":return t.stop()}},t,this,[[1,16]])}));return function(t){return e.apply(this,arguments)}}()},{key:"_loadResponse",value:function(){var e=i(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.fetch.call(null,e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"makeError",value:function(e,t){return e.hasOwnProperty("apiResponse")||e.hasOwnProperty("originalMessage")||(e.apiResponse=t,e.originalMessage=e.message,e.message=t&&t.error(!0)||e.originalMessage),e}},{key:"createRequest",value:function(e){if(e=e||{},e.headers=e.headers||{},!e.url)throw new Error("Url is not defined");if(e.method||(e.method="GET"),e.method&&t._allowedMethods.indexOf(e.method)<0)throw new Error("Method has wrong value: "+e.method);if(e.credentials=e.credentials||"include",e.mode=e.mode||"cors",e.query&&(e.url=e.url+(e.url.indexOf("?")>-1?"&":"?")+(0,f.queryStringify)(e.query)),(0,l.findHeaderName)("Accept",e.headers)||(e.headers.Accept=v["default"]._jsonContentType),"string"!=typeof e.body||!e.body){var r=(0,l.findHeaderName)(v["default"]._contentType,e.headers);r||(r=v["default"]._contentType,e.headers[r]=v["default"]._jsonContentType);var n=e.headers[r];n.indexOf(v["default"]._jsonContentType)>-1?e.body=JSON.stringify(e.body):n.indexOf(v["default"]._urlencodedContentType)>-1&&(e.body=(0,f.queryStringify)(e.body))}var i=new c.Request(e.url,e);return i.originalBody=e.body,i}}]),t}(p["default"]);y._allowedMethods=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"],t["default"]=y},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e,t){t=t||{};var r=new s.Response(e,t);return a.isNodeJS()&&(r._text=e,r._decode=function(){return this._text}),r}function o(e,t){return e=e.toLowerCase(),Object.keys(t).reduce(function(t,r){return t?t:e==r.toLowerCase()?r:t},null)}Object.defineProperty(t,"__esModule",{value:!0}),t.createResponse=i,t.findHeaderName=o;var s=r(4),u=r(3),a=n(u)},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var s=r(4),u=r(12),a=n(u),c=function(){function e(t,r,n){i(this,e),this._request=t,this._response=r,this._text=n,this._json=null,this._multipart=[]}return o(e,[{key:"response",value:function(){return this._response}},{key:"request",value:function(){return this._request}},{key:"ok",value:function(){return this._response&&this._response.ok}},{key:"text",value:function(){if(!this._isJson()&&!this._isMultipart())throw new Error("Response is not text");return this._text}},{key:"json",value:function(){if(!this._isJson())throw new Error("Response is not JSON");return this._json||(this._json=this._text?JSON.parse(this._text):null),this._json}},{key:"error",value:function(e){if(this.ok()&&!e)return null;var t=(this._response&&this._response.status?this._response.status+" ":"")+(this._response&&this._response.statusText?this._response.statusText:"");try{this.json().message&&(t=this.json().message),this.json().error_description&&(t=this.json().error_description),this.json().description&&(t=this.json().description)}catch(r){}return t}},{key:"multipart",value:function(){if(!this._isMultipart())throw new Error("Response is not multipart");if(!this._multipart.length){var t=this.text();if(!t)throw new Error("No response body");var r=this._getContentType().match(/boundary=([^;]+)/i)[1];if(!r)throw new Error("Cannot find boundary");var n=t.toString().split(e._boundarySeparator+r);if(""===n[0].trim()&&n.shift(),n[n.length-1].trim()==e._boundarySeparator&&n.pop(),n.length<1)throw new Error("No parts in body");var i=e.create(n.shift(),this._response.status,this._response.statusText).json();this._multipart=n.map(function(t,r){var n=i.response[r].status;return e.create(t,n)})}return this._multipart}},{key:"_isContentType",value:function(e){return this._getContentType().indexOf(e)>-1}},{key:"_getContentType",value:function(){return this._response.headers.get(e._contentType)||""}},{key:"_isMultipart",value:function(){return this._isContentType(e._multipartContentType)}},{key:"_isUrlEncoded",value:function(){return this._isContentType(e._urlencodedContentType)}},{key:"_isJson",value:function(){return this._isContentType(e._jsonContentType)}}],[{key:"create",value:function(t,r,n){t=t||"",r=r||200,n=n||"OK",t=t.replace(/\r/g,"");var i=new s.Headers,o=t.split(e._bodySeparator),u=o.length>1?o.shift():"";return t=o.join(e._bodySeparator),(u||"").split("\n").forEach(function(t){var r=t.trim().split(e._headerSeparator),n=r.shift().trim(),o=r.join(e._headerSeparator).trim();n&&i.append(n,o)}),new e(null,a.createResponse(t,{headers:i,status:r,statusText:n}),t)}}]),e}();c._contentType="Content-Type",c._jsonContentType="application/json",c._multipartContentType="multipart/mixed",c._urlencodedContentType="application/x-www-form-urlencoded",c._headerSeparator=":",c._bodySeparator="\n\n",c._boundarySeparator="--",t["default"]=c},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var s=t[i](o),u=s.value}catch(a){return void r(a)}s.done?e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}n("next")})}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var c=r(15),f=n(c),l=r(11),h=n(l),p=function(e){function t(){o(this,t);var e=s(this,Object.getPrototypeOf(t).call(this));return e._registry=new f["default"],e}return u(t,e),a(t,[{key:"registry",value:function(){return this._registry}},{key:"_loadResponse",value:function(){var e=i(regeneratorRuntime.mark(function t(e){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._registry.find(e),t.next=3,r.getResponse(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(h["default"]);t["default"]=p},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var s=r(16),u=n(s),a=function(){function e(){i(this,e),this._mocks=[]}return o(e,[{key:"add",value:function(e){return this._mocks.push(e),this}},{key:"clear",value:function(){return this._mocks=[],this}},{key:"find",value:function(e){var t=this._mocks.shift();if(!t)throw new Error("No mock in registry for request "+e.method+" "+e.url);if(!t.test(e))throw new Error("Wrong request "+e.method+" "+e.url+" for expected mock "+t.method()+" "+t.path());return t}},{key:"apiCall",value:function(e,t,r,n,i){return this.add(new u["default"](e,t,r,n,i)),this}},{key:"authentication",value:function(){return this.apiCall("POST","/restapi/oauth/token",{access_token:"ACCESS_TOKEN",token_type:"bearer",expires_in:3600,refresh_token:"REFRESH_TOKEN",refresh_token_expires_in:60480,scope:"SMS RCM Foo Boo",expireTime:(new Date).getTime()+36e5}),this}},{key:"logout",value:function(){return this.apiCall("POST","/restapi/oauth/revoke",{}),this}},{key:"presenceLoad",value:function(e){return this.apiCall("GET","/restapi/v1.0/account/~/extension/"+e+"/presence",{uri:"https://platform.ringcentral.com/restapi/v1.0/account/123/extension/"+e+"/presence",extension:{uri:"https://platform.ringcentral.com/restapi/v1.0/account/123/extension/"+e,id:e,extensionNumber:"101"},activeCalls:[],presenceStatus:"Available",telephonyStatus:"Ringing",userStatus:"Available",dndStatus:"TakeAllCalls",extensionId:e}),this}},{key:"subscribeGeneric",value:function(e){e=e||54e3;var t=new Date;return this.apiCall("POST","/restapi/v1.0/subscription",{eventFilters:["/restapi/v1.0/account/~/extension/~/presence"],expirationTime:new Date(t.getTime()+1e3*e).toISOString(),expiresIn:e,deliveryMode:{transportType:"PubNub",encryption:!1,address:"123_foo",subscriberKey:"sub-c-foo",secretKey:"sec-c-bar"},id:"foo-bar-baz",creationTime:t.toISOString(),status:"Active",uri:"https://platform.ringcentral.com/restapi/v1.0/subscription/foo-bar-baz"}),this}},{key:"subscribeOnPresence",value:function(e,t){e=e||"1";var r=new Date;return this.apiCall("POST","/restapi/v1.0/subscription",{eventFilters:["/restapi/v1.0/account/~/extension/"+e+"/presence"+(t?"?detailedTelephonyState=true":"")],expirationTime:new Date(r.getTime()+54e6).toISOString(),deliveryMode:{transportType:"PubNub",encryption:!0,address:"123_foo",subscriberKey:"sub-c-foo",secretKey:"sec-c-bar",encryptionAlgorithm:"AES",encryptionKey:"VQwb6EVNcQPBhE/JgFZ2zw=="},creationTime:r.toISOString(),id:"foo-bar-baz",status:"Active",uri:"https://platform.ringcentral.com/restapi/v1.0/subscription/foo-bar-baz"}),this}},{key:"tokenRefresh",value:function(e){return e?this.apiCall("POST","/restapi/oauth/token",{message:"Wrong token",error_description:"Wrong token",description:"Wrong token"},400):this.apiCall("POST","/restapi/oauth/token",{access_token:"ACCESS_TOKEN_FROM_REFRESH",token_type:"bearer",expires_in:3600,refresh_token:"REFRESH_TOKEN_FROM_REFRESH",refresh_token_expires_in:60480,scope:"SMS RCM Foo Boo"}),this}}]),e}();t["default"]=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var s=t[i](o),u=s.value}catch(a){return void r(a)}s.done?e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}n("next")})}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var u=r(13),a=n(u),c=r(3),f=r(12),l=function(){function e(t,r,n,i,s,u){o(this,e),this._method=t.toUpperCase(),this._path=r,this._json=n||{},this._delay=u||10,this._status=i||200,this._statusText=s||"OK"}return s(e,[{key:"path",value:function(){return this._path}},{key:"method",value:function(){return this._method}},{key:"test",value:function(e){return e.url.indexOf(this._path)>-1&&e.method.toUpperCase()==this._method}},{key:"getResponse",value:function(){var e=i(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.delay)(this._delay);case 2:return e.abrupt("return",this.createResponse(this._json));case 3:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createResponse",value:function(e,t){t=t||{},t.status=t.status||this._status,t.statusText=t.statusText||this._statusText;var r=JSON.stringify(e),n=(0,f.createResponse)(r,t);return n.headers.set(a["default"]._contentType,a["default"]._jsonContentType),n}}]),e}();t["default"]=l},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return function(){var t=e.apply(this,arguments);return new v.Promise(function(e,r){function n(i,o){try{var s=t[i](o),u=s.value}catch(a){return void r(a)}s.done?e(u):v.Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}n("next")})}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var c=r(9),f=n(c),l=r(10),h=n(l),p=r(18),d=n(p),v=r(4),y=r(3),_=function(e){function t(e,r,n,i,u){o(this,t);var a=s(this,Object.getPrototypeOf(t).call(this));return a.events={beforeLogin:"beforeLogin",loginSuccess:"loginSuccess",loginError:"loginError",beforeRefresh:"beforeRefresh",refreshSuccess:"refreshSuccess",refreshError:"refreshError",beforeLogout:"beforeLogout",logoutSuccess:"logoutSuccess",logoutError:"logoutError"},a._server=n,a._appKey=i,a._appSecret=u,a._cache=r,a._client=e,a._queue=new h["default"](a._cache,t._cacheId+"-refresh"),a._auth=new d["default"](a._cache,t._cacheId),a}return u(t,e),a(t,[{key:"auth",value:function(){return this._auth}},{key:"client",value:function(){return this._client}},{key:"createUrl",value:function(e,r){e=e||"",r=r||{};var n="",i=-1!=e.indexOf("http://")||-1!=e.indexOf("https://");return r.addServer&&!i&&(n+=this._server),-1!=e.indexOf(t._urlPrefix)||i||(n+=t._urlPrefix+"/"+t._apiVersion),n+=e,(r.addMethod||r.addToken)&&(n+=e.indexOf("?")>-1?"&":"?"),r.addMethod&&(n+="_method="+r.addMethod),r.addToken&&(n+=(r.addMethod?"&":"")+"access_token="+this._auth.accessToken()),n}},{key:"authUrl",value:function(e){return e=e||{},this.createUrl(t._authorizeEndpoint+"?"+(0,y.queryStringify)({response_type:"code",redirect_uri:e.redirectUri||"",client_id:this._appKey,state:e.state||"",brand_id:e.brandId||"",display:e.display||"",prompt:e.prompt||""}),{addServer:!0})}},{key:"parseAuthRedirectUrl",value:function(e){var t=(0,y.parseQueryString)(e.split("?").reverse()[0]),r=t.error_description||t.error;if(r){var n=new Error(r);throw n.error=t.error,n}return t}},{key:"loggedIn",value:function(){var e=i(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._ensureAuthentication();case 3:return e.abrupt("return",!0);case 6:return e.prev=6,e.t0=e["catch"](0),e.abrupt("return",!1);case 9:case"end":return e.stop()}},t,this,[[0,6]])}));return function(){return e.apply(this,arguments);
}}()},{key:"login",value:function(){var e=i(regeneratorRuntime.mark(function r(e){var n,i,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,e=e||{},e.remember=e.remember||!1,this.emit(this.events.beforeLogin),n={access_token_ttl:t._accessTokenTtl,refresh_token_ttl:e.remember?t._refreshTokenTtlRemember:t._refreshTokenTtl},e.code?e.code&&(n.grant_type="authorization_code",n.code=e.code,n.redirect_uri=e.redirectUri):(n.grant_type="password",n.username=e.username,n.password=e.password,n.extension=e.extension||""),e.endpointId&&(n.endpoint_id=e.endpointId),r.next=9,this._tokenRequest(t._tokenEndpoint,n);case 9:return i=r.sent,o=i.json(),this._auth.setData(o).setRemember(e.remember),this.emit(this.events.loginSuccess,i),r.abrupt("return",i);case 16:throw r.prev=16,r.t0=r["catch"](0),this._cache.clean(),this.emit(this.events.loginError,r.t0),r.t0;case 21:case"end":return r.stop()}},r,this,[[0,16]])}));return function(t){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){var e=i(regeneratorRuntime.mark(function r(){var e,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,this.emit(this.events.beforeRefresh),!this._queue.isPaused()){r.next=9;break}return r.next=5,this._queue.poll();case 5:if(this._isAccessTokenValid()){r.next=7;break}throw new Error("Automatic authentification timeout");case 7:return this.emit(this.events.refreshSuccess,null),r.abrupt("return",null);case 9:return this._queue.pause(),r.next=12,(0,y.delay)(t._refreshDelayMs);case 12:if(this._auth.refreshToken()){r.next=14;break}throw new Error("Refresh token is missing");case 14:if(this._auth.refreshTokenValid()){r.next=16;break}throw new Error("Refresh token has expired");case 16:if(this._queue.isPaused()){r.next=18;break}throw new Error("Queue was resumed before refresh call");case 18:return r.next=20,this._tokenRequest(t._tokenEndpoint,{grant_type:"refresh_token",refresh_token:this._auth.refreshToken(),access_token_ttl:t._accessTokenTtl,refresh_token_ttl:this._auth.remember()?t._refreshTokenTtlRemember:t._refreshTokenTtl});case 20:if(e=r.sent,n=e.json(),n.access_token){r.next=24;break}throw this._client.makeError(new Error("Malformed OAuth response"),e);case 24:return this._auth.setData(n),this._queue.resume(),this.emit(this.events.refreshSuccess,e),r.abrupt("return",e);case 30:throw r.prev=30,r.t0=r["catch"](0),r.t0=this._client.makeError(r.t0),t._clearCacheOnRefreshError&&this._cache.clean(),this.emit(this.events.refreshError,r.t0),r.t0;case 36:case"end":return r.stop()}},r,this,[[0,30]])}));return function(){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=i(regeneratorRuntime.mark(function r(){var e;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,this.emit(this.events.beforeLogout),this._queue.pause(),r.next=5,this._tokenRequest(t._revokeEndpoint,{token:this._auth.accessToken()});case 5:return e=r.sent,this._queue.resume(),this._cache.clean(),this.emit(this.events.logoutSuccess,e),r.abrupt("return",e);case 12:throw r.prev=12,r.t0=r["catch"](0),this._queue.resume(),this.emit(this.events.logoutError,r.t0),r.t0;case 17:case"end":return r.stop()}},r,this,[[0,12]])}));return function(){return e.apply(this,arguments)}}()},{key:"inflateRequest",value:function(){var e=i(regeneratorRuntime.mark(function t(e,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=r||{},!r.skipAuthCheck){t.next=3;break}return t.abrupt("return",e);case 3:return t.next=5,this._ensureAuthentication();case 5:return e.headers.set("Authorization",this._authHeader()),t.abrupt("return",e);case 7:case"end":return t.stop()}},t,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"sendRequest",value:function(){var e=i(regeneratorRuntime.mark(function t(e,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.inflateRequest(e,r);case 3:return e=t.sent,t.next=6,this._client.sendRequest(e);case 6:return t.abrupt("return",t.sent);case 9:if(t.prev=9,t.t0=t["catch"](0),t.t0.apiResponse&&t.t0.apiResponse.response()&&401==t.t0.apiResponse.response().status){t.next=13;break}throw t.t0;case 13:return this._auth.cancelAccessToken(),t.next=16,this.sendRequest(e,r);case 16:return t.abrupt("return",t.sent);case 17:case"end":return t.stop()}},t,this,[[0,9]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=i(regeneratorRuntime.mark(function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.url=this.createUrl(e.url,{addServer:!0}),t.next=3,this.sendRequest(this._client.createRequest(e),e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=i(regeneratorRuntime.mark(function t(e,r,n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=n||{},n.method="GET",n.url=e,n.query=r,t.next=6,this.send(n);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}},t,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"post",value:function(){var e=i(regeneratorRuntime.mark(function t(e,r,n,i){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=i||{},i.method="POST",i.url=e,i.query=n,i.body=r,t.next=7,this.send(i);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)}));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"put",value:function(){var e=i(regeneratorRuntime.mark(function t(e,r,n,i){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=i||{},i.method="PUT",i.url=e,i.query=n,i.body=r,t.next=7,this.send(i);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)}));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=i(regeneratorRuntime.mark(function t(e,r,n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=n||{},n.method="DELETE",n.url=e,n.query=r,t.next=6,this.send(n);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}},t,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_tokenRequest",value:function(){var e=i(regeneratorRuntime.mark(function t(e,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.send({url:e,skipAuthCheck:!0,body:r,method:"POST",headers:{Authorization:"Basic "+this._apiKey(),"Content-Type":"application/x-www-form-urlencoded"}});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_ensureAuthentication",value:function(){var e=i(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isAccessTokenValid()){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.refresh();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_isAccessTokenValid",value:function(){return this._auth.accessTokenValid()&&!this._queue.isPaused()}},{key:"_apiKey",value:function(){var e=this._appKey+":"+this._appSecret;return"function"==typeof btoa?btoa(e):new Buffer(e).toString("base64")}},{key:"_authHeader",value:function(){var e=this._auth.accessToken();return this._auth.tokenType()+(e?" "+e:"")}}]),t}(f["default"]);_._urlPrefix="/restapi",_._apiVersion="v1.0",_._accessTokenTtl=null,_._refreshTokenTtl=36e3,_._refreshTokenTtlRemember=604800,_._tokenEndpoint="/restapi/oauth/token",_._revokeEndpoint="/restapi/oauth/revoke",_._authorizeEndpoint="/restapi/oauth/authorize",_._refreshDelayMs=100,_._cacheId="platform",_._clearCacheOnRefreshError=!0,t["default"]=_},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t,n){r(this,e),this._cache=t,this._cacheId=n}return n(e,[{key:"accessToken",value:function(){return this.data().access_token}},{key:"refreshToken",value:function(){return this.data().refresh_token}},{key:"tokenType",value:function(){return this.data().token_type}},{key:"data",value:function(){return this._cache.getItem(this._cacheId)||{token_type:"",access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}}},{key:"setData",value:function(e){e=e||{};var t=this.data();return Object.keys(e).forEach(function(r){t[r]=e[r]}),t.expire_time=Date.now()+1e3*t.expires_in,t.refresh_token_expire_time=Date.now()+1e3*t.refresh_token_expires_in,this._cache.setItem(this._cacheId,t),this}},{key:"accessTokenValid",value:function(){var t=this.data();return t.token_type===e.forcedTokenType||t.expire_time-e.refreshHandicapMs>Date.now()}},{key:"refreshTokenValid",value:function(){return this.data().refresh_token_expire_time>Date.now()}},{key:"cancelAccessToken",value:function(){return this.setData({access_token:"",expires_in:0})}},{key:"forceAuthentication",value:function(){return this.setData({token_type:e.forcedTokenType,access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}),this}},{key:"setRemember",value:function(e){return this.setData({remember:e})}},{key:"remember",value:function(){return!!this.data().remember}}]),e}();i.refreshHandicapMs=6e4,i.forcedTokenType="forced",t["default"]=i},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var s=r(20),u=n(s),a=r(4),c=function(){function e(){i(this,e),this.crypto_obj=a.PUBNUB.crypto_obj}return o(e,[{key:"init",value:function(e){return new u["default"](e)}}]),e}();t["default"]=c},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=r(9),c=n(a),f=r(4),l=function(e){function t(e){i(this,t);var r=o(this,Object.getPrototypeOf(t).call(this));return r.options=e,r.crypto_obj=f.PUBNUB.crypto_obj,r}return s(t,e),u(t,[{key:"ready",value:function(){}},{key:"subscribe",value:function(e){this.on("message-"+e.channel,e.message)}},{key:"unsubscribe",value:function(e){this.off("message-"+e.channel)}},{key:"receiveMessage",value:function(e,t){this.emit("message-"+t,e,"env",t)}}]),t}(c["default"]);t["default"]=l},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var s=t[i](o),u=s.value}catch(a){return void r(a)}s.done?e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}n("next")})}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();Object.defineProperty(t,"__esModule",{value:!0});var c=r(9),f=n(c),l=r(11),h=(n(l),r(3)),p=function(e){function t(e,r){o(this,t);var n=s(this,Object.getPrototypeOf(t).call(this));return n.events={notification:"notification",removeSuccess:"removeSuccess",removeError:"removeError",renewSuccess:"renewSuccess",renewError:"renewError",subscribeSuccess:"subscribeSuccess",subscribeError:"subscribeError"},n._pubnubFactory=e,n._platform=r,n._pubnub=null,n._timeout=null,n._subscription={},n}return u(t,e),a(t,[{key:"subscribed",value:function(){return!!(this._subscription.id&&this._subscription.deliveryMode&&this._subscription.deliveryMode.subscriberKey&&this._subscription.deliveryMode.address)}},{key:"alive",value:function(){return this.subscribed()&&Date.now()<this.expirationTime()}},{key:"expirationTime",value:function(){return new Date(this._subscription.expirationTime||0).getTime()-t._renewHandicapMs}},{key:"setSubscription",value:function(e){return e=e||{},this._clearTimeout(),this._subscription=e,this._pubnub||this._subscribeAtPubnub(),this._setTimeout(),this}},{key:"subscription",value:function(){return this._subscription}},{key:"register",value:function(){var e=i(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.alive()){e.next=6;break}return e.next=3,this.renew();case 3:return e.abrupt("return",e.sent);case 6:return e.next=8,this.subscribe();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},t,this)}));return function(){return e.apply(this,arguments)}}()},{key:"eventFilters",value:function(){return this._subscription.eventFilters||[]}},{key:"addEventFilters",value:function(e){return this.setEventFilters(this.eventFilters().concat(e)),this}},{key:"setEventFilters",value:function(e){return this._subscription.eventFilters=e,this}},{key:"subscribe",value:function(){var e=i(regeneratorRuntime.mark(function t(){var e,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this._clearTimeout(),this.eventFilters().length){t.next=4;break}throw new Error("Events are undefined");case 4:return t.next=6,this._platform.post("/restapi/v1.0/subscription",{eventFilters:this._getFullEventFilters(),deliveryMode:{transportType:"PubNub"}});case 6:return e=t.sent,r=e.json(),this.setSubscription(r).emit(this.events.subscribeSuccess,e),t.abrupt("return",e);case 12:throw t.prev=12,t.t0=t["catch"](0),t.t0=this._platform.client().makeError(t.t0),this.reset().emit(this.events.subscribeError,t.t0),t.t0;case 17:case"end":return t.stop()}},t,this,[[0,12]])}));return function(){return e.apply(this,arguments)}}()},{key:"renew",value:function(){var e=i(regeneratorRuntime.mark(function t(){var e,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this._clearTimeout(),this.alive()){t.next=4;break}throw new Error("Subscription is not alive");case 4:if(this.eventFilters().length){t.next=6;break}throw new Error("Events are undefined");case 6:return t.next=8,this._platform.put("/restapi/v1.0/subscription/"+this._subscription.id,{eventFilters:this._getFullEventFilters()});case 8:return e=t.sent,r=e.json(),this.setSubscription(r).emit(this.events.renewSuccess,e),t.abrupt("return",e);case 14:throw t.prev=14,t.t0=t["catch"](0),t.t0=this._platform.client().makeError(t.t0),this.reset().emit(this.events.renewError,t.t0),t.t0;case 19:case"end":return t.stop()}},t,this,[[0,14]])}));return function(){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=i(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.subscribed()){t.next=3;break}throw new Error("No subscription");case 3:return t.next=5,this._platform["delete"]("/restapi/v1.0/subscription/"+this._subscription.id);case 5:return e=t.sent,this.reset().emit(this.events.removeSuccess,e),t.abrupt("return",e);case 10:throw t.prev=10,t.t0=t["catch"](0),t.t0=this._platform.client().makeError(t.t0),this.emit(this.events.removeError,t.t0),t.t0;case 15:case"end":return t.stop()}},t,this,[[0,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"resubscribe",value:function(){return this.reset().setEventFilters(this.eventFilters()).subscribe()}},{key:"reset",value:function(){return this._clearTimeout(),this.subscribed()&&this._pubnub&&this._pubnub.unsubscribe({channel:this._subscription.deliveryMode.address}),this._subscription={},this}},{key:"_getFullEventFilters",value:function(){var e=this;return this.eventFilters().map(function(t){return e._platform.createUrl(t)})}},{key:"_setTimeout",value:function(){var e=this;if(this._clearTimeout(),!this.alive())throw new Error("Subscription is not alive");return(0,h.poll)(function(t){return e.alive()?t():void e.renew()},t._pollInterval,this._timeout),this}},{key:"_clearTimeout",value:function(){return(0,h.stopPolling)(this._timeout),this}},{key:"_decrypt",value:function(e){if(!this.subscribed())throw new Error("No subscription");if(this._subscription.deliveryMode.encryptionKey){var t=this._pubnubFactory;e=t.crypto_obj.decrypt(e,this._subscription.deliveryMode.encryptionKey,{encryptKey:!1,keyEncoding:"base64",keyLength:128,mode:"ecb"})}return e}},{key:"_notify",value:function(e){return this.emit(this.events.notification,this._decrypt(e)),this}},{key:"_subscribeAtPubnub",value:function(){if(!this.alive())throw new Error("Subscription is not alive");var e=this._pubnubFactory;return this._pubnub=e.init({ssl:!0,subscribe_key:this._subscription.deliveryMode.subscriberKey}),this._pubnub.ready(),this._pubnub.subscribe({channel:this._subscription.deliveryMode.address,message:this._notify.bind(this),connect:function(){}}),this}}]),t}(f["default"]);p._renewHandicapMs=12e4,p._pollInterval=1e4,t["default"]=p},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var s=t[i](o),u=s.value}catch(a){return void r(a)}s.done?e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}n("next")})}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f=function y(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:y(i,t,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)};Object.defineProperty(t,"__esModule",{value:!0});var l=r(21),h=n(l),p=r(10),d=n(p),v=function(e){function t(e,r,n,i){o(this,t);var u=s(this,Object.getPrototypeOf(t).call(this,e,r));return u._cache=n,u._cacheKey=i,u._renewQueue=new d["default"](u._cache,i+"-renew"),u._resubscribeQueue=new d["default"](u._cache,i+"-resubscribe"),u.events=a({},u.events,{queuedRenewSuccess:"queuedRenewSuccess",queuedRenewError:"queuedRenewError",queuedResubscribeSuccess:"queuedResubscribeSuccess",queuedResubscribeError:"queuedResubscribeError"}),u.on(u.events.renewError,function(){u.resubscribe()}),u.on([u.events.subscribeSuccess,u.events.renewSuccess],function(){u._cache.setItem(u._cacheKey,u.subscription())}),u.on(u.events.removeSuccess,function(){u._cache.removeItem(u._cacheKey)}),u}return u(t,e),c(t,[{key:"_queue",value:function(){var e=i(regeneratorRuntime.mark(function t(e,r,n,i,o){var s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!r.isPaused()){t.next=8;break}return t.next=4,r.poll();case 4:if(this.alive()){t.next=6;break}throw new Error(o);case 6:return this.emit(n,null),t.abrupt("return",null);case 8:return r.pause(),t.next=11,e.call(this);case 11:return s=t.sent,r.resume(),this.emit(n,s),t.abrupt("return",s);case 17:throw t.prev=17,t.t0=t["catch"](0),this.emit(i,t.t0),t.t0;case 21:case"end":return t.stop()}},t,this,[[0,17]])}));return function(t,r,n,i,o){return e.apply(this,arguments)}}()},{key:"renew",value:function(){return this._queue(f(Object.getPrototypeOf(t.prototype),"renew",this),this._renewQueue,this.events.queuedRenewSuccess,this.events.queuedRenewError,"Subscription is not alive after renew timeout")}},{key:"resubscribe",value:function(){return this._queue(f(Object.getPrototypeOf(t.prototype),"resubscribe",this),this._resubscribeQueue,this.events.queuedResubscribeSuccess,this.events.queuedResubscribeError,"Subscription is not alive after resubscribe timeout")}},{key:"restore",value:function(e){var t=this._cache.getItem(this._cacheKey);if(t)try{this.setSubscription(t)}catch(r){}else this.setEventFilters(e);return this}}]),t}(h["default"]);t["default"]=v}])});
//# sourceMappingURL=ringcentral.min.js.map
