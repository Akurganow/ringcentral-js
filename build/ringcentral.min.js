var RingCentral;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e,t){this.setPrefix(t),this._storage=e}return e.prototype.setPrefix=function(e){return this._prefix=e||"rc-",this},e.prototype.setItem=function(e,t){return this._storage[this._prefixKey(e)]=JSON.stringify(t),this},e.prototype.removeItem=function(e){return delete this._storage[this._prefixKey(e)],this},e.prototype.getItem=function(e){var t=this._storage[this._prefixKey(e)];return t?JSON.parse(t):null},e.prototype.clean=function(){for(var e in this._storage)this._storage.hasOwnProperty(e)&&0===e.indexOf(this._prefix)&&delete this._storage[e];return this},e.prototype._prefixKey=function(e){return this._prefix+e},e}();e.Cache=t}(t=e.core||(e.core={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(e){e||(e={log:function(){},warn:function(){},info:function(){},error:function(){}}),this._console=e,this.logDebug=!1,this.logInfo=!1,this.logWarnings=!1,this.logErrors=!1,this.addTimestamps=!1}return t.prototype.disableAll=function(){this.logDebug=!1,this.logInfo=!1,this.logWarnings=!1,this.logErrors=!1},t.prototype.enableAll=function(){this.logDebug=!0,this.logInfo=!0,this.logWarnings=!0,this.logErrors=!0},t.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.logDebug&&this._console.log.apply(this._console,this._parseArguments(arguments))},t.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.logInfo&&this._console.info.apply(this._console,this._parseArguments(arguments))},t.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.logWarnings&&this._console.warn.apply(this._console,this._parseArguments(arguments))},t.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.logErrors&&this._console.error.apply(this._console,this._parseArguments(arguments))},t.prototype.stack=function(){var e=new Error;return e.hasOwnProperty("stack")?e.stack.replace("Error\n","Stack Trace\n"):void 0},t.prototype._parseArguments=function(t){return t=e.utils.argumentsToArray(t),this.addTimestamps&&t.unshift((new Date).toLocaleString(),"-"),t},t}();e.Log=t,e.log=new t}(t=e.core||(e.core={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){function t(e,r){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var i,s,u,a,h,l,f=arguments[0]||{},d=1,y=arguments.length,m=!1;for("boolean"==typeof f&&(m=f,f=arguments[d]||{},d++),"object"==typeof f||c(f)||(f={});y>d;d++)if(null!==(i=arguments[d]))for(s in i)u=f[s],a=i[s],f!==a&&(m&&a&&(_(a)||(h=p(a)))?(h?(h=!1,l=u&&p(u)?u:[]):l=u&&_(u)?u:{},f[s]=t(m,l,a)):void 0!==a&&(f[s]=a));return f}function r(e,t){for(var r in e)if(e.hasOwnProperty(r)){var n=t(e[r],r);if(n===!1)break}}function n(e){var t=[];return r(e,function(e,r){p(e)?e.forEach(function(e){t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}),t.join("&")}function o(e){var t={},r=this;return e.split("&").forEach(function(e){if(e=decodeURIComponent(e),-1==e.indexOf("="))t[e.trim()]=!0;else{var n=e.split("="),o=n[0].trim(),i=n[1].trim();o in t?(o in t&&!r.isArray(t[o])&&(t[o]=[t[o]]),t[o].push(i)):t[o]=i}}),t}function i(e,t){return t?/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?[ ,;]*)+$/i.test(e):/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i.test(e)}function s(e){return/\+?1[0-9]{3}[0-9a-z]{7}/im.test(e.toString().split(/[^0-9a-z\+]/im).join(""))}function u(e){return Array.prototype.slice.call(e||[],0)}function a(e){return"date"===f(e)}function c(e){return"function"===f(e)}function p(e){return Array.isArray?Array.isArray(e):"array"===f(e)}function h(e){return e&&"object"==typeof e&&"setInterval"in e}function l(e){return null===e||!T.test(e)||isNaN(e)}function f(e){return null===e?String(e):C[R.call(e)]||"object"}function _(e){if(!e||"object"!==f(e)||e.nodeType||h(e))return!1;if(e.constructor&&!w.call(e,"constructor")&&!w.call(e.constructor.prototype,"isPrototypeOf"))return!1;var t;for(t in e);return void 0===t||w.call(e,t)}function d(e,t){return t.split(/[.[\]]/).reduce(function(e,t){return e?t?e[t]:e:void 0},e)}function y(e,t,r){m(r),t=t||1e3;var n=function(r){return r=r||t,t=r,setTimeout(function(){e(n,r)},r)};return n()}function m(e){e&&clearTimeout(e)}function b(e){return e?e.toString():""}function v(e){return e?(e=parseFloat(e),l(e)?0:e):0}function g(){return"undefined"!=typeof process}function k(){return"undefined"!=typeof window}var w=Object.prototype.hasOwnProperty,R=Object.prototype.toString,T=/\d/,C={};"Boolean Number String Function Array Date RegExp Object".split(" ").forEach(function(e){C["[object "+e+"]"]=e.toLowerCase()}),e.extend=t,e.forEach=r,e.queryStringify=n,e.parseQueryString=o,e.isEmail=i,e.isPhoneNumber=s,e.argumentsToArray=u,e.isDate=a,e.isFunction=c,e.isArray=p,e.isWindow=h,e.isNan=l,e.type=f,e.isPlainObject=_,e.getProperty=d,e.poll=y,e.stopPolling=m,e.parseString=b,e.parseNumber=v,e.isNodeJS=g,e.isBrowser=k}(t=e.utils||(e.utils={}))}(t=e.core||(e.core={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(){if(!(this instanceof t))throw new Error("Observable(): New operator was omitted");this.off()}return t.prototype.hasListeners=function(e){return e in this._listeners},t.prototype.on=function(e,t){var r=this;if("string"==typeof e&&(e=[e]),!e)throw new Error("No events to subscribe to");if("function"!=typeof t)throw new Error("Callback must be a function");return e.forEach(function(e){r.hasListeners(e)||(r._listeners[e]=[]),r._listeners[e].push(t)}),this},t.prototype.emit=function(e){for(var t=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=null;return this.hasListeners(e)?(this._listeners[e].some(function(e){return o=e.apply(t,r),o===!1}),o):null},t.prototype.off=function(e,t){var r=this;if(e)if(t){if(!this.hasListeners(e))return this;this._listeners[e].forEach(function(n,o){n===t&&delete r._listeners[e][o]})}else delete this._listeners[e];else this._listeners={};return this},t.prototype.destroy=function(){return this.off(),e.log.debug("Observable.destroy(): Listeners were destroyed"),this},t}();e.Observable=t}(t=e.core||(e.core={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},RingCentral;!function(e){var t;!function(e){var t;!function(e){var t=function(e){function t(){var t=this;e.call(this),this.events={change:"change"};var r="hidden",n=function(e){e=e||window.event;var n="visible",o="hidden",i={focus:n,focusin:n,pageshow:n,blur:o,focusout:o,pagehide:o};t._visible=e.type in i?i[e.type]==n:!document[r],t.emit(t.events.change,t._visible)};this._visible=!0,"undefined"!=typeof document&&"undefined"!=typeof window&&(r in document?document.addEventListener("visibilitychange",n):(r="mozHidden")in document?document.addEventListener("mozvisibilitychange",n):(r="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",n):(r="msHidden")in document?document.addEventListener("msvisibilitychange",n):"onfocusin"in document?document.onfocusin=document.onfocusout=n:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=n)}return __extends(t,e),t.prototype.visible=function(){return this._visible},t}(e.Observable);e.PageVisibility=t}(t=e.core||(e.core={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var r=function(){function t(e,t,r,n,o,i){this._method=e.toUpperCase(),this._path=t,this._json=r||{},this._delay=i||10,this._status=n||200,this._statusText=o||"OK"}return t.prototype.path=function(){return this._path},t.prototype.method=function(){return this._method},t.prototype.test=function(e){return e.url.indexOf(this._path)>-1&&e.method.toUpperCase()==this._method},t.prototype.getResponse=function(t){var r=this;return new e.externals._Promise(function(e,t){setTimeout(function(){e(r.createResponse(r._json))},r._delay)})},t.prototype.createResponse=function(t,r){r=r||{},r.status=r.status||this._status,r.statusText=r.statusText||this._statusText;var n=JSON.stringify(t),o=e.http.Client.createResponse(n,r);return o.headers.set(e.http.ApiResponse.contentType,e.http.ApiResponse.jsonContentType),o},t}();t.Mock=r}(t=e.mocks||(e.mocks={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(){this._mocks=[]}return t.prototype.add=function(e){return this._mocks.push(e),this},t.prototype.clear=function(){return this._mocks=[],this},t.prototype.find=function(e){var t=this._mocks.shift();if(!t)throw new Error("No mock in registry for request "+e.method+" "+e.url);if(!t.test(e))throw new Error("Wrong request "+e.method+" "+e.url+" for expected mock "+t.method()+" "+t.path());return t},t.prototype.apiCall=function(t,r,n,o,i){return this.add(new e.Mock(t,r,n,o,i)),this},t.prototype.authentication=function(){return this.apiCall("POST","/restapi/oauth/token",{access_token:"ACCESS_TOKEN",token_type:"bearer",expires_in:3600,refresh_token:"REFRESH_TOKEN",refresh_token_expires_in:60480,scope:"SMS RCM Foo Boo",expireTime:(new Date).getTime()+36e5}),this},t.prototype.logout=function(){return this.apiCall("POST","/restapi/oauth/revoke",{}),this},t.prototype.presenceLoad=function(e){return this.apiCall("GET","/restapi/v1.0/account/~/extension/"+e+"/presence",{uri:"https://platform.ringcentral.com/restapi/v1.0/account/123/extension/"+e+"/presence",extension:{uri:"https://platform.ringcentral.com/restapi/v1.0/account/123/extension/"+e,id:e,extensionNumber:"101"},activeCalls:[],presenceStatus:"Available",telephonyStatus:"Ringing",userStatus:"Available",dndStatus:"TakeAllCalls",extensionId:e}),this},t.prototype.subscribeGeneric=function(e){e=e||54e3;var t=new Date;return this.apiCall("POST","/restapi/v1.0/subscription",{eventFilters:["/restapi/v1.0/account/~/extension/~/presence"],expirationTime:new Date(t.getTime()+1e3*e).toISOString(),expiresIn:e,deliveryMode:{transportType:"PubNub",encryption:!1,address:"123_foo",subscriberKey:"sub-c-foo",secretKey:"sec-c-bar"},id:"foo-bar-baz",creationTime:t.toISOString(),status:"Active",uri:"https://platform.ringcentral.com/restapi/v1.0/subscription/foo-bar-baz"}),this},t.prototype.subscribeOnPresence=function(e,t){e=e||"1";var r=new Date;return this.apiCall("POST","/restapi/v1.0/subscription",{eventFilters:["/restapi/v1.0/account/~/extension/"+e+"/presence"+(t?"?detailedTelephonyState=true":"")],expirationTime:new Date(r.getTime()+54e6).toISOString(),deliveryMode:{transportType:"PubNub",encryption:!0,address:"123_foo",subscriberKey:"sub-c-foo",secretKey:"sec-c-bar",encryptionAlgorithm:"AES",encryptionKey:"VQwb6EVNcQPBhE/JgFZ2zw=="},creationTime:r.toISOString(),id:"foo-bar-baz",status:"Active",uri:"https://platform.ringcentral.com/restapi/v1.0/subscription/foo-bar-baz"}),this},t.prototype.tokenRefresh=function(e){return e?this.apiCall("POST","/restapi/oauth/token",{message:"Wrong token",error_description:"Wrong token",description:"Wrong token"},400):this.apiCall("POST","/restapi/oauth/token",{access_token:"ACCESS_TOKEN_FROM_REFRESH",token_type:"bearer",expires_in:3600,refresh_token:"REFRESH_TOKEN_FROM_REFRESH",refresh_token_expires_in:60480,scope:"SMS RCM Foo Boo"}),this},t}();e.Registry=t}(t=e.mocks||(e.mocks={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(e){function t(){var t=Function("return this")();return e._PUBNUB||(e._PUBNUB=t.PUBNUB),e._Promise||(e._Promise=t.Promise),e._fetch||(e._fetch=t.fetch),e._Headers||(e._Headers=t.Headers),e._Request||(e._Request=t.Request),e._Response||(e._Response=t.Response),e}e._Promise,e._fetch,e._Response,e._Request,e._Headers,e._PUBNUB,e.get=t}(t=e.externals||(e.externals={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var r=function(){function r(e,t,r){this._text=r,this._request=e,this._response=t,this._json=null,this._multipartTransactions=null}return r.prototype.response=function(){return this._response},r.prototype.request=function(){return this._request},r.prototype.ok=function(){return this._response&&this._response.ok},r.prototype.text=function(){return this._text},r.prototype.json=function(){if(!this._isJson())throw new Error("Response is not JSON");return this._json||(this._json=this._text?JSON.parse(this._text):null),this._json},r.prototype.error=function(e){if(this.ok()&&!e)return null;var t=(this._response&&this._response.status?this._response.status+" ":"")+(this._response&&this._response.statusText?this._response.statusText:"");try{var r=this.json();r.message&&(t=r.message),r.error_description&&(t=r.error_description),r.description&&(t=r.description)}catch(n){}return t},r.prototype.multipart=function(){if(!this._isMultipart())throw new Error("Response is not multipart");if(null===this._multipartTransactions){if(!this._text)throw new Error("No response body");var e=this._response.headers.get("Content-Type").match(/boundary=([^;]+)/i)[1];if(!e)throw new Error("Cannot find boundary");var t=this._text.toString().split(r.boundarySeparator+e);if(""===t[0].trim()&&t.shift(),t[t.length-1].trim()==r.boundarySeparator&&t.pop(),t.length<1)throw new Error("No parts in body");var n=r.create(t.shift(),this._response.status,this._response.statusText);this._multipartTransactions=t.map(function(e,t){var o=n.json().response[t].status;return r.create(e,o)})}return this._multipartTransactions},r.prototype.multipartJson=function(){return this.multipart().map(function(e){return e.json()})},r.prototype._isContentType=function(e){return this._getContentType().indexOf(e)>-1},r.prototype._getContentType=function(){return this._response.headers.get(r.contentType)||""},r.prototype._isMultipart=function(){return this._isContentType(r.multipartContentType)},r.prototype._isUrlEncoded=function(){return this._isContentType(r.urlencodedContentType)},r.prototype._isJson=function(){return this._isContentType(r.jsonContentType)},r.create=function(n,o,i){o=o||200,i=i||"OK",n=n.replace(/\r/g,"");var s=new e.externals._Headers,u=n.split(r.bodySeparator),a=u.length>1?u.shift():"";return n=u.join(r.bodySeparator),(a||"").split("\n").forEach(function(e){var t=e.trim().split(r.headerSeparator),n=t.shift().trim(),o=t.join(r.headerSeparator).trim();n&&s.append(n,o)}),new r(null,t.Client.createResponse(n,{headers:s,status:o,statusText:i}),n)},r.contentType="Content-Type",r.jsonContentType="application/json",r.multipartContentType="multipart/mixed",r.urlencodedContentType="application/x-www-form-urlencoded",r.headerSeparator=":",r.bodySeparator="\n\n",r.boundarySeparator="--",r}();t.ApiResponse=r}(t=e.http||(e.http={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var r=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"],n=function(n){function o(){n.apply(this,arguments),this.events={beforeRequest:"beforeRequest",requestSuccess:"requestSuccess",requestError:"requestError"}}return __extends(o,n),o.prototype.sendRequest=function(r){var n=this,i=new t.ApiResponse(r);return new e.externals._Promise(function(e){n.emit(n.events.beforeRequest,i),e(n._loadResponse(r))}).then(function(e){return i._response=o.cloneResponse(e),e.text()}).then(function(e){if(i._text=e,!i.ok())throw o.makeError(new Error("Response has unsuccessful status"),i);return n.emit(n.events.requestSuccess,i),i})["catch"](function(e){throw e.apiResponse||(e=o.makeError(e,i)),n.emit(n.events.requestError,e),e})},o.prototype._loadResponse=function(t){return e.externals._fetch.call(null,t)},o.makeError=function(e,t){var r=e;return r.hasOwnProperty("apiResponse")||r.hasOwnProperty("originalMessage")||(r.apiResponse=t,r.originalMessage=r.message,r.message=t&&t.error(!0)||r.originalMessage),r},o.cloneResponse=function(t){if(e.core.utils.isFunction(t.clone))return t.clone();var r="";t.hasOwnProperty("_bodyInit")&&(r=t._bodyInit),t.hasOwnProperty("_bodyText")&&(r=t._bodyText),t.hasOwnProperty("_bodyBlob")&&(r=t._bodyBlob.slice()),t.hasOwnProperty("_bodyFormData")&&(r=t._bodyFormData),t.hasOwnProperty("_raw")&&(r=t._raw.join(""));var n=new e.externals._Response(r,t);return t.hasOwnProperty("body")&&(n.body=t.body),n},o.createResponse=function(t,r){return r=r||{},new e.externals._Response(t,r)},o.createRequest=function(t,n){n=n||{};var o=n.body,i=new e.externals._Request(t,e.core.utils.extend({},n,{body:null}));if(!i.url)throw new Error("Url is not defined");if(i.method||(i.method="GET"),i.method&&r.indexOf(i.method)<0)throw new Error("Method has wrong value: "+i.method);if(i.headers.has("Accept")||i.headers.set("Accept","application/json"),e.core.utils.isPlainObject(n.body)||!n.body){i.headers.has("Content-Type")||i.headers.set("Content-Type","application/json");var s=i.headers.get("Content-Type");s.indexOf("application/json")>-1?o=JSON.stringify(n.body):s.indexOf("application/x-www-form-urlencoded")>-1&&(o=e.core.utils.queryStringify(n.body))}return i.credentials="include",i.mode="cors",n.query&&(i.url=i.url+(i.url.indexOf("?")>-1?"&":"?")+e.core.utils.queryStringify(n.query)),i=new e.externals._Request(i.url,e.core.utils.extend(i,{body:o})),i.body=n.body,i},o}(e.core.Observable);t.Client=n}(t=e.http||(e.http={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var r=function(){function t(e,t){this._cache=e,this._cacheId=t,this.setPollInterval(250),this.setReleaseTimeout(5e3)}return t.prototype.isPaused=function(){var e=this._cache,t=this._cacheId,r=e.getItem(t);return!!r&&Date.now()-parseInt(r)<this._releaseTimeout},t.prototype.pause=function(){return this._cache.setItem(this._cacheId,Date.now()),this},t.prototype.resume=function(){return this._cache.removeItem(this._cacheId),this},t.prototype.poll=function(){var t=this;return this._promise?this._promise:(this._promise=new e.externals._Promise(function(r,n){e.core.utils.poll(function(e){return t.isPaused()?e():(t._promise=null,t.resume(),void r(null))},t._pollInterval)}),this._promise)},t.prototype.releaseTimeout=function(){return this._releaseTimeout},t.prototype.pollInterval=function(){return this._pollInterval},t.prototype.setReleaseTimeout=function(e){return this._releaseTimeout=e,this},t.prototype.setPollInterval=function(e){return this._pollInterval=e,this},t}();t.Queue=r}(t=e.platform||(e.platform={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var r=function(r){function n(e,n,o,i,s,u){r.call(this),this._refreshDelayMs=100,this._clearCacheOnRefreshError=!0,this._cacheId="platform",this.events={accessViolation:"accessViolation",logoutSuccess:"logoutSuccess",logoutError:"logoutError",authorizeSuccess:"authorizeSuccess",authorizeError:"authorizeError",refreshSuccess:"refreshSuccess",refreshError:"refreshError"},this._server=i,this._appKey=s,this._appSecret=u,this._cache=n,this._client=e,this._queue=new t.Queue(this._cache,this._cacheId+"-refresh"),this._auth=new t.Auth(this._cache,this._cacheId)}return __extends(n,r),n.prototype.auth=function(){return this._auth},n.prototype.createUrl=function(e,t){e=e||"",t=t||{};var r="",o=-1!=e.indexOf("http://")||-1!=e.indexOf("https://");return t.addServer&&!o&&(r+=this._server),-1!=e.indexOf(n._urlPrefix)||o||(r+=n._urlPrefix+"/"+n._apiVersion),r+=e,(t.addMethod||t.addToken)&&(r+=e.indexOf("?")>-1?"&":"?"),t.addMethod&&(r+="_method="+t.addMethod),t.addToken&&(r+=(t.addMethod?"&":"")+"access_token="+this._auth.accessToken()),r},n.prototype.authUrl=function(t){return t=t||{},this.createUrl(n._authorizeEndpoint+"?"+e.core.utils.queryStringify({response_type:"code",redirect_uri:t.redirectUri||"",client_id:this._appKey,state:t.state||"",brand_id:t.brandId||"",display:t.display||"",prompt:t.prompt||""}),{addServer:!0})},n.prototype.parseAuthRedirectUrl=function(t){var r=e.core.utils.parseQueryString(t.split("?").reverse()[0]),n=r.error_description||r.error;if(n){var o=new Error(n);throw o.error=r.error,o}return r},n.prototype.loggedIn=function(){return this._ensureAuthentication().then(function(){return!0})["catch"](function(){return!1})},n.prototype.login=function(e){var t=this;e=e||{},e.remember=e.remember||!1;var r={access_token_ttl:n._accessTokenTtl,refresh_token_ttl:e.remember?n._refreshTokenTtlRemember:n._refreshTokenTtl};return e.code?e.code&&(r.grant_type="authorization_code",r.code=e.code,r.redirect_uri=e.redirectUri):(r.grant_type="password",r.username=e.username,r.password=e.password,r.extension=e.extension||""),e.endpointId&&(r.endpoint_id=e.endpointId),this._tokenRequest(n._tokenEndpoint,r).then(function(r){return t._auth.setData(r.json()).setRemember(e.remember),t.emit(t.events.authorizeSuccess,r),r})["catch"](function(e){throw t._cache.clean(),t.emit(t.events.authorizeError,e),e})},n.prototype.refresh=function(){var t=this,r=new e.externals._Promise(function(r,o){return t._queue.isPaused()?r(t._refreshPolling()):(t._queue.pause(),void setTimeout(function(){return e.core.log.debug("Platform.refresh(): Performing token refresh (access token",t._auth.accessToken(),", refresh token",t._auth.refreshToken(),")"),t._auth.refreshToken()?t._auth.refreshTokenValid()?t._queue.isPaused()?void r(t._tokenRequest(n._tokenEndpoint,{grant_type:"refresh_token",refresh_token:t._auth.refreshToken(),access_token_ttl:n._accessTokenTtl,refresh_token_ttl:t._auth.remember()?n._refreshTokenTtlRemember:n._refreshTokenTtl})):o(new Error("Queue was resumed before refresh call")):o(new Error("Refresh token has expired")):o(new Error("Refresh token is missing"))},t._refreshDelayMs))});return r.then(function(r){if(r&&r.json&&r.json()){var n=r.json();if(e.core.log.info("Platform.refresh(): Token was refreshed",r),!n.refresh_token||!n.access_token)throw e.http.Client.makeError(new Error("Malformed OAuth response"),r);t._auth.setData(n),t._queue.resume()}return t.emit(t.events.refreshSuccess,r),r})["catch"](function(r){throw r=e.http.Client.makeError(r),t._clearCacheOnRefreshError&&t._cache.clean(),t.emit(t.events.accessViolation,r),t.emit(t.events.refreshError,r),r})},n.prototype.logout=function(){var e=this;return this._queue.pause(),this._tokenRequest(n._revokeEndpoint,{token:this._auth.accessToken()}).then(function(t){return e._queue.resume(),e._cache.clean(),e.emit(e.events.logoutSuccess,t),t})["catch"](function(t){throw e._queue.resume(),e.emit(e.events.accessViolation,t),e.emit(e.events.logoutError,t),t})},n.prototype.inflateRequest=function(t,r){var n=this;return r=r||{},r.skipAuthCheck?e.externals._Promise.resolve(t):this._ensureAuthentication().then(function(){return t.headers.set("Authorization",n._authHeader()),t.url=n.createUrl(t.url,{addServer:!0}),t})},n.prototype.sendRequest=function(e,t){var r=this;return this.inflateRequest(e,t).then(function(e){return r._client.sendRequest(e)})["catch"](function(n){if(!n.apiResponse||!n.apiResponse.response()||401!=n.apiResponse.response().status)throw n;return r._auth.cancelAccessToken(),r.sendRequest(e,t)})},n.prototype.send=function(t,r){try{return t=this.createUrl(t,{addServer:!0}),this.sendRequest(e.http.Client.createRequest(t,r),r)}catch(n){return e.externals._Promise.reject(n)}},n.prototype.get=function(e,t){return t=t||{},t.method="GET",this.send(e,t)},n.prototype.post=function(e,t){return t=t||{},t.method="POST",this.send(e,t)},n.prototype.put=function(e,t){return t=t||{},t.method="PUT",this.send(e,t)},n.prototype["delete"]=function(e,t){return t=t||{},t.method="DELETE",this.send(e,t)},n.prototype._tokenRequest=function(e,t){return this.send(e,{skipAuthCheck:!0,body:t,method:"POST",headers:{Authorization:"Basic "+this._apiKey(),"Content-Type":"application/x-www-form-urlencoded"}})},n.prototype._ensureAuthentication=function(){return this._isAccessTokenValid()?e.externals._Promise.resolve(null):this.refresh()},n.prototype._isAccessTokenValid=function(){return this._auth.accessTokenValid()&&!this._queue.isPaused()},n.prototype._refreshPolling=function(){var t=this;return e.core.log.warn("Platform.refresh(): Refresh is already in progress, polling started"),this._queue.poll().then(function(){if(!t._isAccessTokenValid())throw new Error("Automatic authentification timeout");return null})},n.prototype._apiKey=function(){var e=this._appKey+":"+this._appSecret;return"function"==typeof btoa?btoa(e):new Buffer(e).toString("base64")},n.prototype._authHeader=function(){var e=this._auth.accessToken();return this._auth.tokenType()+(e?" "+e:"")},n._urlPrefix="/restapi",n._apiVersion="v1.0",n._accessTokenTtl=null,n._refreshTokenTtl=36e3,n._refreshTokenTtlRemember=604800,n._tokenEndpoint="/restapi/oauth/token",n._revokeEndpoint="/restapi/oauth/revoke",n._authorizeEndpoint="/restapi/oauth/authorize",n}(e.core.Observable);t.Platform=r}(t=e.platform||(e.platform={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var r=function(t){function r(e,r){t.call(this),this._renewHandicapMs=12e4,this.events={notification:"notification",removeSuccess:"removeSuccess",removeError:"removeError",renewSuccess:"renewSuccess",renewError:"renewError",subscribeSuccess:"subscribeSuccess",subscribeError:"subscribeError"},this._pubnubFactory=e,this._platform=r,this._pubnub=null,this._eventFilters=[],this._timeout=null,this._subscription=null}return __extends(r,t),r.prototype.alive=function(){return this._subscription&&this._subscription.id&&this._subscription.deliveryMode&&this._subscription.deliveryMode.subscriberKey&&this._subscription.deliveryMode.address},r.prototype.setSubscription=function(e){return this._clearTimeout(),this._subscription=e,this._pubnub||this._subscribeAtPubnub(),this._setTimeout(),this},r.prototype.subscription=function(){return this._subscription},r.prototype.register=function(e){return this.alive()?this.renew(e):this.subscribe(e)},r.prototype.addEvents=function(e){return this._eventFilters=this._eventFilters.concat(e),this},r.prototype.setEvents=function(e){return this._eventFilters=e,this},r.prototype.subscribe=function(t){var r=this;return t=t||{},t.events&&this.setEvents(t.events),this._clearTimeout(),new e.externals._Promise(function(e,t){if(!r._eventFilters||!r._eventFilters.length)throw new Error("Events are undefined");e(r._platform.post("/restapi/v1.0/subscription",{body:{eventFilters:r._getFullEventFilters(),deliveryMode:{transportType:"PubNub"}}}))}).then(function(e){return r.setSubscription(e.json()).emit(r.events.subscribeSuccess,e),e})["catch"](function(t){throw t=e.http.Client.makeError(t),r.reset().emit(r.events.subscribeError,t),t})},r.prototype.renew=function(t){var r=this;return t=t||{},t.events&&this.setEvents(t.events),this._clearTimeout(),new e.externals._Promise(function(e,t){if(!r.alive())throw new Error("Subscription is not alive");if(!r._eventFilters||!r._eventFilters.length)throw new Error("Events are undefined");return r._platform.put("/restapi/v1.0/subscription/"+r._subscription.id,{body:{eventFilters:r._getFullEventFilters()}})}).then(function(e){return r.setSubscription(e.json()).emit(r.events.renewSuccess,e.json()),e})["catch"](function(t){throw t=e.http.Client.makeError(t),r.reset().emit(r.events.renewError,t),t})},r.prototype.remove=function(){var t=this;return new e.externals._Promise(function(e,r){if(!t._subscription||!t._subscription.id)throw new Error("Subscription ID is required");e(t._platform["delete"]("/restapi/v1.0/subscription/"+t._subscription.id))}).then(function(e){return t.reset().emit(t.events.removeSuccess,e),e})["catch"](function(r){throw r=e.http.Client.makeError(r),t.emit(t.events.removeError,r),r})},r.prototype.reset=function(){return this._clearTimeout(),this.alive()&&this._pubnub&&this._pubnub.unsubscribe({channel:this._subscription.deliveryMode.address}),this._subscription=null,this},r.prototype.destroy=function(){return this.reset(),e.core.log.info("RC.subscription.Subscription: Destroyed"),t.prototype.destroy.call(this)},r.prototype._getFullEventFilters=function(){var e=this;return this._eventFilters.map(function(t){return e._platform.createUrl(t)})},r.prototype._setTimeout=function(){var e=this;if(this._clearTimeout(),!this.alive())throw new Error("Subscription is not alive");var t=1e3*this._subscription.expiresIn-this._renewHandicapMs;return this._timeout=setTimeout(function(){e.renew({})},t),this},r.prototype._clearTimeout=function(){return clearTimeout(this._timeout),this},r.prototype._decrypt=function(e){if(!this.alive())throw new Error("Subscription is not alive");if(this._subscription.deliveryMode.encryptionKey){var t=this._pubnubFactory.getPubnub();e=t.crypto_obj.decrypt(e,this._subscription.deliveryMode.encryptionKey,{encryptKey:!1,keyEncoding:"base64",keyLength:128,mode:"ecb"})}return e},r.prototype._notify=function(e){return this.emit(this.events.notification,this._decrypt(e)),this},r.prototype._subscribeAtPubnub=function(){var t=this;if(!this.alive())throw new Error("Subscription is not alive");var r=this._pubnubFactory.getPubnub();return this._pubnub=r.init({ssl:!0,subscribe_key:this._subscription.deliveryMode.subscriberKey}),this._pubnub.ready(),this._pubnub.subscribe({channel:this._subscription.deliveryMode.address,message:function(r,n,o){e.core.log.info("RC.core.Subscription: Incoming message",r),t._notify(r)},connect:function(){e.core.log.info("RC.core.Subscription: PUBNUB connected")}}),this},r}(e.core.Observable);t.Subscription=r}(t=e.subscription||(e.subscription={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var r=function(t){function r(r){t.call(this),this.options=r,this.crypto_obj=e.externals._PUBNUB.crypto_obj}return __extends(r,t),r.prototype.ready=function(){},r.prototype.subscribe=function(e){this.on("message-"+e.channel,e.message)},r.prototype.unsubscribe=function(e){this.off("message-"+e.channel)},r.prototype.receiveMessage=function(e,t){this.emit("message-"+t,e,"env",t)},r}(e.core.Observable);t.PubnubMock=r;var n=function(){function t(){this.crypto_obj=e.externals._PUBNUB.crypto_obj}return t.prototype.init=function(e){return new r(e)},t}();t.PubnubMockFactory=n}(t=e.pubnub||(e.pubnub={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var r=function(){function r(e){this._useMock=!1,this._useMock=!!e,this._mock=new t.PubnubMockFactory}return r.prototype.getPubnub=function(){return this._useMock?this._mock:e.externals._PUBNUB},r}();t.PubnubFactory=r}(t=e.pubnub||(e.pubnub={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t=function(){function t(t){t=t||{},e.externals.get(),this._mockRegistry=new e.mocks.Registry,this._cache=new e.core.Cache("undefined"!=typeof localStorage?localStorage:{},t.cachePrefix),this._queue=new e.platform.Queue(this._cache,"platform-refresh"),this._client=t.useHttpMock?new e.http.ClientMock(this._mockRegistry):new e.http.Client,this._platform=new e.platform.Platform(this._client,this._cache,this._queue,t.server,t.appKey,t.appSecret),this._pubnubFactory=new e.pubnub.PubnubFactory(t.usePubnubMock)}return t.prototype.platform=function(){return this._platform},t.prototype.cache=function(){return this._cache},t.prototype.createSubscription=function(){return new e.subscription.Subscription(this._pubnubFactory,this._platform);

},t.prototype.createPageVisibility=function(){return new e.core.PageVisibility},t.prototype.createObservable=function(){return new e.core.Observable},t.prototype.log=function(){return e.core.log},t.prototype.utils=function(){return e.core.utils},t.prototype.mockRegistry=function(){return this._mockRegistry},t.version="2.0.0",t.server={sandbox:"https://platform.devtest.ringcentral.com",production:"https://platform.ringcentral.com"},t}();e.SDK=t}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var e=RingCentral.sdk.externals.get();"function"==typeof define&&define.amd?define(["pubnub"],function(t){return e._PUBNUB=t,RingCentral.sdk}):"object"==typeof module&&module.exports&&(e._PUBNUB=require("pubnub"),e._Promise="undefined"!=typeof Promise?Promise:require("es6-promise").Promise,e._fetch=require("node-fetch"),e._Request=e._fetch.Request,e._Response=e._fetch.Response,e._Headers=e._fetch.Headers,module.exports=RingCentral.sdk);var RingCentral;!function(e){var t;!function(e){var t;!function(t){var r=function(t){function r(e){t.call(this),this._registry=e}return __extends(r,t),r.prototype._loadResponse=function(t){var r=this;return new e.externals._Promise(function(n){e.core.log.debug("API REQUEST",t.method,t.url);var o=r._registry.find(t);n(o.getResponse(t))})},r}(t.Client);t.ClientMock=r}(t=e.http||(e.http={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var r=function(){function t(e,t){this._cache=e,this._cacheId=t}return t.prototype.accessToken=function(){return this.data().access_token},t.prototype.refreshToken=function(){return this.data().refresh_token},t.prototype.tokenType=function(){return this.data().token_type},t.prototype.data=function(){return this._cache.getItem(this._cacheId)||{token_type:"",access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}},t.prototype.setData=function(t){var r=this.data();return t=e.core.utils.extend({},r,t),t.expire_time=Date.now()+1e3*t.expires_in,t.refresh_token_expire_time=Date.now()+1e3*t.refresh_token_expires_in,e.core.log.info("Auth.setData(): Tokens were updated, new:",t,", old:",r),this._cache.setItem(this._cacheId,t),this},t.prototype.accessTokenValid=function(){var e=this.data();return e.token_type===t.forcedTokenType||e.expire_time-t.refreshHandicapMs>Date.now()},t.prototype.refreshTokenValid=function(){return this.data().refresh_token_expire_time>Date.now()},t.prototype.cancelAccessToken=function(){return this.setData({access_token:"",expires_in:0})},t.prototype.forceAuthentication=function(){return this.setData({token_type:t.forcedTokenType,access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}),this},t.prototype.setRemember=function(e){return this.setData({remember:e})},t.prototype.remember=function(){return!!this.data().remember},t.refreshHandicapMs=6e4,t.forcedTokenType="forced",t}();t.Auth=r}(t=e.platform||(e.platform={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));
//# sourceMappingURL=ringcentral.min.js.map