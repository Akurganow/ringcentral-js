!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SDK=t():(e.RingCentral=e.RingCentral||{},e.RingCentral.SDK=t())}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="/build/",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(2),a=o(u),c=n(11),l=r(c),f=n(3),p=o(f),h=n(12),d=r(h),y=n(13),_=r(y),b=n(14),m=r(b),v=n(16),g=r(v),w=n(15),k=o(w),E=n(17),x=r(E),S=n(19),O=r(S),T=n(18),R=r(T),C=n(20),P=r(C),M=n(21),A=r(M),j=n(22),B=r(j),N=n(24),D=r(N),F=n(25),I=r(F);n(26);var L=function(){function e(t){i(this,e),t=t||{},this._cache=new l["default"](p.localStorage,t.cachePrefix),this._client=t.client||new m["default"],this._platform=new P["default"](this._client,this._cache,t.server,t.appKey,t.appSecret),this._pubnubFactory=t.pubnubFactory||p.PUBNUB}return s(e,null,[{key:"version",value:"2.0.0",enumerable:!0},{key:"server",value:{sandbox:"https://platform.devtest.ringcentral.com",production:"https://platform.ringcentral.com"},enumerable:!0}]),e.prototype.platform=function(){return this._platform},e.prototype.createSubscription=function(){return new D["default"](this._pubnubFactory,this._platform)},e.prototype.createCachedSubscription=function(e){return new I["default"](this._pubnubFactory,this._platform,this._cache,e)},e.prototype.cache=function(){return this._cache},s(e,null,[{key:"core",value:{Cache:l["default"],Observable:d["default"],Utils:a,Externals:p,Queue:_["default"]},enumerable:!0},{key:"http",value:{Client:m["default"],ApiResponse:g["default"],Utils:k},enumerable:!0},{key:"platform",value:{Auth:A["default"],Platform:P["default"]},enumerable:!0},{key:"subscription",value:{Subscription:D["default"]},enumerable:!0},{key:"mocks",value:{Client:x["default"],Registry:R["default"],Mock:O["default"]},enumerable:!0},{key:"pubnub",value:{PubnubMockFactory:B["default"]},enumerable:!0}]),e}();t["default"]=L,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){var t=[];return e=e||{},Object.keys(e).forEach(function(n){var r=e[n];s(r)?r.forEach(function(e){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r))}),t.join("&")}function o(e){var t={};return e.split("&").forEach(function(e){if(e=decodeURIComponent(e),-1==e.indexOf("="))t[e.trim()]=!0;else{var n=e.split("="),r=n[0].trim(),o=n[1].trim();r in t?(r in t&&!s(t[r])&&(t[r]=[t[r]]),t[r].push(o)):t[r]=o}}),t}function i(e){return"function"==typeof e}function s(e){return Array.isArray?Array.isArray(e):"array"==typeof e}function u(t,n,r){e.exports.stopPolling(r),n=n||1e3;var o=function i(e){return e=e||n,n=e,setTimeout(function(){t(i,e)},e)};return o()}function a(e){e&&clearTimeout(e)}function c(){return"undefined"!=typeof process}function l(){return"undefined"!=typeof window}function f(e){return new p.Promise(function(t,n){setTimeout(function(){t(null)},e)})}t.__esModule=!0,t.queryStringify=r,t.parseQueryString=o,t.isFunction=i,t.isArray=s,t.poll=u,t.stopPolling=a,t.isNodeJS=c,t.isBrowser=l,t.delay=f;var p=n(3)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var o=n(4),i=r(o),s=n(9),u=r(s),a=n(10),c=r(a),l=new Function("return this")(),f=i["default"]&&i["default"].Promise||l.Promise;t.Promise=f;var p=l.fetch||u["default"];t.fetch=p;var h=l.Request||p.Request;t.Request=h;var d=l.Response||p.Response;t.Response=d;var y=l.Headers||p.Headers;t.Headers=y;var _=l.PUBNUB||c["default"];t.PUBNUB=_;var b="undefined"!=typeof l.localStorage?l.localStorage:{};t.localStorage=b},function(e,t,n){var r;(function(e,o,i){(function(){"use strict";function s(e){return"function"==typeof e||"object"==typeof e&&null!==e}function u(e){return"function"==typeof e}function a(e){return"object"==typeof e&&null!==e}function c(e,t){re[Y]=e,re[Y+1]=t,Y+=2,2===Y&&(V?V(_):W())}function l(e){V=e}function f(){var t=process.nextTick,n=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(n)&&"0"===n[1]&&"10"===n[2]&&(t=e),function(){t(_)}}function p(){return function(){G(_)}}function h(){var e=0,t=new ee(_),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function d(){var e=new MessageChannel;return e.port1.onmessage=_,function(){e.port2.postMessage(0)}}function y(){return function(){setTimeout(_,1)}}function _(){for(var e=0;Y>e;e+=2){var t=re[e],n=re[e+1];t(n),re[e]=void 0,re[e+1]=void 0}Y=0}function b(){try{var e=n(!function(){var e=new Error('Cannot find module "vertx"');throw e.code="MODULE_NOT_FOUND",e}());return G=e.runOnLoop||e.runOnContext,p()}catch(t){return y()}}function m(){}function v(){return new TypeError("You cannot resolve a promise with itself")}function g(){return new TypeError("A promises callback cannot return that same promise.")}function w(e){try{return e.then}catch(t){return ue.error=t,ue}}function k(e,t,n,r){try{e.call(t,n,r)}catch(o){return o}}function E(e,t,n){Q(function(e){var r=!1,o=k(n,t,function(n){r||(r=!0,t!==n?O(e,n):R(e,n))},function(t){r||(r=!0,C(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,C(e,o))},e)}function x(e,t){t._state===ie?R(e,t._result):t._state===se?C(e,t._result):P(t,void 0,function(t){O(e,t)},function(t){C(e,t)})}function S(e,t){if(t.constructor===e.constructor)x(e,t);else{var n=w(t);n===ue?C(e,ue.error):void 0===n?R(e,t):u(n)?E(e,t,n):R(e,t)}}function O(e,t){e===t?C(e,v()):s(t)?S(e,t):R(e,t)}function T(e){e._onerror&&e._onerror(e._result),M(e)}function R(e,t){e._state===oe&&(e._result=t,e._state=ie,0!==e._subscribers.length&&Q(M,e))}function C(e,t){e._state===oe&&(e._state=se,e._result=t,Q(T,e))}function P(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+ie]=n,o[i+se]=r,0===i&&e._state&&Q(M,e)}function M(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r,o,i=e._result,s=0;s<t.length;s+=3)r=t[s],o=t[s+n],r?B(n,r,o,i):o(i);e._subscribers.length=0}}function A(){this.error=null}function j(e,t){try{return e(t)}catch(n){return ae.error=n,ae}}function B(e,t,n,r){var o,i,s,a,c=u(n);if(c){if(o=j(n,r),o===ae?(a=!0,i=o.error,o=null):s=!0,t===o)return void C(t,g())}else o=r,s=!0;t._state!==oe||(c&&s?O(t,o):a?C(t,i):e===ie?R(t,o):e===se&&C(t,o))}function N(e,t){try{t(function(t){O(e,t)},function(t){C(e,t)})}catch(n){C(e,n)}}function D(e,t){var n=this;n._instanceConstructor=e,n.promise=new e(m),n._validateInput(t)?(n._input=t,n.length=t.length,n._remaining=t.length,n._init(),0===n.length?R(n.promise,n._result):(n.length=n.length||0,n._enumerate(),0===n._remaining&&R(n.promise,n._result))):C(n.promise,n._validationError())}function F(e){return new ce(this,e).promise}function I(e){function t(e){O(o,e)}function n(e){C(o,e)}var r=this,o=new r(m);if(!X(e))return C(o,new TypeError("You must pass an array to race.")),o;for(var i=e.length,s=0;o._state===oe&&i>s;s++)P(r.resolve(e[s]),void 0,t,n);return o}function L(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(m);return O(n,e),n}function U(e){var t=this,n=new t(m);return C(n,e),n}function q(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function H(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function K(e){this._id=de++,this._state=void 0,this._result=void 0,this._subscribers=[],m!==e&&(u(e)||q(),this instanceof K||H(),N(this,e))}function J(){var e;if("undefined"!=typeof o)e=o;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;(!n||"[object Promise]"!==Object.prototype.toString.call(n.resolve())||n.cast)&&(e.Promise=ye)}var z;z=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var G,V,W,X=z,Y=0,Q=({}.toString,c),$="undefined"!=typeof window?window:void 0,Z=$||{},ee=Z.MutationObserver||Z.WebKitMutationObserver,te="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),ne="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,re=new Array(1e3);W=te?f():ee?h():ne?d():void 0===$?b():y();var oe=void 0,ie=1,se=2,ue=new A,ae=new A;D.prototype._validateInput=function(e){return X(e)},D.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},D.prototype._init=function(){this._result=new Array(this.length)};var ce=D;D.prototype._enumerate=function(){for(var e=this,t=e.length,n=e.promise,r=e._input,o=0;n._state===oe&&t>o;o++)e._eachEntry(r[o],o)},D.prototype._eachEntry=function(e,t){var n=this,r=n._instanceConstructor;a(e)?e.constructor===r&&e._state!==oe?(e._onerror=null,n._settledAt(e._state,t,e._result)):n._willSettleAt(r.resolve(e),t):(n._remaining--,n._result[t]=e)},D.prototype._settledAt=function(e,t,n){var r=this,o=r.promise;o._state===oe&&(r._remaining--,e===se?C(o,n):r._result[t]=n),0===r._remaining&&R(o,r._result)},D.prototype._willSettleAt=function(e,t){var n=this;P(e,void 0,function(e){n._settledAt(ie,t,e)},function(e){n._settledAt(se,t,e)})};var le=F,fe=I,pe=L,he=U,de=0,ye=K;K.all=le,K.race=fe,K.resolve=pe,K.reject=he,K._setScheduler=l,K._asap=Q,K.prototype={constructor:K,then:function(e,t){var n=this,r=n._state;if(r===ie&&!e||r===se&&!t)return this;var o=new this.constructor(m),i=n._result;if(r){var s=arguments[r-1];Q(function(){B(r,o,s,i)})}else P(n,o,e,t);return o},"catch":function(e){return this.then(null,e)}};var _e=J,be={Promise:ye,polyfill:_e};n(8).amd?(r=function(){return be}.call(t,n,t,i),!(void 0!==r&&(i.exports=r))):"undefined"!=typeof i&&i.exports?i.exports=be:"undefined"!=typeof this&&(this.ES6Promise=be),_e()}).call(this)}).call(t,n(5).setImmediate,function(){return this}(),n(7)(e))},function(e,t,n){(function(e,r){function o(e,t){this._id=e,this._clearFn=t}var i=n(6).nextTick,s=Function.prototype.apply,u=Array.prototype.slice,a={},c=0;t.setTimeout=function(){return new o(s.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new o(s.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},t.setImmediate="function"==typeof e?e:function(e){var n=c++,r=arguments.length<2?!1:u.call(arguments,1);return a[n]=!0,i(function(){a[n]&&(r?e.apply(null,r):e.call(null),t.clearImmediate(n))}),n},t.clearImmediate="function"==typeof r?r:function(e){delete a[e]}}).call(t,n(5).setImmediate,n(5).clearImmediate)},function(e,t){function n(){c=!1,s.length?a=s.concat(a):l=-1,a.length&&r()}function r(){if(!c){var e=setTimeout(n);c=!0;for(var t=a.length;t;){for(s=a,a=[];++l<t;)s&&s[l].run();l=-1,t=a.length}s=null,c=!1,clearTimeout(e)}}function o(e,t){this.fun=e,this.array=t}function i(){}var s,u=e.exports={},a=[],c=!1,l=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];a.push(new o(e,t)),1!==a.length||c||setTimeout(r,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=i,u.addListener=i,u.once=i,u.off=i,u.removeListener=i,u.removeAllListeners=i,u.emit=i,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t){!function(){"use strict";function e(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function t(e){return"string"!=typeof e&&(e=String(e)),e}function n(e){this.map={},e instanceof n?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function r(e){return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function o(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function i(e){var t=new FileReader;return t.readAsArrayBuffer(e),o(t)}function s(e){var t=new FileReader;return t.readAsText(e),o(t)}function u(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,"string"==typeof e)this._bodyText=e;else if(h.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(h.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else{if(e)throw new Error("unsupported BodyInit type");this._bodyText=""}},h.blob?(this.blob=function(){var e=r(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(i)},this.text=function(){var e=r(this);if(e)return e;if(this._bodyBlob)return s(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var e=r(this);return e?e:Promise.resolve(this._bodyText)},h.formData&&(this.formData=function(){return this.text().then(l)}),this.json=function(){return this.text().then(JSON.parse)},this}function a(e){var t=e.toUpperCase();return d.indexOf(t)>-1?t:e}function c(e,t){t=t||{};var r=t.body;if(c.prototype.isPrototypeOf(e)){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new n(e.headers)),this.method=e.method,this.mode=e.mode,r||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=e;if(this.credentials=t.credentials||this.credentials||"omit",(t.headers||!this.headers)&&(this.headers=new n(t.headers)),this.method=a(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function l(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(o))}}),t}function f(e){var t=new n,r=e.getAllResponseHeaders().trim().split("\n");return r.forEach(function(e){var n=e.trim().split(":"),r=n.shift().trim(),o=n.join(":").trim();t.append(r,o)}),t}function p(e,t){t||(t={}),this._initBody(e),this.type="default",this.url=null,this.status=t.status,this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof n?t.headers:new n(t.headers),this.url=t.url||""}if(!self.fetch){n.prototype.append=function(n,r){n=e(n),r=t(r);var o=this.map[n];o||(o=[],this.map[n]=o),o.push(r)},n.prototype["delete"]=function(t){delete this.map[e(t)]},n.prototype.get=function(t){var n=this.map[e(t)];return n?n[0]:null},n.prototype.getAll=function(t){return this.map[e(t)]||[]},n.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},n.prototype.set=function(n,r){this.map[e(n)]=[t(r)]},n.prototype.forEach=function(e,t){Object.getOwnPropertyNames(this.map).forEach(function(n){this.map[n].forEach(function(r){e.call(t,r,n,this)},this)},this)};var h={blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in self},d=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];u.call(c.prototype),u.call(p.prototype),self.Headers=n,self.Request=c,self.Response=p,self.fetch=function(e,t){var n;return n=c.prototype.isPrototypeOf(e)&&!t?e:new c(e,t),new Promise(function(e,t){function r(){return"responseURL"in o?o.responseURL:/^X-Request-URL:/m.test(o.getAllResponseHeaders())?o.getResponseHeader("X-Request-URL"):void 0}var o=new XMLHttpRequest;o.onload=function(){var n=1223===o.status?204:o.status;if(100>n||n>599)return void t(new TypeError("Network request failed"));var i={status:n,statusText:o.statusText,headers:f(o),url:r()},s="response"in o?o.response:o.responseText;e(new p(s,i))},o.onerror=function(){t(new TypeError("Network request failed"))},o.open(n.method,n.url,!0),"include"===n.credentials&&(o.withCredentials=!0),"responseType"in o&&h.blob&&(o.responseType="blob"),n.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),o.send("undefined"==typeof n._bodyInit?null:n._bodyInit)})},self.fetch.polyfill=!0}}()},function(module,exports,__webpack_require__){(function(module){function unique(){return"x"+ ++NOW+ +new Date}function rnow(){return+new Date}function build_url(e,t){var n=e.join(URLBIT),r=[];return t?(each(t,function(e,t){var n="object"==typeof t?JSON.stringify(t):t;"undefined"!=typeof t&&null!=t&&encode(n).length>0&&r.push(e+"="+encode(n))}),n+="?"+r.join(PARAMSBIT)):n}function updater(e,t){var n,r=0,o=function(){r+t>rnow()?(clearTimeout(n),n=setTimeout(o,t)):(r=rnow(),e())};return o}function grep(e,t){var n=[];return each(e||[],function(e){t(e)&&n.push(e)}),n}function supplant(e,t){return e.replace(REPL,function(e,n){return t[n]||e})}function timeout(e,t){return setTimeout(e,t)}function generate_uuid(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)});return e&&e(t),t}function isArray(e){return!!e&&"string"!=typeof e&&(Array.isArray&&Array.isArray(e)||"number"==typeof e.length)}function each(e,t){if(e&&t)if(isArray(e))for(var n=0,r=e.length;r>n;)t.call(e[n],e[n],n++);else for(var n in e)e.hasOwnProperty&&e.hasOwnProperty(n)&&t.call(e[n],n,e[n])}function map(e,t){var n=[];return each(e||[],function(e,r){n.push(t(e,r))}),n}function pam_encode(e){return encodeURIComponent(e).replace(/[!'()*~]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function encode(e){return encodeURIComponent(e)}function generate_channel_list(e,t){var n=[];return each(e,function(e,r){t?e.search("-pnpres")<0&&r.subscribed&&n.push(e):r.subscribed&&n.push(e)}),n.sort()}function generate_channel_group_list(e,t){var n=[];return each(e,function(e,r){t?e.search("-pnpres")<0&&r.subscribed&&n.push(e):r.subscribed&&n.push(e)}),n.sort()}function ready(){timeout(function(){READY||(READY=1,each(READY_BUFFER,function(e){e()}))},SECOND)}function PNmessage(e){return msg=e||{apns:{}},msg.getPubnubMessage=function(){var e={};if(Object.keys(msg.apns).length){e.pn_apns={aps:{alert:msg.apns.alert,badge:msg.apns.badge}};for(var t in msg.apns)e.pn_apns[t]=msg.apns[t];var n=["badge","alert"];for(var t in n)delete e.pn_apns[n[t]]}msg.gcm&&(e.pn_gcm={data:msg.gcm});for(var t in msg)e[t]=msg[t];var r=["apns","gcm","publish","channel","callback","error"];for(var t in r)delete e[r[t]];return e},msg.publish=function(){var e=msg.getPubnubMessage();msg.pubnub&&msg.channel&&msg.pubnub.publish({message:e,channel:msg.channel,callback:msg.callback,error:msg.error})},msg}function PN_API(e){function t(e){return e||(e={}),each(ie,function(t,n){t in e||(e[t]=n)}),e}function r(e){var t=[];return each(e,function(e,n){t.push(e)}),t}function o(e){return r(e).sort()}function i(e){var t="",n=o(e);for(var r in n){var i=n[r];t+=i+"="+pam_encode(e[i]),r!=n.length-1&&(t+="&")}return t}function s(e,t,n){var r=!1;if("undefined"==typeof e)return t;if("number"==typeof e)r=e>PRESENCE_HB_THRESHOLD||0==e?!1:!0;else{if("boolean"==typeof e)return e?PRESENCE_HB_DEFAULT:0;r=!0}return r?(n&&n("Presence Heartbeat value invalid. Valid range ( x > "+PRESENCE_HB_THRESHOLD+" or x = 0). Current Value : "+(t||PRESENCE_HB_THRESHOLD)),t||PRESENCE_HB_THRESHOLD):e}function u(e,t){return be.encrypt(e,t||le)||e}function a(e,t){return be.decrypt(e,t||le)||be.decrypt(e,le)||e}function c(){return clearTimeout($),!ee||ee>=500||1>ee||!generate_channel_list(X,!0).length&&!generate_channel_group_list(Y,!0).length?void(te=!1):(te=!0,void me.presence_heartbeat({callback:function(e){$=timeout(c,ee*SECOND)},error:function(e){se&&se("Presence Heartbeat unable to reach Pubnub servers."+JSON.stringify(e)),$=timeout(c,ee*SECOND)}}))}function l(){!te&&c()}function f(e){if(ne){if(!U.length)return}else{if(e&&(U.sending=0),U.sending||!U.length)return;U.sending=1}oe(U.shift())}function p(e){var t=0;return each(generate_channel_group_list(Y),function(n){var r=Y[n];r&&(t++,(e||function(){})(r))}),t}function h(e){var t=0;return each(generate_channel_list(X),function(n){var r=X[n];r&&(t++,(e||function(){})(r))}),t}function d(e,t,n){if("object"==typeof e){if(e.error){var r={};return e.message&&(r.message=e.message),e.payload&&(r.payload=e.payload),void(n&&n(r))}if(e.payload)return void(e.next_page?t&&t(e.payload,e.next_page):t&&t(e.payload))}t&&t(e)}function y(e,t){if("object"==typeof e&&e.error){var n={};return e.message&&(n.message=e.message),e.payload&&(n.payload=e.payload),void(t&&t(n))}t&&t(e)}function _(e,n,r,o){var n=e.callback||n,i=e.error||se,s=ae();o=o||{},o.auth||(o.auth=e.auth_key||A);var u=[F,"v1","channel-registration","sub-key",M];u.push.apply(u,r),s&&(o.callback=s),oe({callback:s,data:t(o),success:function(e){d(e,n,i)},fail:function(e){y(e,i)},url:u})}function b(){ue()||v(1,{error:"Offline. Please check your network settings. "}),E&&clearTimeout(E),E=timeout(b,SECOND)}function m(){R&&me.time(function(e){w(function(){},e),e||v(1,{error:"Heartbeat failed to connect to Pubnub Servers.Please check your network settings."}),x&&clearTimeout(x),x=timeout(m,T)})}function v(e,t){z&&z(e,t),z=null,clearTimeout(E),clearTimeout(x)}function g(e){var t=rnow()-H;return t-e/1e4}function w(e,t){function n(t){if(t){var n=t/1e4,o=(rnow()-r)/2;H=rnow()-(n+o),e&&e(H)}}var r=rnow();t&&n(t)||me.time(n)}var E,x,S=+e.windowing||DEF_WINDOWING,O=(+e.timeout||DEF_SUB_TIMEOUT)*SECOND,T=(+e.keepalive||DEF_KEEPALIVE)*SECOND,R=e.timecheck||0,C=e.noleave||0,P=e.publish_key,M=e.subscribe_key,A=e.auth_key||"",j=e.secret_key||"",B=e.hmac_SHA256,N=e.ssl?"s":"",D="http"+N+"://"+(e.origin||"pubsub.pubnub.com"),F=nextorigin(D),I=nextorigin(D),L=function(){},U=[],q=!0,H=0,K=0,J=0,z=0,G=e.restore||0,V=0,W=!1,X={},Y={},Q={},$=null,Z=s(e.heartbeat||e.pnexpires||0,e.error),ee=e.heartbeat_interval||Z/2-1,te=!1,ne=e.no_wait_for_pending,re=e["compatible_3.5"]||!1,oe=e.xdr,ie=e.params||{},se=e.error||function(){},ue=e._is_online||function(){return 1},ae=e.jsonp_cb||function(){return 0},ce=e.db||{get:function(){},set:function(){}},le=e.cipher_key,fe=e.uuid||!e.unique_uuid&&ce&&ce.get(M+"uuid")||"",pe=e.instance_id||!1,he="",de=e.shutdown,ye="undefined"!=typeof e.use_send_beacon?e.use_send_beacon:!0,_e=ye?e.sendBeacon:null;2===Z&&(ee=1);var be=e.crypto_obj||{encrypt:function(e,t){return e},decrypt:function(e,t){return e}},me={LEAVE:function(e,n,r,o,i){var s,u={uuid:fe,auth:r||A},a=nextorigin(D),o=o||function(){},c=i||function(){},l=ae();if(e.indexOf(PRESENCE_SUFFIX)>0)return!0;if(re){if(!N)return!1;if("0"==l)return!1}return C?!1:("0"!=l&&(u.callback=l),pe&&(u.instanceid=he),s=[a,"v2","presence","sub_key",M,"channel",encode(e),"leave"],ie=t(u),_e&&(url_string=build_url(s,ie),_e(url_string))?(o&&o({status:200,action:"leave",message:"OK",service:"Presence"}),!0):(oe({blocking:n||N,timeout:2e3,callback:l,data:ie,success:function(e){d(e,o,c)},fail:function(e){y(e,c)},url:s}),!0))},LEAVE_GROUP:function(e,n,r,o,i){var s={uuid:fe,auth:r||A},u=nextorigin(D),o=o||function(){},a=i||function(){},c=ae();if(e.indexOf(PRESENCE_SUFFIX)>0)return!0;if(re){if(!N)return!1;if("0"==c)return!1}return C?!1:("0"!=c&&(s.callback=c),e&&e.length>0&&(s["channel-group"]=e),pe&&(s.instanceid=he),oe({blocking:n||N,timeout:5e3,callback:c,data:t(s),success:function(e){d(e,o,a)},fail:function(e){y(e,a)},url:[u,"v2","presence","sub_key",M,"channel",encode(","),"leave"]}),!0)},set_resumed:function(e){W=e},get_cipher_key:function(){return le},set_cipher_key:function(e){le=e},raw_encrypt:function(e,t){return u(e,t)},raw_decrypt:function(e,t){return a(e,t)},get_heartbeat:function(){return Z},set_heartbeat:function(e,t){Z=s(e,Z,se),ee=t||Z/2-1,2==Z&&(ee=1),L(),c()},get_heartbeat_interval:function(){return ee},set_heartbeat_interval:function(e){ee=e,c()},get_version:function(){return SDK_VER},getGcmMessageObject:function(e){return{data:e}},getApnsMessageObject:function(e){var t={aps:{badge:1,alert:""}};for(k in e)k[t]=e[k];return t},newPnMessage:function(){var e={};gcm&&(e.pn_gcm=gcm),apns&&(e.pn_apns=apns);for(k in n)e[k]=n[k];return e},_add_param:function(e,t){ie[e]=t},channel_group:function(e,t){var n,r,o=e.channel_group,t=t||e.callback,i=e.channels||e.channel,s=e.cloak,u=[],a={},c=e.mode||"add";if(o){var l=o.split(":");l.length>1?(n="*"===l[0]?null:l[0],r=l[1]):r=l[0]}n&&u.push("namespace")&&u.push(encode(n)),u.push("channel-group"),r&&"*"!==r&&u.push(r),i?(isArray(i)&&(i=i.join(",")),a[c]=i,a.cloak=q?"true":"false"):"remove"===c&&u.push("remove"),"undefined"!=typeof s&&(a.cloak=s?"true":"false"),_(e,t,u,a)},channel_group_list_groups:function(e,t){var n;n=e.namespace||e.ns||e.channel_group||null,n&&(e.channel_group=n+":*"),me.channel_group(e,t)},channel_group_list_channels:function(e,t){return e.channel_group?void me.channel_group(e,t):se("Missing Channel Group")},channel_group_remove_channel:function(e,t){return e.channel_group?e.channel||e.channels?(e.mode="remove",void me.channel_group(e,t)):se("Missing Channel"):se("Missing Channel Group")},channel_group_remove_group:function(e,t){return e.channel_group?e.channel?se("Use channel_group_remove_channel if you want to remove a channel from a group."):(e.mode="remove",void me.channel_group(e,t)):se("Missing Channel Group")},channel_group_add_channel:function(e,t){return e.channel_group?e.channel||e.channels?void me.channel_group(e,t):se("Missing Channel"):se("Missing Channel Group")},channel_group_cloak:function(e,t){return"undefined"==typeof e.cloak?void t(q):(q=e.cloak,void me.channel_group(e,t))},channel_group_list_namespaces:function(e,t){var n=["namespace"];_(e,t,n)},channel_group_remove_namespace:function(e,t){var n=["namespace",e.namespace,"remove"];_(e,t,n)},history:function(e,n){var n=e.callback||n,r=e.count||e.limit||100,o=e.reverse||"false",i=e.error||function(){},s=e.auth_key||A,u=e.cipher_key,c=e.channel,l=e.channel_group,f=e.start,p=e.end,h=e.include_token,d=e.string_message_token||!1,_={},b=ae();return c||l?n?M?(_.stringtoken="true",_.count=r,_.reverse=o,_.auth=s,l&&(_["channel-group"]=l,c||(c=",")),b&&(_.callback=b),f&&(_.start=f),p&&(_.end=p),h&&(_.include_token="true"),d&&(_.string_message_token="true"),void oe({callback:b,data:t(_),success:function(e){if("object"==typeof e&&e.error)return void i({message:e.message,payload:e.payload});for(var t=e[0],r=[],o=0;o<t.length;o++){var s=a(t[o],u);try{r.push(JSON.parse(s))}catch(c){r.push(s)}}n([r,e[1],e[2]])},fail:function(e){y(e,i)},url:[F,"v2","history","sub-key",M,"channel",encode(c)]})):se("Missing Subscribe Key"):se("Missing Callback"):se("Missing Channel")},replay:function(e,n){var r,n=n||e.callback||function(){},o=e.auth_key||A,i=e.source,s=e.destination,u=e.stop,a=e.start,c=e.end,l=e.reverse,f=e.limit,p=ae(),h={};return i?s?P?M?("0"!=p&&(h.callback=p),u&&(h.stop="all"),l&&(h.reverse="true"),a&&(h.start=a),c&&(h.end=c),f&&(h.count=f),h.auth=o,r=[F,"v1","replay",P,M,i,s],void oe({callback:p,success:function(e){d(e,n,err)},fail:function(){n([0,"Disconnected"])},url:r,data:t(h)})):se("Missing Subscribe Key"):se("Missing Publish Key"):se("Missing Destination Channel"):se("Missing Source Channel")},auth:function(e){A=e,L()},time:function(e){var n=ae(),r={uuid:fe,auth:A};pe&&(r.instanceid=he),oe({callback:n,data:t(r),timeout:5*SECOND,url:[F,"time",n],success:function(t){e(t[0])},fail:function(){e(0)}})},publish:function(e,n){var r=e.message;if(!r)return se("Missing Message");var o,i,n=n||e.callback||r.callback||function(){},s=e.channel||r.channel,a=e.auth_key||A,c=e.cipher_key,l=e.error||r.error||function(){},p=e.post||!1,h="store_in_history"in e?e.store_in_history:!0,_=ae(),b="push";return e.prepend&&(b="unshift"),s?P?M?(r.getPubnubMessage&&(r=r.getPubnubMessage()),r=JSON.stringify(u(r,c)),i=[F,"publish",P,M,0,encode(s),_,encode(r)],o={uuid:fe,auth:a},h||(o.store="0"),pe&&(o.instanceid=he),U[b]({callback:_,timeout:5*SECOND,url:i,data:t(o),fail:function(e){y(e,l),f(1)},success:function(e){d(e,n,l),f(1)},mode:p?"POST":"GET"}),void f()):se("Missing Subscribe Key"):se("Missing Publish Key"):se("Missing Channel")},unsubscribe:function(e,t){var n=e.channel,r=e.channel_group,o=e.auth_key||A,t=t||e.callback||function(){},i=e.error||function(){};V=0,n&&(n=map((n.join?n.join(","):""+n).split(","),function(e){return X[e]?e+","+e+PRESENCE_SUFFIX:void 0}).join(","),each(n.split(","),function(e){var n=!0;e&&(X[e]=0,e in Q&&delete Q[e],READY&&(n=me.LEAVE(e,0,o,t,i)),n||t({action:"leave"}))})),r&&(r=map((r.join?r.join(","):""+r).split(","),function(e){return Y[e]?e+","+e+PRESENCE_SUFFIX:void 0}).join(","),each(r.split(","),function(e){var n=!0;e&&(Y[e]=0,e in Q&&delete Q[e],READY&&(n=me.LEAVE_GROUP(e,0,o,t,i)),n||t({action:"leave"}))})),L()},subscribe:function(e,n){function r(e){e?timeout(L,x):(F=nextorigin(D,1),I=nextorigin(D,1),timeout(function(){me.time(r)},SECOND)),h(function(t){return e&&t.disconnected?(t.disconnected=0,t.reconnect(t.name)):void(e||t.disconnected||(t.disconnected=1,t.disconnect(t.name)))}),p(function(t){return e&&t.disconnected?(t.disconnected=0,t.reconnect(t.name)):void(e||t.disconnected||(t.disconnected=1,t.disconnect(t.name)))})}function o(){var e=ae(),n=generate_channel_list(X).join(","),i=generate_channel_group_list(Y).join(",");if(n||i){n||(n=","),v();var s=t({uuid:fe,auth:A});i&&(s["channel-group"]=i);var u=JSON.stringify(Q);u.length>2&&(s.state=JSON.stringify(Q)),Z&&(s.heartbeat=Z),pe&&(s.instanceid=he),l(),z=oe({timeout:E,callback:e,fail:function(e){e&&e.error&&e.service?(y(e,d),r(1)):me.time(function(t){!t&&y(e,d),r(t)})},data:t(s),url:[I,"subscribe",M,encode(n),e,V],success:function(e){if(!e||"object"==typeof e&&"error"in e&&e.error)return d(e.error),timeout(L,SECOND);if(_(e[1]),V=!V&&G&&ce.get(M)||e[1],h(function(e){e.connected||(e.connected=1,e.connect(e.name))}),p(function(e){e.connected||(e.connected=1,e.connect(e.name))}),W&&!G)return V=0,W=!1,ce.set(M,0),void timeout(o,x);w&&(V=1e4,w=0),ce.set(M,e[1]);var t=function(){var t="",n="";e.length>3?(t=e[3],n=e[2]):t=e.length>2?e[2]:map(generate_channel_list(X),function(t){return map(Array(e[0].length).join(",").split(","),function(){return t})}).join(",");var r=t.split(","),o=n?n.split(","):[];return function(){var e=r.shift()||J,t=o.shift(),n={};t?(e&&e.indexOf("-pnpres")>=0&&t.indexOf("-pnpres")<0&&(t+="-pnpres"),n=Y[t]||X[t]||{callback:function(){}}):n=X[e];var i=[n.callback||K,e.split(PRESENCE_SUFFIX)[0]];
return t&&i.push(t.split(PRESENCE_SUFFIX)[0]),i}}(),n=g(+e[1]);each(e[0],function(r){var o=t(),i=a(r,X[o[1]]?X[o[1]].cipher_key:null);o[0]&&o[0](i,e,o[2]||o[1],n,o[1])}),timeout(o,x)}})}}var i=e.channel,s=e.channel_group,n=n||e.callback,n=n||e.message,u=e.connect||function(){},c=e.reconnect||function(){},f=e.disconnect||function(){},d=e.error||d||function(){},_=e.idle||function(){},b=e.presence||0,m=e.noheresync||0,w=e.backfill||0,k=e.timetoken||0,E=e.timeout||O,x=e.windowing||S,T=e.state,R=e.heartbeat||e.pnexpires,C=e.heartbeat_interval,P=e.restore||G;return A=e.auth_key||A,G=P,V=k,i||s?n?M?((R||0===R||C||0===C)&&me.set_heartbeat(R,C),i&&each((i.join?i.join(","):""+i).split(","),function(r){var o=X[r]||{};X[J=r]={name:r,connected:o.connected,disconnected:o.disconnected,subscribed:1,callback:K=n,cipher_key:e.cipher_key,connect:u,disconnect:f,reconnect:c},T&&(r in T?Q[r]=T[r]:Q[r]=T),b&&(me.subscribe({channel:r+PRESENCE_SUFFIX,callback:b,restore:P}),o.subscribed||m||me.here_now({channel:r,data:t({uuid:fe,auth:A}),callback:function(e){each("uuids"in e?e.uuids:[],function(t){b({action:"join",uuid:t,timestamp:Math.floor(rnow()/1e3),occupancy:e.occupancy||1},e,r)})}}))}),s&&each((s.join?s.join(","):""+s).split(","),function(r){var o=Y[r]||{};Y[r]={name:r,connected:o.connected,disconnected:o.disconnected,subscribed:1,callback:K=n,cipher_key:e.cipher_key,connect:u,disconnect:f,reconnect:c},b&&(me.subscribe({channel_group:r+PRESENCE_SUFFIX,callback:b,restore:P,auth_key:A}),o.subscribed||m||me.here_now({channel_group:r,data:t({uuid:fe,auth:A}),callback:function(e){each("uuids"in e?e.uuids:[],function(t){b({action:"join",uuid:t,timestamp:Math.floor(rnow()/1e3),occupancy:e.occupancy||1},e,r)})}}))}),L=function(){v(),timeout(o,x)},READY?void L():READY_BUFFER.push(L)):se("Missing Subscribe Key"):se("Missing Callback"):se("Missing Channel")},here_now:function(e,n){var n=e.callback||n,r=e.error||function(){},o=e.auth_key||A,i=e.channel,s=e.channel_group,u=ae(),a="uuids"in e?e.uuids:!0,c=e.state,l={uuid:fe,auth:o};if(a||(l.disable_uuids=1),c&&(l.state=1),!n)return se("Missing Callback");if(!M)return se("Missing Subscribe Key");var f=[F,"v2","presence","sub_key",M];i&&f.push("channel")&&f.push(encode(i)),"0"!=u&&(l.callback=u),s&&(l["channel-group"]=s,!i&&f.push("channel")&&f.push(",")),pe&&(l.instanceid=he),oe({callback:u,data:t(l),success:function(e){d(e,n,r)},fail:function(e){y(e,r)},url:f})},where_now:function(e,n){var n=e.callback||n,r=e.error||function(){},o=e.auth_key||A,i=ae(),s=e.uuid||fe,u={auth:o};return n?M?("0"!=i&&(u.callback=i),pe&&(u.instanceid=he),void oe({callback:i,data:t(u),success:function(e){d(e,n,r)},fail:function(e){y(e,r)},url:[F,"v2","presence","sub_key",M,"uuid",encode(s)]})):se("Missing Subscribe Key"):se("Missing Callback")},state:function(e,n){var r,n=e.callback||n||function(e){},o=e.error||function(){},i=e.auth_key||A,s=ae(),u=e.state,a=e.uuid||fe,c=e.channel,l=e.channel_group,f=t({auth:i});return M?a?c||l?("0"!=s&&(f.callback=s),"undefined"!=typeof c&&X[c]&&X[c].subscribed&&u&&(Q[c]=u),"undefined"!=typeof l&&Y[l]&&Y[l].subscribed&&(u&&(Q[l]=u),f["channel-group"]=l,c||(c=",")),f.state=JSON.stringify(u),pe&&(f.instanceid=he),r=u?[F,"v2","presence","sub-key",M,"channel",c,"uuid",a,"data"]:[F,"v2","presence","sub-key",M,"channel",c,"uuid",encode(a)],void oe({callback:s,data:t(f),success:function(e){d(e,n,o)},fail:function(e){y(e,o)},url:r})):se("Missing Channel"):se("Missing UUID"):se("Missing Subscribe Key")},grant:function(e,n){var n=e.callback||n,r=e.error||function(){},o=e.channel||e.channels,s=e.channel_group,u=ae(),a=e.ttl,c=e.read?"1":"0",l=e.write?"1":"0",f=e.manage?"1":"0",p=e.auth_key||e.auth_keys;if(!n)return se("Missing Callback");if(!M)return se("Missing Subscribe Key");if(!P)return se("Missing Publish Key");if(!j)return se("Missing Secret Key");var h=Math.floor((new Date).getTime()/1e3),_=M+"\n"+P+"\ngrant\n",b={w:l,r:c,timestamp:h};e.manage&&(b.m=f),isArray(o)&&(o=o.join(",")),isArray(p)&&(p=p.join(",")),"undefined"!=typeof o&&null!=o&&o.length>0&&(b.channel=o),"undefined"!=typeof s&&null!=s&&s.length>0&&(b["channel-group"]=s),"0"!=u&&(b.callback=u),(a||0===a)&&(b.ttl=a),p&&(b.auth=p),b=t(b),p||delete b.auth,_+=i(b);var m=B(_,j);m=m.replace(/\+/g,"-"),m=m.replace(/\//g,"_"),b.signature=m,oe({callback:u,data:b,success:function(e){d(e,n,r)},fail:function(e){y(e,r)},url:[F,"v1","auth","grant","sub-key",M]})},mobile_gw_provision:function(e){var t,n,r=e.callback||function(){},o=e.auth_key||A,i=e.error||function(){},s=ae(),u=e.channel,a=e.op,c=e.gw_type,l=e.device_id;return l?c?a?u?P?M?(n=[F,"v1/push/sub-key",M,"devices",l],t={uuid:fe,auth:o,type:c},"add"==a?t.add=u:"remove"==a&&(t.remove=u),pe&&(data.instanceid=he),void oe({callback:s,data:t,success:function(e){d(e,r,i)},fail:function(e){y(e,i)},url:n})):se("Missing Subscribe Key"):se("Missing Publish Key"):se("Missing gw destination Channel (channel)"):se("Missing GW Operation (op: add or remove)"):se("Missing GW Type (gw_type: gcm or apns)"):se("Missing Device ID (device_id)")},audit:function(e,n){var n=e.callback||n,r=e.error||function(){},o=e.channel,s=e.channel_group,u=e.auth_key,a=ae();if(!n)return se("Missing Callback");if(!M)return se("Missing Subscribe Key");if(!P)return se("Missing Publish Key");if(!j)return se("Missing Secret Key");var c=Math.floor((new Date).getTime()/1e3),l=M+"\n"+P+"\naudit\n",f={timestamp:c};"0"!=a&&(f.callback=a),"undefined"!=typeof o&&null!=o&&o.length>0&&(f.channel=o),"undefined"!=typeof s&&null!=s&&s.length>0&&(f["channel-group"]=s),u&&(f.auth=u),f=t(f),u||delete f.auth,l+=i(f);var p=B(l,j);p=p.replace(/\+/g,"-"),p=p.replace(/\//g,"_"),f.signature=p,oe({callback:a,data:f,success:function(e){d(e,n,r)},fail:function(e){y(e,r)},url:[F,"v1","auth","audit","sub-key",M]})},revoke:function(e,t){e.read=!1,e.write=!1,me.grant(e,t)},set_uuid:function(e){fe=e,L()},get_uuid:function(){return fe},isArray:function(e){return isArray(e)},get_subscibed_channels:function(){return generate_channel_list(X,!0)},presence_heartbeat:function(e){var n=e.callback||function(){},r=e.error||function(){},o=ae(),i={uuid:fe,auth:A},s=JSON.stringify(Q);s.length>2&&(i.state=JSON.stringify(Q)),Z>0&&320>Z&&(i.heartbeat=Z),"0"!=o&&(i.callback=o);var u=encode(generate_channel_list(X,!0).join(",")),a=generate_channel_group_list(Y,!0).join(",");u||(u=","),a&&(i["channel-group"]=a),pe&&(i.instanceid=he),oe({callback:o,data:t(i),timeout:5*SECOND,url:[F,"v2","presence","sub-key",M,"channel",u,"heartbeat"],success:function(e){d(e,n,r)},fail:function(e){y(e,r)}})},stop_timers:function(){clearTimeout(E),clearTimeout(x),clearTimeout($)},shutdown:function(){me.stop_timers(),de&&de()},xdr:oe,ready:ready,db:ce,uuid:generate_uuid,map:map,each:each,"each-channel":h,grep:grep,offline:function(){v(1,{message:"Offline. Please check your network settings."})},supplant:supplant,now:rnow,unique:unique,updater:updater};return fe||(fe=me.uuid()),he||(he=me.uuid()),ce.set(M+"uuid",fe),E=timeout(b,SECOND),x=timeout(m,T),$=timeout(l,(ee-3)*SECOND),w(),me}function crypto_obj(){function e(e){return CryptoJS.SHA256(e).toString(CryptoJS.enc.Hex)}function t(e){return e=e||{},e.hasOwnProperty("encryptKey")||(e.encryptKey=l.encryptKey),e.hasOwnProperty("keyEncoding")||(e.keyEncoding=l.keyEncoding),e.hasOwnProperty("keyLength")||(e.keyLength=l.keyLength),e.hasOwnProperty("mode")||(e.mode=l.mode),-1==u.indexOf(e.keyEncoding.toLowerCase())&&(e.keyEncoding=l.keyEncoding),-1==a.indexOf(parseInt(e.keyLength,10))&&(e.keyLength=l.keyLength),-1==c.indexOf(e.mode.toLowerCase())&&(e.mode=l.mode),e}function n(e,t){return"base64"==t.keyEncoding?CryptoJS.enc.Base64.parse(e):"hex"==t.keyEncoding?CryptoJS.enc.Hex.parse(e):e}function r(t,r){return t=n(t,r),r.encryptKey?CryptoJS.enc.Utf8.parse(e(t).slice(0,32)):t}function o(e){return"ecb"==e.mode?CryptoJS.mode.ECB:CryptoJS.mode.CBC}function i(e){return"cbc"==e.mode?CryptoJS.enc.Utf8.parse(s):null}var s="0123456789012345",u=["hex","utf8","base64","binary"],a=[128,256],c=["ecb","cbc"],l={encryptKey:!0,keyEncoding:"utf8",keyLength:256,mode:"cbc"};return{encrypt:function(e,n,s){if(!n)return e;s=t(s);var u=i(s),a=o(s),c=r(n,s),l=JSON.stringify(e),f=CryptoJS.AES.encrypt(l,c,{iv:u,mode:a}).ciphertext,p=f.toString(CryptoJS.enc.Base64);return p||e},decrypt:function(e,n,s){if(!n)return e;s=t(s);var u=i(s),a=o(s),c=r(n,s);try{var l=CryptoJS.enc.Base64.parse(e),f=CryptoJS.AES.decrypt({ciphertext:l},c,{iv:u,mode:a}).toString(CryptoJS.enc.Utf8),p=JSON.parse(f);return p}catch(h){return void 0}}}}window.JSON&&window.JSON.stringify||function(){function toJSON(e){try{return this.valueOf()}catch(t){return null}}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,o,i,s,u=gap,a=t[e];switch(a&&"object"==typeof a&&(a=toJSON.call(a,e)),"function"==typeof rep&&(a=rep.call(t,e,a)),typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(a)){for(i=a.length,n=0;i>n;n+=1)s[n]=str(n,a)||"null";return o=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+u+"]":"["+s.join(",")+"]",gap=u,o}if(rep&&"object"==typeof rep)for(i=rep.length,n=0;i>n;n+=1)r=rep[n],"string"==typeof r&&(o=str(r,a),o&&s.push(quote(r)+(gap?": ":":")+o));else for(r in a)Object.hasOwnProperty.call(a,r)&&(o=str(r,a),o&&s.push(quote(r)+(gap?": ":":")+o));return o=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+u+"}":"{"+s.join(",")+"}",gap=u,o}}window.JSON||(window.JSON={});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;n>r;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text){return eval("("+text+")")})}();var NOW=1,READY=!1,READY_BUFFER=[],PRESENCE_SUFFIX="-pnpres",DEF_WINDOWING=10,DEF_TIMEOUT=1e4,DEF_SUB_TIMEOUT=310,DEF_KEEPALIVE=60,SECOND=1e3,URLBIT="/",PARAMSBIT="&",PRESENCE_HB_THRESHOLD=5,PRESENCE_HB_DEFAULT=30,SDK_VER="3.7.14",REPL=/{([\w\-]+)}/g,nextorigin=function(){var e=20,t=Math.floor(Math.random()*e);return function(n,r){return n.indexOf("pubsub.")>0&&n.replace("pubsub","ps"+(r?generate_uuid().split("-")[0]:++t<e?t:t=1))||n}}();window.PUBNUB||function(){function e(e,t){var n=CryptoJS.HmacSHA256(e,t);return n.toString(CryptoJS.enc.Base64)}function t(e){return document.getElementById(e)}function n(e){console.error(e)}function r(e,t){var n=[];return each(e.split(/\s+/),function(e){each((t||document).getElementsByTagName(e),function(e){n.push(e)})}),n}function o(e,t,n){each(e.split(","),function(e){var r=function(e){e||(e=window.event),n(e)||(e.cancelBubble=!0,e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation())};t.addEventListener?t.addEventListener(e,r,!1):t.attachEvent?t.attachEvent("on"+e,r):t["on"+e]=r})}function i(){return r("head")[0]}function s(e,t,n){return n?void e.setAttribute(t,n):e&&e.getAttribute&&e.getAttribute(t)}function u(e,t){for(var n in t)if(t.hasOwnProperty(n))try{e.style[n]=t[n]+("|width|height|top|left|".indexOf(n)>0&&"number"==typeof t[n]?"px":"")}catch(r){}}function a(e){return document.createElement(e)}function c(){return v||d()?0:unique()}function l(e){if(v||d())return f(e);var n=a("script"),r=e.callback,o=unique(),u=0,c=e.timeout||DEF_TIMEOUT,l=timeout(function(){m(1,{message:"timeout"})},c),p=e.fail||function(){},h=e.data||{},y=e.success||function(){},b=function(){i().appendChild(n)},m=function(e,r){u||(u=1,n.onerror=null,clearTimeout(l),e||!r||y(r),timeout(function(){e&&p();var n=t(o),r=n&&n.parentNode;r&&r.removeChild(n)},SECOND))};return window[r]=function(e){m(0,e)},e.blocking||(n[_]=_),n.onerror=function(){m(1)},n.src=build_url(e.url,h),s(n,"id",o),b(),m}function f(e){var t,n,r=function(){if(!i){i=1,clearTimeout(u);try{n=JSON.parse(t.responseText)}catch(e){return h(1)}o=1,f(n)}},o=0,i=0,s=e.timeout||DEF_TIMEOUT,u=timeout(function(){h(1,{message:"timeout"})},s),a=e.fail||function(){},c=e.data||{},f=e.success||function(){},p=!e.blocking,h=function(e,n){o||(o=1,clearTimeout(u),t&&(t.onerror=t.onload=null,t.abort&&t.abort(),t=null),e&&a(n))};try{t=d()||window.XDomainRequest&&new XDomainRequest||new XMLHttpRequest,t.onerror=t.onabort=function(e){h(1,e||t&&t.responseText||{error:"Network Connection Error"})},t.onload=t.onloadend=r,t.onreadystatechange=function(){if(t&&4==t.readyState)switch(t.status){case 200:break;default:try{n=JSON.parse(t.responseText),h(1,n)}catch(e){return h(1,{status:t.status,payload:null,message:t.responseText})}return}};var y=build_url(e.url,c);t.open("GET",y,p),p&&(t.timeout=s),t.send()}catch(_){return h(0),v=0,l(e)}return h}function p(){if(!("onLine"in navigator))return 1;try{return navigator.onLine}catch(e){return!0}}function h(e){return"sendBeacon"in navigator?navigator.sendBeacon(e):!1}function d(){if(!S||!S.get)return 0;var e={id:d.id++,send:function(){},abort:function(){e.id={}},open:function(t,n){d[e.id]=e,S.get(e.id,n)}};return e}var y="https://pubnub.a.ssl.fastly.net/pubnub.swf",_="async",b=navigator.userAgent,m="PubNub-JS-Web/3.7.14",v=-1==b.indexOf("MSIE 6");window.console||(window.console=window.console||{}),console.log||(console.log=console.error=(window.opera||{}).postError||function(){});var g=function(){var e={},t=!1;try{t=window.localStorage}catch(n){}var r=function(e){return-1==document.cookie.indexOf(e)?null:((document.cookie||"").match(RegExp(e+"=([^;]+)"))||[])[1]||null},o=function(e,t){document.cookie=e+"="+t+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"},i=function(){try{return o("pnctest","1"),"1"===r("pnctest")}catch(e){return!1}}();return{get:function(n){try{return t?t.getItem(n):i?r(n):e[n]}catch(o){return e[n]}},set:function(n,r){try{if(t)return t.setItem(n,r)&&0;i&&o(n,r),e[n]=r}catch(s){e[n]=r}}}}(),w={list:{},unbind:function(e){w.list[e]=[]},bind:function(e,t){(w.list[e]=w.list[e]||[]).push(t)},fire:function(e,t){each(w.list[e]||[],function(e){e(t)})}},k=t("pubnub")||0,E=function(f){v=f.jsonp?0:-1==b.indexOf("MSIE 6");var d=f.subscribe_key||"",y=((+f.keepalive||DEF_KEEPALIVE)*SECOND,f.uuid||g.get(d+"uuid")||"",f.leave_on_unload||0);f.xdr=l,f.db=g,f.error=f.error||n,f._is_online=p,f.jsonp_cb=c,f.hmac_SHA256=e,f.crypto_obj=crypto_obj(),f.sendBeacon=h,f.params={pnsdk:m};var _=function(e){return E(e)},k=PN_API(f);for(var x in k)k.hasOwnProperty(x)&&(_[x]=k[x]);return _.css=u,_.$=t,_.create=a,_.bind=o,_.head=i,_.search=r,_.attr=s,_.events=w,_.init=_,_.secure=_,_.crypto_obj=crypto_obj(),o("beforeunload",window,function(){return y&&_["each-channel"](function(e){_.LEAVE(e.name,0)}),!0}),f.notest?_:(o("offline",window,_.offline),o("offline",document,_.offline),_)};E.init=E,E.secure=E,E.crypto_obj=crypto_obj(),"complete"===document.readyState?timeout(ready,0):o("load",window,function(){timeout(ready,0)});var x=k||{};PUBNUB=E({notest:1,publish_key:s(x,"pub-key"),subscribe_key:s(x,"sub-key"),ssl:!document.location.href.indexOf("https")||"on"==s(x,"ssl"),origin:s(x,"origin"),uuid:s(x,"uuid")}),window.jQuery&&(window.jQuery.PUBNUB=E),"undefined"!=typeof module&&(module.exports=PUBNUB)&&ready();var S=t("pubnubs")||0;k&&(u(k,{position:"absolute",top:-SECOND}),("opera"in window||s(k,"flash"))&&(k.innerHTML="<object id=pubnubs data="+y+"><param name=movie value="+y+"><param name=allowscriptaccess value=always></object>"),PUBNUB.rdx=function(e,t){return t?(d[e].responseText=unescape(t),void d[e].onload()):d[e].onerror()},d.id=SECOND)}(),function(){var e=PUBNUB.ws=function(t,n){if(!(this instanceof e))return new e(t,n);var r=this,t=r.url=t||"",o=(r.protocol=n||"Sec-WebSocket-Protocol",t.split("/")),i={ssl:"wss:"===o[0],origin:o[2],publish_key:o[3],subscribe_key:o[4],channel:o[5]};return r.CONNECTING=0,r.OPEN=1,r.CLOSING=2,r.CLOSED=3,r.CLOSE_NORMAL=1e3,r.CLOSE_GOING_AWAY=1001,r.CLOSE_PROTOCOL_ERROR=1002,r.CLOSE_UNSUPPORTED=1003,r.CLOSE_TOO_LARGE=1004,r.CLOSE_NO_STATUS=1005,r.CLOSE_ABNORMAL=1006,r.onclose=r.onerror=r.onmessage=r.onopen=r.onsend=function(){},r.binaryType="",r.extensions="",r.bufferedAmount=0,r.trasnmitting=!1,r.buffer=[],r.readyState=r.CONNECTING,t?(r.pubnub=PUBNUB.init(i),r.pubnub.setup=i,r.setup=i,void r.pubnub.subscribe({restore:!1,channel:i.channel,disconnect:r.onerror,reconnect:r.onopen,error:function(){r.onclose({code:r.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!1})},callback:function(e){r.onmessage({data:e})},connect:function(){r.readyState=r.OPEN,r.onopen()}})):(r.readyState=r.CLOSED,r.onclose({code:r.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!0}),r)};e.prototype.send=function(e){var t=this;t.pubnub.publish({channel:t.pubnub.setup.channel,message:e,callback:function(e){t.onsend({data:e})}})},e.prototype.close=function(){var e=this;e.pubnub.unsubscribe({channel:e.pubnub.setup.channel}),e.readyState=e.CLOSED,e.onclose({})}}();var CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},o=function(){},i=r.Base={extend:function(e){o.prototype=this;var t=new o;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=r.WordArray=i.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var o=0;e>o;o++)t[r+o>>>2]|=(n[o>>>2]>>>24-8*(o%4)&255)<<24-8*((r+o)%4);else if(65535<n.length)for(o=0;e>o;o+=4)t[r+o>>>2]=n[o>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;t>r;r+=4)n.push(4294967296*e.random()|0);return new s.init(n,t)}}),u=n.enc={},a=u.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;e>r;r++){var o=t[r>>>2]>>>24-8*(r%4)&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;t>r;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new s.init(n,t/2)}},c=u.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;e>r;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;t>r;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-8*(r%4);return new s.init(n,t)}},l=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},f=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,o=n.sigBytes,i=this.blockSize,u=o/(4*i),u=t?e.ceil(u):e.max((0|u)-this._minBufferSize,0);if(t=u*i,o=e.min(4*t,o),t){for(var a=0;t>a;a+=i)this._doProcessBlock(r,a);a=r.splice(0,t),n.sigBytes-=o}return new s.init(a,o)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=f.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new p.HMAC.init(e,n).finalize(t)}}});var p=n.algo={};return n}(Math);!function(e){for(var t=CryptoJS,n=t.lib,r=n.WordArray,o=n.Hasher,n=t.algo,i=[],s=[],u=function(e){return 4294967296*(e-(0|e))|0},a=2,c=0;64>c;){var l;e:{l=a;for(var f=e.sqrt(l),p=2;f>=p;p++)if(!(l%p)){l=!1;break e}l=!0}l&&(8>c&&(i[c]=u(e.pow(a,.5))),s[c]=u(e.pow(a,1/3)),c++),a++}var h=[],n=n.SHA256=o.extend({_doReset:function(){this._hash=new r.init(i.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],u=n[3],a=n[4],c=n[5],l=n[6],f=n[7],p=0;64>p;p++){if(16>p)h[p]=0|e[t+p];else{var d=h[p-15],y=h[p-2];h[p]=((d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3)+h[p-7]+((y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10)+h[p-16]}d=f+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&c^~a&l)+s[p]+h[p],y=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&o^r&i^o&i),f=l,l=c,c=a,a=u+d|0,u=i,i=o,o=r,r=d+y|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+u|0,n[4]=n[4]+a|0,n[5]=n[5]+c|0,n[6]=n[6]+l|0,n[7]=n[7]+f|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;return n[o>>>5]|=128<<24-o%32,n[(o+64>>>9<<4)+14]=e.floor(r/4294967296),n[(o+64>>>9<<4)+15]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(n),t.HmacSHA256=o._createHmacHelper(n)}(Math),function(){var e=CryptoJS,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,n){e=this._hasher=new e.init,"string"==typeof n&&(n=t.parse(n));var r=e.blockSize,o=4*r;n.sigBytes>o&&(n=e.finalize(n)),n.clamp();for(var i=this._oKey=n.clone(),s=this._iKey=n.clone(),u=i.words,a=s.words,c=0;r>c;c++)u[c]^=1549556828,a[c]^=909522486;i.sigBytes=s.sigBytes=o,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),function(){var e=CryptoJS,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp(),e=[];for(var o=0;n>o;o+=3)for(var i=(t[o>>>2]>>>24-8*(o%4)&255)<<16|(t[o+1>>>2]>>>24-8*((o+1)%4)&255)<<8|t[o+2>>>2]>>>24-8*((o+2)%4)&255,s=0;4>s&&n>o+.75*s;s++)e.push(r.charAt(i>>>6*(3-s)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var n=e.length,r=this._map,o=r.charAt(64);o&&(o=e.indexOf(o),-1!=o&&(n=o));for(var o=[],i=0,s=0;n>s;s++)if(s%4){var u=r.indexOf(e.charAt(s-1))<<2*(s%4),a=r.indexOf(e.charAt(s))>>>6-2*(s%4);o[i>>>2]|=(u|a)<<24-8*(i%4),i++}return t.create(o,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,n,r,o,i,s){return e=e+(t&n|~t&r)+o+s,(e<<i|e>>>32-i)+t}function n(e,t,n,r,o,i,s){return e=e+(t&r|n&~r)+o+s,(e<<i|e>>>32-i)+t}function r(e,t,n,r,o,i,s){return e=e+(t^n^r)+o+s,(e<<i|e>>>32-i)+t}function o(e,t,n,r,o,i,s){return e=e+(n^(t|~r))+o+s,(e<<i|e>>>32-i)+t}for(var i=CryptoJS,s=i.lib,u=s.WordArray,a=s.Hasher,s=i.algo,c=[],l=0;64>l;l++)c[l]=4294967296*e.abs(e.sin(l+1))|0;s=s.MD5=a.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,i){for(var s=0;16>s;s++){var u=i+s,a=e[u];e[u]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var s=this._hash.words,u=e[i+0],a=e[i+1],l=e[i+2],f=e[i+3],p=e[i+4],h=e[i+5],d=e[i+6],y=e[i+7],_=e[i+8],b=e[i+9],m=e[i+10],v=e[i+11],g=e[i+12],w=e[i+13],k=e[i+14],E=e[i+15],x=s[0],S=s[1],O=s[2],T=s[3],x=t(x,S,O,T,u,7,c[0]),T=t(T,x,S,O,a,12,c[1]),O=t(O,T,x,S,l,17,c[2]),S=t(S,O,T,x,f,22,c[3]),x=t(x,S,O,T,p,7,c[4]),T=t(T,x,S,O,h,12,c[5]),O=t(O,T,x,S,d,17,c[6]),S=t(S,O,T,x,y,22,c[7]),x=t(x,S,O,T,_,7,c[8]),T=t(T,x,S,O,b,12,c[9]),O=t(O,T,x,S,m,17,c[10]),S=t(S,O,T,x,v,22,c[11]),x=t(x,S,O,T,g,7,c[12]),T=t(T,x,S,O,w,12,c[13]),O=t(O,T,x,S,k,17,c[14]),S=t(S,O,T,x,E,22,c[15]),x=n(x,S,O,T,a,5,c[16]),T=n(T,x,S,O,d,9,c[17]),O=n(O,T,x,S,v,14,c[18]),S=n(S,O,T,x,u,20,c[19]),x=n(x,S,O,T,h,5,c[20]),T=n(T,x,S,O,m,9,c[21]),O=n(O,T,x,S,E,14,c[22]),S=n(S,O,T,x,p,20,c[23]),x=n(x,S,O,T,b,5,c[24]),T=n(T,x,S,O,k,9,c[25]),O=n(O,T,x,S,f,14,c[26]),S=n(S,O,T,x,_,20,c[27]),x=n(x,S,O,T,w,5,c[28]),T=n(T,x,S,O,l,9,c[29]),O=n(O,T,x,S,y,14,c[30]),S=n(S,O,T,x,g,20,c[31]),x=r(x,S,O,T,h,4,c[32]),T=r(T,x,S,O,_,11,c[33]),O=r(O,T,x,S,v,16,c[34]),S=r(S,O,T,x,k,23,c[35]),x=r(x,S,O,T,a,4,c[36]),T=r(T,x,S,O,p,11,c[37]),O=r(O,T,x,S,y,16,c[38]),S=r(S,O,T,x,m,23,c[39]),x=r(x,S,O,T,w,4,c[40]),T=r(T,x,S,O,u,11,c[41]),O=r(O,T,x,S,f,16,c[42]),S=r(S,O,T,x,d,23,c[43]),x=r(x,S,O,T,b,4,c[44]),T=r(T,x,S,O,g,11,c[45]),O=r(O,T,x,S,E,16,c[46]),S=r(S,O,T,x,l,23,c[47]),x=o(x,S,O,T,u,6,c[48]),T=o(T,x,S,O,y,10,c[49]),O=o(O,T,x,S,k,15,c[50]),S=o(S,O,T,x,h,21,c[51]),x=o(x,S,O,T,g,6,c[52]),T=o(T,x,S,O,f,10,c[53]),O=o(O,T,x,S,m,15,c[54]),S=o(S,O,T,x,a,21,c[55]),x=o(x,S,O,T,_,6,c[56]),T=o(T,x,S,O,E,10,c[57]),O=o(O,T,x,S,d,15,c[58]),S=o(S,O,T,x,w,21,c[59]),x=o(x,S,O,T,p,6,c[60]),T=o(T,x,S,O,v,10,c[61]),O=o(O,T,x,S,l,15,c[62]),S=o(S,O,T,x,b,21,c[63]);s[0]=s[0]+x|0,s[1]=s[1]+S|0,s[2]=s[2]+O|0,s[3]=s[3]+T|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;n[o>>>5]|=128<<24-o%32;var i=e.floor(r/4294967296);for(n[(o+64>>>9<<4)+15]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[(o+64>>>9<<4)+14]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process(),t=this._hash,n=t.words,r=0;4>r;r++)o=n[r],n[r]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8);return t},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),i.MD5=a._createHelper(s),i.HmacMD5=a._createHmacHelper(s)}(Math),function(){var e=CryptoJS,t=e.lib,n=t.Base,r=t.WordArray,t=e.algo,o=t.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,o=n.hasher.create(),i=r.create(),s=i.words,u=n.keySize,n=n.iterations;s.length<u;){a&&o.update(a);var a=o.update(e).finalize(t);o.reset();for(var c=1;n>c;c++)a=o.finalize(a),o.reset();i.concat(a)}return i.sigBytes=4*u,i}});e.EvpKDF=function(e,t,n){return o.create(n).compute(e,t)}}(),CryptoJS.lib.Cipher||function(e){var t=CryptoJS,n=t.lib,r=n.Base,o=n.WordArray,i=n.BufferedBlockAlgorithm,s=t.enc.Base64,u=t.algo.EvpKDF,a=n.Cipher=i.extend({cfg:r.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,r){return("string"==typeof n?d:h).encrypt(e,t,n,r)},decrypt:function(t,n,r){return("string"==typeof n?d:h).decrypt(e,t,n,r)}}}});n.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=t.mode={},l=function(t,n,r){var o=this._iv;o?this._iv=e:o=this._prevBlock;for(var i=0;r>i;i++)t[n+i]^=o[i]},f=(n.BlockCipherMode=r.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();f.Encryptor=f.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;l.call(this,e,t,r),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),f.Decryptor=f.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,o=e.slice(t,t+r);n.decryptBlock(e,t),l.call(this,e,t,r),this._prevBlock=o}}),c=c.CBC=f,f=(t.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,n=n-e.sigBytes%n,r=n<<24|n<<16|n<<8|n,i=[],s=0;n>s;s+=4)i.push(r);n=o.create(i,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},n.BlockCipher=a.extend({cfg:a.cfg.extend({mode:c,padding:f}),reset:function(){a.reset.call(this);var e=this.cfg,t=e.iv,e=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=e.createEncryptor;else n=e.createDecryptor,this._minBufferSize=1;this._mode=n.call(e,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var p=n.CipherParams=r.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),c=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return e=e.salt,(e?o.create([1398893684,1701076831]).concat(e).concat(t):t).toString(s)},parse:function(e){e=s.parse(e);var t=e.words;if(1398893684==t[0]&&1701076831==t[1]){var n=o.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return p.create({ciphertext:e,salt:n})}},h=n.SerializableCipher=r.extend({cfg:r.extend({format:c}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var o=e.createEncryptor(n,r);return t=o.finalize(t),o=o.cfg,p.create({ciphertext:t,key:n,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),t=(t.kdf={}).OpenSSL={execute:function(e,t,n,r){return r||(r=o.random(8)),e=u.create({keySize:t+n}).compute(e,r),n=o.create(e.words.slice(t),4*n),e.sigBytes=4*t,p.create({key:e,iv:n,salt:r})}},d=n.PasswordBasedCipher=h.extend({cfg:h.cfg.extend({kdf:t}),encrypt:function(e,t,n,r){return r=this.cfg.extend(r),n=r.kdf.execute(n,e.keySize,e.ivSize),r.iv=n.iv,e=h.encrypt.call(this,e,t,n.key,r),e.mixIn(n),e},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt),r.iv=n.iv,h.decrypt.call(this,e,t,n.key,r)}})}(),function(){for(var e=CryptoJS,t=e.lib.BlockCipher,n=e.algo,r=[],o=[],i=[],s=[],u=[],a=[],c=[],l=[],f=[],p=[],h=[],d=0;256>d;d++)h[d]=128>d?d<<1:d<<1^283;for(var y=0,_=0,d=0;256>d;d++){var b=_^_<<1^_<<2^_<<3^_<<4,b=b>>>8^255&b^99;r[y]=b,o[b]=y;var m=h[y],v=h[m],g=h[v],w=257*h[b]^16843008*b;i[y]=w<<24|w>>>8,s[y]=w<<16|w>>>16,u[y]=w<<8|w>>>24,a[y]=w,w=16843009*g^65537*v^257*m^16843008*y,c[b]=w<<24|w>>>8,l[b]=w<<16|w>>>16,f[b]=w<<8|w>>>24,p[b]=w,y?(y=m^h[h[h[g^m]]],_^=h[h[_]]):y=_=1}var k=[0,1,2,4,8,16,32,64,128,27,54],n=n.AES=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes/4,e=4*((this._nRounds=n+6)+1),o=this._keySchedule=[],i=0;e>i;i++)if(n>i)o[i]=t[i];else{var s=o[i-1];i%n?n>6&&4==i%n&&(s=r[s>>>24]<<24|r[s>>>16&255]<<16|r[s>>>8&255]<<8|r[255&s]):(s=s<<8|s>>>24,s=r[s>>>24]<<24|r[s>>>16&255]<<16|r[s>>>8&255]<<8|r[255&s],s^=k[i/n|0]<<24),o[i]=o[i-n]^s}for(t=this._invKeySchedule=[],n=0;e>n;n++)i=e-n,s=n%4?o[i]:o[i-4],t[n]=4>n||4>=i?s:c[r[s>>>24]]^l[r[s>>>16&255]]^f[r[s>>>8&255]]^p[r[255&s]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,i,s,u,a,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,c,l,f,p,o),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,o,i,s,u){for(var a=this._nRounds,c=e[t]^n[0],l=e[t+1]^n[1],f=e[t+2]^n[2],p=e[t+3]^n[3],h=4,d=1;a>d;d++)var y=r[c>>>24]^o[l>>>16&255]^i[f>>>8&255]^s[255&p]^n[h++],_=r[l>>>24]^o[f>>>16&255]^i[p>>>8&255]^s[255&c]^n[h++],b=r[f>>>24]^o[p>>>16&255]^i[c>>>8&255]^s[255&l]^n[h++],p=r[p>>>24]^o[c>>>16&255]^i[l>>>8&255]^s[255&f]^n[h++],c=y,l=_,f=b;
y=(u[c>>>24]<<24|u[l>>>16&255]<<16|u[f>>>8&255]<<8|u[255&p])^n[h++],_=(u[l>>>24]<<24|u[f>>>16&255]<<16|u[p>>>8&255]<<8|u[255&c])^n[h++],b=(u[f>>>24]<<24|u[p>>>16&255]<<16|u[c>>>8&255]<<8|u[255&l])^n[h++],p=(u[p>>>24]<<24|u[c>>>16&255]<<16|u[l>>>8&255]<<8|u[255&f])^n[h++],e[t]=y,e[t+1]=_,e[t+2]=b,e[t+3]=p},keySize:8});e.AES=t._createHelper(n)}(),CryptoJS.mode.ECB=function(){var e=CryptoJS.lib.BlockCipherMode.extend();return e.Encryptor=e.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),e.Decryptor=e.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),e}()}).call(exports,__webpack_require__(7)(module))},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,r){n(this,e),this.setPrefix(r),this._storage=t}return r(e,null,[{key:"defaultPrefix",value:"rc-",enumerable:!0}]),e.prototype.setPrefix=function(t){return this._prefix=t||e.defaultPrefix,this},e.prototype.setItem=function(e,t){return this._storage[this._prefixKey(e)]=JSON.stringify(t),this},e.prototype.removeItem=function(e){return delete this._storage[this._prefixKey(e)],this},e.prototype.getItem=function(e){var t=this._storage[this._prefixKey(e)];return t?JSON.parse(t):null},e.prototype.clean=function(){for(var e in this._storage)this._storage.hasOwnProperty(e)&&0===e.indexOf(this._prefix)&&delete this._storage[e];return this},e.prototype._prefixKey=function(e){return this._prefix+e},e}();t["default"]=o,e.exports=t["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var r=function(){function e(){n(this,e),this.off()}return e.prototype.hasListeners=function(e){return e in this._listeners},e.prototype.on=function(e,t){var n=this;if("string"==typeof e&&(e=[e]),!e)throw new Error("No events to subscribe to");if("function"!=typeof t)throw new Error("Callback must be a function");return e.forEach(function(e){n.hasListeners(e)||(n._listeners[e]=[]),n._listeners[e].push(t)}),this},e.prototype.emit=function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),o=1;n>o;o++)r[o-1]=arguments[o];var i=null;return this.hasListeners(e)?(this._listeners[e].some(function(e){return i=e.apply(t,r),i===!1}),i):null},e.prototype.off=function(e,t){var n=this;if(e)if(t){if(!this.hasListeners(e))return this;this._listeners[e].forEach(function(r,o){r===t&&delete n._listeners[e][o]})}else delete this._listeners[e];else this._listeners={};return this},e}();t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(3),s=n(2),u=function(){function e(t,n){r(this,e),this._cache=t,this._cacheId=n,this._promise=null}return o(e,null,[{key:"_pollInterval",value:250,enumerable:!0},{key:"_releaseTimeout",value:5e3,enumerable:!0}]),e.prototype.isPaused=function(){var t=this._cache.getItem(this._cacheId);return!!t&&Date.now()-parseInt(t)<e._releaseTimeout},e.prototype.pause=function(){return this._cache.setItem(this._cacheId,Date.now()),this},e.prototype.resume=function(){return this._cache.removeItem(this._cacheId),this},e.prototype.poll=function(){var t=this;return this._promise?this._promise:(this._promise=new i.Promise(function(n,r){s.poll(function(e){return t.isPaused()?e():(t._promise=null,t.resume(),void n(null))},e._pollInterval)}),this._promise)},e}();t["default"]=u,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(3),a=n(2),c=n(15),l=n(12),f=r(l),p=n(16),h=r(p),d=function(e){function t(){o(this,t),e.apply(this,arguments),this.events={beforeRequest:"beforeRequest",requestSuccess:"requestSuccess",requestError:"requestError"}}return i(t,e),t.prototype.sendRequest=function(e){var t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return t=new h["default"](e),n.prev=1,this.emit(this.events.beforeRequest,t),n.next=5,regeneratorRuntime.awrap(this._loadResponse(e));case 5:if(t._response=n.sent,!t._isMultipart()&&!t._isJson()){n.next=10;break}return n.next=9,regeneratorRuntime.awrap(t.response().text());case 9:t._text=n.sent;case 10:if(t.ok()){n.next=12;break}throw new Error("Response has unsuccessful status");case 12:return this.emit(this.events.requestSuccess,t),n.abrupt("return",t);case 16:throw n.prev=16,n.t0=n["catch"](1),n.t0.apiResponse||(n.t0=this.makeError(n.t0,t)),this.emit(this.events.requestError,n.t0),n.t0;case 21:case"end":return n.stop()}},null,this,[[1,16]])},t.prototype._loadResponse=function(e){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(u.fetch.call(null,e));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},null,this)},t.prototype.makeError=function(e,t){return e.hasOwnProperty("apiResponse")||e.hasOwnProperty("originalMessage")||(e.apiResponse=t,e.originalMessage=e.message,e.message=t&&t.error(!0)||e.originalMessage),e},t.prototype.createRequest=function(e){if(e=e||{},e.headers=e.headers||{},!e.url)throw new Error("Url is not defined");if(e.method||(e.method="GET"),e.method&&t._allowedMethods.indexOf(e.method)<0)throw new Error("Method has wrong value: "+e.method);if(e.credentials=e.credentials||"include",e.mode=e.mode||"cors",e.query&&(e.url=e.url+(e.url.indexOf("?")>-1?"&":"?")+a.queryStringify(e.query)),c.findHeaderName("Accept",e.headers)||(e.headers.Accept=h["default"]._jsonContentType),"string"!=typeof e.body||!e.body){var n=c.findHeaderName(h["default"]._contentType,e.headers);n||(n=h["default"]._contentType,e.headers[n]=h["default"]._jsonContentType);var r=e.headers[n];r.indexOf(h["default"]._jsonContentType)>-1?e.body=JSON.stringify(e.body):r.indexOf(h["default"]._urlencodedContentType)>-1&&(e.body=a.queryStringify(e.body))}var o=new u.Request(e.url,e);return o.originalBody=e.body,o},s(t,null,[{key:"_allowedMethods",value:["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"],enumerable:!0}]),t}(f["default"]);t["default"]=d,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e,t){t=t||{};var n=new s.Response(e,t);return a.isNodeJS()&&(n._text=e,n._decode=function(){return this._text}),n}function i(e,t){return e=e.toLowerCase(),Object.keys(t).reduce(function(t,n){return t?t:e==n.toLowerCase()?n:t},null)}t.__esModule=!0,t.createResponse=o,t.findHeaderName=i;var s=n(3),u=n(2),a=r(u)},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(3),u=n(15),a=r(u),c=function(){function e(t,n,r){o(this,e),this._request=t,this._response=n,this._text=r,this._json=null,this._multipart=[]}return i(e,null,[{key:"_contentType",value:"Content-Type",enumerable:!0},{key:"_jsonContentType",value:"application/json",enumerable:!0},{key:"_multipartContentType",value:"multipart/mixed",enumerable:!0},{key:"_urlencodedContentType",value:"application/x-www-form-urlencoded",enumerable:!0},{key:"_headerSeparator",value:":",enumerable:!0},{key:"_bodySeparator",value:"\n\n",enumerable:!0},{key:"_boundarySeparator",value:"--",enumerable:!0}]),e.prototype.response=function(){return this._response},e.prototype.request=function(){return this._request},e.prototype.ok=function(){return this._response&&this._response.ok},e.prototype.text=function(){if(!this._isJson()&&!this._isMultipart())throw new Error("Response is not text");return this._text},e.prototype.json=function(){if(!this._isJson())throw new Error("Response is not JSON");return this._json||(this._json=this._text?JSON.parse(this._text):null),this._json},e.prototype.error=function(e){if(this.ok()&&!e)return null;var t=(this._response&&this._response.status?this._response.status+" ":"")+(this._response&&this._response.statusText?this._response.statusText:"");try{this.json().message&&(t=this.json().message),this.json().error_description&&(t=this.json().error_description),this.json().description&&(t=this.json().description)}catch(n){}return t},e.prototype.multipart=function(){if(!this._isMultipart())throw new Error("Response is not multipart");if(!this._multipart.length){var t=this.text();if(!t)throw new Error("No response body");var n=this._getContentType().match(/boundary=([^;]+)/i)[1];if(!n)throw new Error("Cannot find boundary");var r=t.toString().split(e._boundarySeparator+n);if(""===r[0].trim()&&r.shift(),r[r.length-1].trim()==e._boundarySeparator&&r.pop(),r.length<1)throw new Error("No parts in body");var o=e.create(r.shift(),this._response.status,this._response.statusText).json();this._multipart=r.map(function(t,n){var r=o.response[n].status;return e.create(t,r)})}return this._multipart},e.prototype._isContentType=function(e){return this._getContentType().indexOf(e)>-1},e.prototype._getContentType=function(){return this._response.headers.get(e._contentType)||""},e.prototype._isMultipart=function(){return this._isContentType(e._multipartContentType)},e.prototype._isUrlEncoded=function(){return this._isContentType(e._urlencodedContentType)},e.prototype._isJson=function(){return this._isContentType(e._jsonContentType)},e.create=function(t,n,r){t=t||"",n=n||200,r=r||"OK",t=t.replace(/\r/g,"");var o=new s.Headers,i=t.split(e._bodySeparator),u=i.length>1?i.shift():"";return t=i.join(e._bodySeparator),(u||"").split("\n").forEach(function(t){var n=t.trim().split(e._headerSeparator),r=n.shift().trim(),i=n.join(e._headerSeparator).trim();r&&o.append(r,i)}),new e(null,a.createResponse(t,{headers:o,status:n,statusText:r}),t)},e}();t["default"]=c,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=n(18),u=r(s),a=n(14),c=r(a),l=function(e){function t(){o(this,t),e.call(this),this._registry=new u["default"]}return i(t,e),t.prototype.registry=function(){return this._registry},t.prototype._loadResponse=function(e){var t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return t=this._registry.find(e),n.next=3,regeneratorRuntime.awrap(t.getResponse(e));case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}},null,this)},t}(c["default"]);t["default"]=l,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=n(19),s=r(i),u=function(){function e(){o(this,e),this._mocks=[]}return e.prototype.add=function(e){return this._mocks.push(e),this},e.prototype.clear=function(){return this._mocks=[],this},e.prototype.find=function(e){var t=this._mocks.shift();if(!t)throw new Error("No mock in registry for request "+e.method+" "+e.url);if(!t.test(e))throw new Error("Wrong request "+e.method+" "+e.url+" for expected mock "+t.method()+" "+t.path());return t},e.prototype.apiCall=function(e,t,n,r,o){return this.add(new s["default"](e,t,n,r,o)),this},e.prototype.authentication=function(){return this.apiCall("POST","/restapi/oauth/token",{access_token:"ACCESS_TOKEN",token_type:"bearer",expires_in:3600,refresh_token:"REFRESH_TOKEN",refresh_token_expires_in:60480,scope:"SMS RCM Foo Boo",expireTime:(new Date).getTime()+36e5}),this},e.prototype.logout=function(){return this.apiCall("POST","/restapi/oauth/revoke",{}),this},e.prototype.presenceLoad=function(e){return this.apiCall("GET","/restapi/v1.0/account/~/extension/"+e+"/presence",{uri:"https://platform.ringcentral.com/restapi/v1.0/account/123/extension/"+e+"/presence",extension:{uri:"https://platform.ringcentral.com/restapi/v1.0/account/123/extension/"+e,id:e,extensionNumber:"101"},activeCalls:[],presenceStatus:"Available",telephonyStatus:"Ringing",userStatus:"Available",dndStatus:"TakeAllCalls",extensionId:e}),this},e.prototype.subscribeGeneric=function(e){e=e||54e3;var t=new Date;return this.apiCall("POST","/restapi/v1.0/subscription",{eventFilters:["/restapi/v1.0/account/~/extension/~/presence"],expirationTime:new Date(t.getTime()+1e3*e).toISOString(),expiresIn:e,deliveryMode:{transportType:"PubNub",encryption:!1,address:"123_foo",subscriberKey:"sub-c-foo",secretKey:"sec-c-bar"},id:"foo-bar-baz",creationTime:t.toISOString(),status:"Active",uri:"https://platform.ringcentral.com/restapi/v1.0/subscription/foo-bar-baz"}),this},e.prototype.subscribeOnPresence=function(e,t){e=e||"1";var n=new Date;return this.apiCall("POST","/restapi/v1.0/subscription",{eventFilters:["/restapi/v1.0/account/~/extension/"+e+"/presence"+(t?"?detailedTelephonyState=true":"")],expirationTime:new Date(n.getTime()+54e6).toISOString(),deliveryMode:{transportType:"PubNub",encryption:!0,address:"123_foo",subscriberKey:"sub-c-foo",secretKey:"sec-c-bar",encryptionAlgorithm:"AES",encryptionKey:"VQwb6EVNcQPBhE/JgFZ2zw=="},creationTime:n.toISOString(),id:"foo-bar-baz",status:"Active",uri:"https://platform.ringcentral.com/restapi/v1.0/subscription/foo-bar-baz"}),this},e.prototype.tokenRefresh=function(e){return e?this.apiCall("POST","/restapi/oauth/token",{message:"Wrong token",error_description:"Wrong token",description:"Wrong token"},400):this.apiCall("POST","/restapi/oauth/token",{access_token:"ACCESS_TOKEN_FROM_REFRESH",token_type:"bearer",expires_in:3600,refresh_token:"REFRESH_TOKEN_FROM_REFRESH",refresh_token_expires_in:60480,scope:"SMS RCM Foo Boo"}),this},e}();t["default"]=u,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=n(16),s=r(i),u=n(2),a=n(15),c=function(){function e(t,n,r,i,s,u){o(this,e),this._method=t.toUpperCase(),this._path=n,this._json=r||{},this._delay=u||10,this._status=i||200,this._statusText=s||"OK"}return e.prototype.path=function(){return this._path},e.prototype.method=function(){return this._method},e.prototype.test=function(e){return e.url.indexOf(this._path)>-1&&e.method.toUpperCase()==this._method},e.prototype.getResponse=function(e){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(u.delay(this._delay));case 2:return e.abrupt("return",this.createResponse(this._json));case 3:case"end":return e.stop()}},null,this)},e.prototype.createResponse=function(e,t){t=t||{},t.status=t.status||this._status,t.statusText=t.statusText||this._statusText;var n=JSON.stringify(e),r=a.createResponse(n,t);return r.headers.set(s["default"]._contentType,s["default"]._jsonContentType),r},e}();t["default"]=c,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(12),a=r(u),c=n(13),l=r(c),f=n(21),p=r(f),h=(n(3),n(2)),d=function(e){function t(n,r,i,s,u){o(this,t),e.call(this),this.events={beforeLogin:"beforeLogin",loginSuccess:"loginSuccess",loginError:"loginError",beforeRefresh:"beforeRefresh",refreshSuccess:"refreshSuccess",refreshError:"refreshError",beforeLogout:"beforeLogout",logoutSuccess:"logoutSuccess",logoutError:"logoutError"},this._server=i,this._appKey=s,this._appSecret=u,this._cache=r,this._client=n,this._queue=new l["default"](this._cache,t._cacheId+"-refresh"),this._auth=new p["default"](this._cache,t._cacheId)}return i(t,e),s(t,null,[{key:"_urlPrefix",value:"/restapi",enumerable:!0},{key:"_apiVersion",value:"v1.0",enumerable:!0},{key:"_accessTokenTtl",value:null,enumerable:!0},{key:"_refreshTokenTtl",value:36e3,enumerable:!0},{key:"_refreshTokenTtlRemember",value:604800,enumerable:!0},{key:"_tokenEndpoint",value:"/restapi/oauth/token",enumerable:!0},{key:"_revokeEndpoint",value:"/restapi/oauth/revoke",enumerable:!0},{key:"_authorizeEndpoint",value:"/restapi/oauth/authorize",enumerable:!0},{key:"_refreshDelayMs",value:100,enumerable:!0},{key:"_cacheId",value:"platform",enumerable:!0},{key:"_clearCacheOnRefreshError",value:!0,enumerable:!0}]),t.prototype.auth=function(){return this._auth},t.prototype.client=function(){return this._client},t.prototype.createUrl=function(e,n){e=e||"",n=n||{};var r="",o=-1!=e.indexOf("http://")||-1!=e.indexOf("https://");return n.addServer&&!o&&(r+=this._server),-1!=e.indexOf(t._urlPrefix)||o||(r+=t._urlPrefix+"/"+t._apiVersion),r+=e,(n.addMethod||n.addToken)&&(r+=e.indexOf("?")>-1?"&":"?"),n.addMethod&&(r+="_method="+n.addMethod),n.addToken&&(r+=(n.addMethod?"&":"")+"access_token="+this._auth.accessToken()),r},t.prototype.authUrl=function(e){return e=e||{},this.createUrl(t._authorizeEndpoint+"?"+h.queryStringify({response_type:"code",redirect_uri:e.redirectUri||"",client_id:this._appKey,state:e.state||"",brand_id:e.brandId||"",display:e.display||"",prompt:e.prompt||""}),{addServer:!0})},t.prototype.parseAuthRedirectUrl=function(e){var t=h.parseQueryString(e.split("?").reverse()[0]),n=t.error_description||t.error;if(n){var r=new Error(n);throw r.error=t.error,r}return t},t.prototype.loggedIn=function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(this._ensureAuthentication());case 3:return e.abrupt("return",!0);case 6:return e.prev=6,e.t0=e["catch"](0),e.abrupt("return",!1);case 9:case"end":return e.stop()}},null,this,[[0,6]])},t.prototype.login=function(e){var n,r,o;return regeneratorRuntime.async(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,e=e||{},e.remember=e.remember||!1,this.emit(this.events.beforeLogin),n={access_token_ttl:t._accessTokenTtl,refresh_token_ttl:e.remember?t._refreshTokenTtlRemember:t._refreshTokenTtl},e.code?e.code&&(n.grant_type="authorization_code",n.code=e.code,n.redirect_uri=e.redirectUri):(n.grant_type="password",n.username=e.username,n.password=e.password,n.extension=e.extension||""),e.endpointId&&(n.endpoint_id=e.endpointId),i.next=9,regeneratorRuntime.awrap(this._tokenRequest(t._tokenEndpoint,n));case 9:return r=i.sent,o=r.json(),this._auth.setData(o).setRemember(e.remember),this.emit(this.events.loginSuccess,r),i.abrupt("return",r);case 16:throw i.prev=16,i.t0=i["catch"](0),this._cache.clean(),this.emit(this.events.loginError,i.t0),i.t0;case 21:case"end":return i.stop()}},null,this,[[0,16]])},t.prototype.refresh=function(){var e,n;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,this.emit(this.events.beforeRefresh),!this._queue.isPaused()){r.next=9;break}return r.next=5,regeneratorRuntime.awrap(this._queue.poll());case 5:if(this._isAccessTokenValid()){r.next=7;break}throw new Error("Automatic authentification timeout");case 7:return this.emit(this.events.refreshSuccess,null),r.abrupt("return",null);case 9:return this._queue.pause(),r.next=12,regeneratorRuntime.awrap(h.delay(t._refreshDelayMs));case 12:if(this._auth.refreshToken()){r.next=14;break}throw new Error("Refresh token is missing");case 14:if(this._auth.refreshTokenValid()){r.next=16;break}throw new Error("Refresh token has expired");case 16:if(this._queue.isPaused()){r.next=18;break}throw new Error("Queue was resumed before refresh call");case 18:return r.next=20,regeneratorRuntime.awrap(this._tokenRequest(t._tokenEndpoint,{grant_type:"refresh_token",refresh_token:this._auth.refreshToken(),access_token_ttl:t._accessTokenTtl,refresh_token_ttl:this._auth.remember()?t._refreshTokenTtlRemember:t._refreshTokenTtl}));case 20:if(e=r.sent,n=e.json(),n.access_token){r.next=24;break}throw this._client.makeError(new Error("Malformed OAuth response"),e);case 24:return this._auth.setData(n),this._queue.resume(),this.emit(this.events.refreshSuccess,e),r.abrupt("return",e);case 30:throw r.prev=30,r.t0=r["catch"](0),r.t0=this._client.makeError(r.t0),t._clearCacheOnRefreshError&&this._cache.clean(),this.emit(this.events.refreshError,r.t0),r.t0;case 36:case"end":return r.stop()}},null,this,[[0,30]])},t.prototype.logout=function(){var e;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,this.emit(this.events.beforeLogout),this._queue.pause(),n.next=5,regeneratorRuntime.awrap(this._tokenRequest(t._revokeEndpoint,{token:this._auth.accessToken()}));case 5:return e=n.sent,this._queue.resume(),this._cache.clean(),this.emit(this.events.logoutSuccess,e),n.abrupt("return",e);case 12:throw n.prev=12,n.t0=n["catch"](0),this._queue.resume(),this.emit(this.events.logoutError,n.t0),n.t0;case 17:case"end":return n.stop()}},null,this,[[0,12]])},t.prototype.inflateRequest=function(e,t){return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(t=t||{},!t.skipAuthCheck){n.next=3;break}return n.abrupt("return",e);case 3:return n.next=5,regeneratorRuntime.awrap(this._ensureAuthentication());case 5:return e.headers.set("Authorization",this._authHeader()),n.abrupt("return",e);case 7:case"end":return n.stop()}},null,this)},t.prototype.sendRequest=function(e,t){return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,regeneratorRuntime.awrap(this.inflateRequest(e,t));case 3:return e=n.sent,n.next=6,regeneratorRuntime.awrap(this._client.sendRequest(e));case 6:return n.abrupt("return",n.sent);case 9:if(n.prev=9,n.t0=n["catch"](0),n.t0.apiResponse&&n.t0.apiResponse.response()&&401==n.t0.apiResponse.response().status){n.next=13;break}throw n.t0;case 13:return this._auth.cancelAccessToken(),n.next=16,regeneratorRuntime.awrap(this.sendRequest(e,t));case 16:return n.abrupt("return",n.sent);case 17:case"end":return n.stop()}},null,this,[[0,9]])},t.prototype.send=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return e.url=this.createUrl(e.url,{addServer:!0}),t.next=3,regeneratorRuntime.awrap(this.sendRequest(this._client.createRequest(e),e));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},null,this)},t.prototype.get=function(e,t,n){return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:return n=n||{},n.method="GET",n.url=e,n.query=t,r.next=6,regeneratorRuntime.awrap(this.send(n));case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}},null,this)},t.prototype.post=function(e,t,n,r){return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return r=r||{},r.method="POST",r.url=e,r.query=n,r.body=t,o.next=7,regeneratorRuntime.awrap(this.send(r));case 7:return o.abrupt("return",o.sent);case 8:case"end":return o.stop()}},null,this)},t.prototype.put=function(e,t,n,r){return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return r=r||{},r.method="PUT",r.url=e,r.query=n,r.body=t,o.next=7,regeneratorRuntime.awrap(this.send(r));case 7:return o.abrupt("return",o.sent);case 8:case"end":return o.stop()}},null,this)},t.prototype["delete"]=function(e,t,n){return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:return n=n||{},n.method="DELETE",n.url=e,n.query=t,r.next=6,regeneratorRuntime.awrap(this.send(n));case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}},null,this)},t.prototype._tokenRequest=function(e,t){return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(this.send({url:e,skipAuthCheck:!0,body:t,method:"POST",headers:{Authorization:"Basic "+this._apiKey(),"Content-Type":"application/x-www-form-urlencoded"}}));case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},null,this)},t.prototype._ensureAuthentication=function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isAccessTokenValid()){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,regeneratorRuntime.awrap(this.refresh());case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},null,this)},t.prototype._isAccessTokenValid=function(){return this._auth.accessTokenValid()&&!this._queue.isPaused()},t.prototype._apiKey=function(){var e=this._appKey+":"+this._appSecret;return"function"==typeof btoa?btoa(e):new Buffer(e).toString("base64")},t.prototype._authHeader=function(){var e=this._auth.accessToken();return this._auth.tokenType()+(e?" "+e:"")},t}(a["default"]);t["default"]=d,e.exports=t["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,r){n(this,e),this._cache=t,this._cacheId=r}return r(e,null,[{key:"refreshHandicapMs",value:6e4,enumerable:!0},{key:"forcedTokenType",value:"forced",enumerable:!0}]),e.prototype.accessToken=function(){return this.data().access_token},e.prototype.refreshToken=function(){return this.data().refresh_token},e.prototype.tokenType=function(){return this.data().token_type},e.prototype.data=function(){return this._cache.getItem(this._cacheId)||{token_type:"",access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}},e.prototype.setData=function(e){e=e||{};var t=this.data();return Object.keys(e).forEach(function(n){t[n]=e[n]}),t.expire_time=Date.now()+1e3*t.expires_in,t.refresh_token_expire_time=Date.now()+1e3*t.refresh_token_expires_in,this._cache.setItem(this._cacheId,t),this},e.prototype.accessTokenValid=function(){var t=this.data();return t.token_type===e.forcedTokenType||t.expire_time-e.refreshHandicapMs>Date.now()},e.prototype.refreshTokenValid=function(){return this.data().refresh_token_expire_time>Date.now()},e.prototype.cancelAccessToken=function(){return this.setData({access_token:"",expires_in:0})},e.prototype.forceAuthentication=function(){return this.setData({token_type:e.forcedTokenType,access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}),this},e.prototype.setRemember=function(e){return this.setData({remember:e})},e.prototype.remember=function(){return!!this.data().remember},e}();t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=n(23),s=r(i),u=n(3),a=function(){function e(){o(this,e),this.crypto_obj=u.PUBNUB.crypto_obj}return e.prototype.init=function(e){return new s["default"](e)},e}();t["default"]=a,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=n(12),u=r(s),a=n(3),c=function(e){function t(n){o(this,t),e.call(this),this.options=n,this.crypto_obj=a.PUBNUB.crypto_obj}return i(t,e),t.prototype.ready=function(){},t.prototype.subscribe=function(e){this.on("message-"+e.channel,e.message)},t.prototype.unsubscribe=function(e){this.off("message-"+e.channel)},t.prototype.receiveMessage=function(e,t){this.emit("message-"+t,e,"env",t)},t}(u["default"]);t["default"]=c,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(12),a=r(u),c=n(14),l=(r(c),n(2)),f=function(e){function t(n,r){o(this,t),e.call(this),this.events={notification:"notification",removeSuccess:"removeSuccess",removeError:"removeError",renewSuccess:"renewSuccess",renewError:"renewError",subscribeSuccess:"subscribeSuccess",subscribeError:"subscribeError"},this._pubnubFactory=n,this._platform=r,this._pubnub=null,this._timeout=null,this._subscription={}}return i(t,e),s(t,null,[{key:"_renewHandicapMs",value:12e4,enumerable:!0},{key:"_pollInterval",value:1e4,enumerable:!0}]),t.prototype.subscribed=function(){return!!(this._subscription.id&&this._subscription.deliveryMode&&this._subscription.deliveryMode.subscriberKey&&this._subscription.deliveryMode.address)},t.prototype.alive=function(){return this.subscribed()&&Date.now()<this.expirationTime()},t.prototype.expirationTime=function(){return new Date(this._subscription.expirationTime||0).getTime()-t._renewHandicapMs;
},t.prototype.setSubscription=function(e){return e=e||{},this._clearTimeout(),this._subscription=e,this._pubnub||this._subscribeAtPubnub(),this._setTimeout(),this},t.prototype.subscription=function(){return this._subscription},t.prototype.register=function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.alive()){e.next=6;break}return e.next=3,regeneratorRuntime.awrap(this.renew());case 3:return e.abrupt("return",e.sent);case 6:return e.next=8,regeneratorRuntime.awrap(this.subscribe());case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},null,this)},t.prototype.eventFilters=function(){return this._subscription.eventFilters||[]},t.prototype.addEventFilters=function(e){return this.setEventFilters(this.eventFilters().concat(e)),this},t.prototype.setEventFilters=function(e){return this._subscription.eventFilters=e,this},t.prototype.subscribe=function(){var e,t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,this._clearTimeout(),this.eventFilters().length){n.next=4;break}throw new Error("Events are undefined");case 4:return n.next=6,regeneratorRuntime.awrap(this._platform.post("/restapi/v1.0/subscription",{eventFilters:this._getFullEventFilters(),deliveryMode:{transportType:"PubNub"}}));case 6:return e=n.sent,t=e.json(),this.setSubscription(t).emit(this.events.subscribeSuccess,e),n.abrupt("return",e);case 12:throw n.prev=12,n.t0=n["catch"](0),n.t0=this._platform.client().makeError(n.t0),this.reset().emit(this.events.subscribeError,n.t0),n.t0;case 17:case"end":return n.stop()}},null,this,[[0,12]])},t.prototype.renew=function(){var e,t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,this._clearTimeout(),this.alive()){n.next=4;break}throw new Error("Subscription is not alive");case 4:if(this.eventFilters().length){n.next=6;break}throw new Error("Events are undefined");case 6:return n.next=8,regeneratorRuntime.awrap(this._platform.put("/restapi/v1.0/subscription/"+this._subscription.id,{eventFilters:this._getFullEventFilters()}));case 8:return e=n.sent,t=e.json(),this.setSubscription(t).emit(this.events.renewSuccess,e),n.abrupt("return",e);case 14:throw n.prev=14,n.t0=n["catch"](0),n.t0=this._platform.client().makeError(n.t0),this.reset().emit(this.events.renewError,n.t0),n.t0;case 19:case"end":return n.stop()}},null,this,[[0,14]])},t.prototype.remove=function(){var e;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.subscribed()){t.next=3;break}throw new Error("No subscription");case 3:return t.next=5,regeneratorRuntime.awrap(this._platform["delete"]("/restapi/v1.0/subscription/"+this._subscription.id));case 5:return e=t.sent,this.reset().emit(this.events.removeSuccess,e),t.abrupt("return",e);case 10:throw t.prev=10,t.t0=t["catch"](0),t.t0=this._platform.client().makeError(t.t0),this.emit(this.events.removeError,t.t0),t.t0;case 15:case"end":return t.stop()}},null,this,[[0,10]])},t.prototype.resubscribe=function(){return this.reset().setEventFilters(this.eventFilters()).subscribe()},t.prototype.reset=function(){return this._clearTimeout(),this.subscribed()&&this._pubnub&&this._pubnub.unsubscribe({channel:this._subscription.deliveryMode.address}),this._subscription={},this},t.prototype._getFullEventFilters=function(){var e=this;return this.eventFilters().map(function(t){return e._platform.createUrl(t)})},t.prototype._setTimeout=function(){var e=this;if(this._clearTimeout(),!this.alive())throw new Error("Subscription is not alive");return l.poll(function(t){return e.alive()?t():void e.renew()},t._pollInterval,this._timeout),this},t.prototype._clearTimeout=function(){return l.stopPolling(this._timeout),this},t.prototype._decrypt=function(e){if(!this.subscribed())throw new Error("No subscription");if(this._subscription.deliveryMode.encryptionKey){var t=this._pubnubFactory;e=t.crypto_obj.decrypt(e,this._subscription.deliveryMode.encryptionKey,{encryptKey:!1,keyEncoding:"base64",keyLength:128,mode:"ecb"})}return e},t.prototype._notify=function(e){return this.emit(this.events.notification,this._decrypt(e)),this},t.prototype._subscribeAtPubnub=function(){if(!this.alive())throw new Error("Subscription is not alive");var e=this._pubnubFactory;return this._pubnub=e.init({ssl:!0,subscribe_key:this._subscription.deliveryMode.subscriberKey}),this._pubnub.ready(),this._pubnub.subscribe({channel:this._subscription.deliveryMode.address,message:this._notify.bind(this),connect:function(){}}),this},t}(a["default"]);t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u=n(24),a=r(u),c=n(13),l=r(c),f=function(e){function t(n,r,i,u){var a=this;o(this,t),e.call(this,n,r),this._cache=i,this._cacheKey=u,this._renewQueue=new l["default"](this._cache,u+"-renew"),this._resubscribeQueue=new l["default"](this._cache,u+"-resubscribe"),this.events=s({},this.events,{queuedRenewSuccess:"queuedRenewSuccess",queuedRenewError:"queuedRenewError",queuedResubscribeSuccess:"queuedResubscribeSuccess",queuedResubscribeError:"queuedResubscribeError"}),this.on(this.events.renewError,function(){a.resubscribe()}),this.on([this.events.subscribeSuccess,this.events.renewSuccess],function(){a._cache.setItem(a._cacheKey,a.subscription())}),this.on(this.events.removeSuccess,function(){a._cache.removeItem(a._cacheKey)})}return i(t,e),t.prototype._queue=function(e,t,n,r,o){var i;return regeneratorRuntime.async(function(s){for(;;)switch(s.prev=s.next){case 0:if(s.prev=0,!t.isPaused()){s.next=8;break}return s.next=4,regeneratorRuntime.awrap(t.poll());case 4:if(this.alive()){s.next=6;break}throw new Error(o);case 6:return this.emit(n,null),s.abrupt("return",null);case 8:return t.pause(),s.next=11,regeneratorRuntime.awrap(e.call(this));case 11:return i=s.sent,t.resume(),this.emit(n,i),s.abrupt("return",i);case 17:throw s.prev=17,s.t0=s["catch"](0),this.emit(r,s.t0),s.t0;case 21:case"end":return s.stop()}},null,this,[[0,17]])},t.prototype.renew=function(){return this._queue(e.prototype.renew,this._renewQueue,this.events.queuedRenewSuccess,this.events.queuedRenewError,"Subscription is not alive after renew timeout")},t.prototype.resubscribe=function(){return this._queue(e.prototype.resubscribe,this._resubscribeQueue,this.events.queuedResubscribeSuccess,this.events.queuedResubscribeError,"Subscription is not alive after resubscribe timeout")},t.prototype.restore=function(e){var t=this._cache.getItem(this._cacheKey);if(t)try{this.setSubscription(t)}catch(n){}else this.setEventFilters(e);return this},t}(a["default"]);t["default"]=f,e.exports=t["default"]},function(e,t){(function(t){!function(t){"use strict";function n(e,t,n,r){var i=Object.create((t||o).prototype),s=new h(r||[]);return i._invoke=l(e,n,s),i}function r(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}function o(){}function i(){}function s(){}function u(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function a(e){this.arg=e}function c(e){function t(t,n){var r=e[t](n),s=r.value;return s instanceof a?Promise.resolve(s.arg).then(o,i):Promise.resolve(s).then(function(e){return r.value=e,r})}function n(e,n){function o(){return t(e,n)}return r=r?r.then(o,o):new Promise(function(e){e(o())})}"object"==typeof process&&process.domain&&(t=process.domain.bind(t));var r,o=t.bind(e,"next"),i=t.bind(e,"throw");t.bind(e,"return");this._invoke=n}function l(e,t,n){var o=w;return function(i,s){if(o===E)throw new Error("Generator is already running");if(o===x){if("throw"===i)throw s;return y()}for(;;){var u=n.delegate;if(u){if("return"===i||"throw"===i&&u.iterator[i]===_){n.delegate=null;var a=u.iterator["return"];if(a){var c=r(a,u.iterator,s);if("throw"===c.type){i="throw",s=c.arg;continue}}if("return"===i)continue}var c=r(u.iterator[i],u.iterator,s);if("throw"===c.type){n.delegate=null,i="throw",s=c.arg;continue}i="next",s=_;var l=c.arg;if(!l.done)return o=k,l;n[u.resultName]=l.value,n.next=u.nextLoc,n.delegate=null}if("next"===i)o===k?n.sent=s:n.sent=_;else if("throw"===i){if(o===w)throw o=x,s;n.dispatchException(s)&&(i="next",s=_)}else"return"===i&&n.abrupt("return",s);o=E;var c=r(e,t,n);if("normal"===c.type){o=n.done?x:k;var l={value:c.arg,done:n.done};if(c.arg!==S)return l;n.delegate&&"next"===i&&(s=_)}else"throw"===c.type&&(o=x,i="throw",s=c.arg)}}}function f(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function p(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function h(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(f,this),this.reset(!0)}function d(e){if(e){var t=e[m];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function o(){for(;++n<e.length;)if(b.call(e,n))return o.value=e[n],o.done=!1,o;return o.value=_,o.done=!0,o};return r.next=r}}return{next:y}}function y(){return{value:_,done:!0}}var _,b=Object.prototype.hasOwnProperty,m="function"==typeof Symbol&&Symbol.iterator||"@@iterator",v="object"==typeof e,g=t.regeneratorRuntime;if(g)return void(v&&(e.exports=g));g=t.regeneratorRuntime=v?e.exports:{},g.wrap=n;var w="suspendedStart",k="suspendedYield",E="executing",x="completed",S={},O=s.prototype=o.prototype;i.prototype=O.constructor=s,s.constructor=i,i.displayName="GeneratorFunction",g.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return t?t===i||"GeneratorFunction"===(t.displayName||t.name):!1},g.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):e.__proto__=s,e.prototype=Object.create(O),e},g.awrap=function(e){return new a(e)},u(c.prototype),g.async=function(e,t,r,o){var i=new c(n(e,t,r,o));return g.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},u(O),O[m]=function(){return this},O.toString=function(){return"[object Generator]"},g.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},g.values=d,h.prototype={constructor:h,reset:function(e){if(this.prev=0,this.next=0,this.sent=_,this.done=!1,this.delegate=null,this.tryEntries.forEach(p),!e)for(var t in this)"t"===t.charAt(0)&&b.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=_)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,r){return i.type="throw",i.arg=e,n.next=t,!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],i=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var s=b.call(o,"catchLoc"),u=b.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&b.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?this.next=o.finallyLoc:this.complete(i),S},complete:function(e,t){if("throw"===e.type)throw e.arg;"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=e.arg,this.next="end"):"normal"===e.type&&t&&(this.next=t)},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),p(n),S}},"catch":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;p(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:d(e),resultName:t,nextLoc:n},S}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this)}).call(t,function(){return this}())}])});
//# sourceMappingURL=ringcentral-bundle.min.js.map
