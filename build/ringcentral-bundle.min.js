function unique(){return"x"+ ++NOW+ +new Date}function rnow(){return+new Date}function build_url(e,t){var n=e.join(URLBIT),r=[];return t?(each(t,function(e,t){var n="object"==typeof t?JSON.stringify(t):t;"undefined"!=typeof t&&null!=t&&encode(n).length>0&&r.push(e+"="+encode(n))}),n+="?"+r.join(PARAMSBIT)):n}function updater(e,t){var n,r=0,o=function(){r+t>rnow()?(clearTimeout(n),n=setTimeout(o,t)):(r=rnow(),e())};return o}function grep(e,t){var n=[];return each(e||[],function(e){t(e)&&n.push(e)}),n}function supplant(e,t){return e.replace(REPL,function(e,n){return t[n]||e})}function timeout(e,t){return setTimeout(e,t)}function generate_uuid(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)});return e&&e(t),t}function isArray(e){return!!e&&"string"!=typeof e&&(Array.isArray&&Array.isArray(e)||"number"==typeof e.length)}function each(e,t){if(e&&t)if(isArray(e))for(var n=0,r=e.length;r>n;)t.call(e[n],e[n],n++);else for(var n in e)e.hasOwnProperty&&e.hasOwnProperty(n)&&t.call(e[n],n,e[n])}function map(e,t){var n=[];return each(e||[],function(e,r){n.push(t(e,r))}),n}function pam_encode(e){return encodeURIComponent(e).replace(/[!'()*~]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function encode(e){return encodeURIComponent(e)}function generate_channel_list(e,t){var n=[];return each(e,function(e,r){t?e.search("-pnpres")<0&&r.subscribed&&n.push(e):r.subscribed&&n.push(e)}),n.sort()}function generate_channel_group_list(e,t){var n=[];return each(e,function(e,r){t?e.search("-pnpres")<0&&r.subscribed&&n.push(e):r.subscribed&&n.push(e)}),n.sort()}function ready(){timeout(function(){READY||(READY=1,each(READY_BUFFER,function(e){e()}))},SECOND)}function PNmessage(e){return msg=e||{apns:{}},msg.getPubnubMessage=function(){var e={};if(Object.keys(msg.apns).length){e.pn_apns={aps:{alert:msg.apns.alert,badge:msg.apns.badge}};for(var t in msg.apns)e.pn_apns[t]=msg.apns[t];var n=["badge","alert"];for(var t in n)delete e.pn_apns[n[t]]}msg.gcm&&(e.pn_gcm={data:msg.gcm});for(var t in msg)e[t]=msg[t];var r=["apns","gcm","publish","channel","callback","error"];for(var t in r)delete e[r[t]];return e},msg.publish=function(){var e=msg.getPubnubMessage();msg.pubnub&&msg.channel&&msg.pubnub.publish({message:e,channel:msg.channel,callback:msg.callback,error:msg.error})},msg}function PN_API(e){function t(e){return e||(e={}),each(ie,function(t,n){t in e||(e[t]=n)}),e}function r(e){var t=[];return each(e,function(e,n){t.push(e)}),t}function o(e){return r(e).sort()}function i(e){var t="",n=o(e);for(var r in n){var i=n[r];t+=i+"="+pam_encode(e[i]),r!=n.length-1&&(t+="&")}return t}function s(e,t,n){var r=!1;if("undefined"==typeof e)return t;if("number"==typeof e)r=e>PRESENCE_HB_THRESHOLD||0==e?!1:!0;else{if("boolean"==typeof e)return e?PRESENCE_HB_DEFAULT:0;r=!0}return r?(n&&n("Presence Heartbeat value invalid. Valid range ( x > "+PRESENCE_HB_THRESHOLD+" or x = 0). Current Value : "+(t||PRESENCE_HB_THRESHOLD)),t||PRESENCE_HB_THRESHOLD):e}function a(e,t){return de.encrypt(e,t||pe)||e}function u(e,t){return de.decrypt(e,t||pe)||de.decrypt(e,pe)||e}function c(){return clearTimeout($),!ee||ee>=500||1>ee||!generate_channel_list(X,!0).length&&!generate_channel_group_list(Y,!0).length?void(te=!1):(te=!0,void _e.presence_heartbeat({callback:function(e){$=timeout(c,ee*SECOND)},error:function(e){se&&se("Presence Heartbeat unable to reach Pubnub servers."+JSON.stringify(e)),$=timeout(c,ee*SECOND)}}))}function p(){!te&&c()}function l(e){if(ne){if(!H.length)return}else{if(e&&(H.sending=0),H.sending||!H.length)return;H.sending=1}oe(H.shift())}function f(e){var t=0;return each(generate_channel_group_list(Y),function(n){var r=Y[n];r&&(t++,(e||function(){})(r))}),t}function h(e){var t=0;return each(generate_channel_list(X),function(n){var r=X[n];r&&(t++,(e||function(){})(r))}),t}function d(e,t,n){if("object"==typeof e){if(e.error){var r={};return e.message&&(r.message=e.message),e.payload&&(r.payload=e.payload),void(n&&n(r))}if(e.payload)return void(e.next_page?t&&t(e.payload,e.next_page):t&&t(e.payload))}t&&t(e)}function _(e,t){if("object"==typeof e&&e.error){var n={};return e.message&&(n.message=e.message),e.payload&&(n.payload=e.payload),void(t&&t(n))}t&&t(e)}function y(e,n,r,o){var n=e.callback||n,i=e.error||se,s=ue();o=o||{},o.auth||(o.auth=e.auth_key||B);var a=[U,"v1","channel-registration","sub-key",A];a.push.apply(a,r),s&&(o.callback=s),oe({callback:s,data:t(o),success:function(e){d(e,n,i)},fail:function(e){_(e,i)},url:a})}function g(){ae()||m(1,{error:"Offline. Please check your network settings. "}),E&&clearTimeout(E),E=timeout(g,SECOND)}function b(){T&&_e.time(function(e){w(function(){},e),e||m(1,{error:"Heartbeat failed to connect to Pubnub Servers.Please check your network settings."}),S&&clearTimeout(S),S=timeout(b,R)})}function m(e,t){K&&K(e,t),K=null,clearTimeout(E),clearTimeout(S)}function v(e){var t=rnow()-q;return t-e/1e4}function w(e,t){function n(t){if(t){var n=t/1e4,o=(rnow()-r)/2;q=rnow()-(n+o),e&&e(q)}}var r=rnow();t&&n(t)||_e.time(n)}var E,S,x=+e.windowing||DEF_WINDOWING,C=(+e.timeout||DEF_SUB_TIMEOUT)*SECOND,R=(+e.keepalive||DEF_KEEPALIVE)*SECOND,T=e.timecheck||0,O=e.noleave||0,P=e.publish_key||"demo",A=e.subscribe_key||"demo",B=e.auth_key||"",M=e.secret_key||"",D=e.hmac_SHA256,N=e.ssl?"s":"",j="http"+N+"://"+(e.origin||"pubsub.pubnub.com"),U=nextorigin(j),I=nextorigin(j),F=function(){},H=[],L=!0,q=0,z=0,J=0,K=0,V=e.restore||0,G=0,W=!1,X={},Y={},Q={},$=null,Z=s(e.heartbeat||e.pnexpires||0,e.error),ee=e.heartbeat_interval||Z/2-1,te=!1,ne=e.no_wait_for_pending,re=e["compatible_3.5"]||!1,oe=e.xdr,ie=e.params||{},se=e.error||function(){},ae=e._is_online||function(){return 1},ue=e.jsonp_cb||function(){return 0},ce=e.db||{get:function(){},set:function(){}},pe=e.cipher_key,le=e.uuid||!e.unique_uuid&&ce&&ce.get(A+"uuid")||"",fe=e.instance_id||!1,he="";2===Z&&(ee=1);var de=e.crypto_obj||{encrypt:function(e,t){return e},decrypt:function(e,t){return e}},_e={LEAVE:function(e,n,r,o,i){var s={uuid:le,auth:r||B},a=nextorigin(j),o=o||function(){},u=i||function(){},c=ue();if(e.indexOf(PRESENCE_SUFFIX)>0)return!0;if(re){if(!N)return!1;if("0"==c)return!1}return O?!1:("0"!=c&&(s.callback=c),fe&&(s.instanceid=he),oe({blocking:n||N,timeout:2e3,callback:c,data:t(s),success:function(e){d(e,o,u)},fail:function(e){_(e,u)},url:[a,"v2","presence","sub_key",A,"channel",encode(e),"leave"]}),!0)},LEAVE_GROUP:function(e,n,r,o,i){var s={uuid:le,auth:r||B},a=nextorigin(j),o=o||function(){},u=i||function(){},c=ue();if(e.indexOf(PRESENCE_SUFFIX)>0)return!0;if(re){if(!N)return!1;if("0"==c)return!1}return O?!1:("0"!=c&&(s.callback=c),e&&e.length>0&&(s["channel-group"]=e),fe&&(s.instanceid=he),oe({blocking:n||N,timeout:5e3,callback:c,data:t(s),success:function(e){d(e,o,u)},fail:function(e){_(e,u)},url:[a,"v2","presence","sub_key",A,"channel",encode(","),"leave"]}),!0)},set_resumed:function(e){W=e},get_cipher_key:function(){return pe},set_cipher_key:function(e){pe=e},raw_encrypt:function(e,t){return a(e,t)},raw_decrypt:function(e,t){return u(e,t)},get_heartbeat:function(){return Z},set_heartbeat:function(e,t){Z=s(e,Z,se),ee=t||Z/2-1,2==Z&&(ee=1),F(),c()},get_heartbeat_interval:function(){return ee},set_heartbeat_interval:function(e){ee=e,c()},get_version:function(){return SDK_VER},getGcmMessageObject:function(e){return{data:e}},getApnsMessageObject:function(e){var t={aps:{badge:1,alert:""}};for(k in e)k[t]=e[k];return t},newPnMessage:function(){var e={};gcm&&(e.pn_gcm=gcm),apns&&(e.pn_apns=apns);for(k in n)e[k]=n[k];return e},_add_param:function(e,t){ie[e]=t},channel_group:function(e,t){var n,r,o=e.channel_group,t=t||e.callback,i=e.channels||e.channel,s=e.cloak,a=[],u={},c=e.mode||"add";if(o){var p=o.split(":");p.length>1?(n="*"===p[0]?null:p[0],r=p[1]):r=p[0]}n&&a.push("namespace")&&a.push(encode(n)),a.push("channel-group"),r&&"*"!==r&&a.push(r),i?(isArray(i)&&(i=i.join(",")),u[c]=i,u.cloak=L?"true":"false"):"remove"===c&&a.push("remove"),"undefined"!=typeof s&&(u.cloak=s?"true":"false"),y(e,t,a,u)},channel_group_list_groups:function(e,t){var n;n=e.namespace||e.ns||e.channel_group||null,n&&(e.channel_group=n+":*"),_e.channel_group(e,t)},channel_group_list_channels:function(e,t){return e.channel_group?void _e.channel_group(e,t):se("Missing Channel Group")},channel_group_remove_channel:function(e,t){return e.channel_group?e.channel||e.channels?(e.mode="remove",void _e.channel_group(e,t)):se("Missing Channel"):se("Missing Channel Group")},channel_group_remove_group:function(e,t){return e.channel_group?e.channel?se("Use channel_group_remove_channel if you want to remove a channel from a group."):(e.mode="remove",void _e.channel_group(e,t)):se("Missing Channel Group")},channel_group_add_channel:function(e,t){return e.channel_group?e.channel||e.channels?void _e.channel_group(e,t):se("Missing Channel"):se("Missing Channel Group")},channel_group_cloak:function(e,t){return"undefined"==typeof e.cloak?void t(L):(L=e.cloak,void _e.channel_group(e,t))},channel_group_list_namespaces:function(e,t){var n=["namespace"];y(e,t,n)},channel_group_remove_namespace:function(e,t){var n=["namespace",e.namespace,"remove"];y(e,t,n)},history:function(e,n){var n=e.callback||n,r=e.count||e.limit||100,o=e.reverse||"false",i=e.error||function(){},s=e.auth_key||B,a=e.cipher_key,c=e.channel,p=e.channel_group,l=e.start,f=e.end,h=e.include_token,d={},y=ue();return c||p?n?A?(d.stringtoken="true",d.count=r,d.reverse=o,d.auth=s,p&&(d["channel-group"]=p,c||(c=",")),y&&(d.callback=y),l&&(d.start=l),f&&(d.end=f),h&&(d.include_token="true"),void oe({callback:y,data:t(d),success:function(e){if("object"==typeof e&&e.error)return void i({message:e.message,payload:e.payload});for(var t=e[0],r=[],o=0;o<t.length;o++){var s=u(t[o],a);try{r.push(JSON.parse(s))}catch(c){r.push(s)}}n([r,e[1],e[2]])},fail:function(e){_(e,i)},url:[U,"v2","history","sub-key",A,"channel",encode(c)]})):se("Missing Subscribe Key"):se("Missing Callback"):se("Missing Channel")},replay:function(e,n){var r,n=n||e.callback||function(){},o=e.auth_key||B,i=e.source,s=e.destination,a=e.stop,u=e.start,c=e.end,p=e.reverse,l=e.limit,f=ue(),h={};return i?s?P?A?("0"!=f&&(h.callback=f),a&&(h.stop="all"),p&&(h.reverse="true"),u&&(h.start=u),c&&(h.end=c),l&&(h.count=l),h.auth=o,r=[U,"v1","replay",P,A,i,s],void oe({callback:f,success:function(e){d(e,n,err)},fail:function(){n([0,"Disconnected"])},url:r,data:t(h)})):se("Missing Subscribe Key"):se("Missing Publish Key"):se("Missing Destination Channel"):se("Missing Source Channel")},auth:function(e){B=e,F()},time:function(e){var n=ue(),r={uuid:le,auth:B};fe&&(r.instanceid=he),oe({callback:n,data:t(r),timeout:5*SECOND,url:[U,"time",n],success:function(t){e(t[0])},fail:function(){e(0)}})},publish:function(e,n){var r=e.message;if(!r)return se("Missing Message");var o,i,n=n||e.callback||r.callback||function(){},s=e.channel||r.channel,u=e.auth_key||B,c=e.cipher_key,p=e.error||r.error||function(){},f=e.post||!1,h="store_in_history"in e?e.store_in_history:!0,y=ue(),g="push";return e.prepend&&(g="unshift"),s?P?A?(r.getPubnubMessage&&(r=r.getPubnubMessage()),r=JSON.stringify(a(r,c)),i=[U,"publish",P,A,0,encode(s),y,encode(r)],o={uuid:le,auth:u},h||(o.store="0"),fe&&(o.instanceid=he),H[g]({callback:y,timeout:5*SECOND,url:i,data:t(o),fail:function(e){_(e,p),l(1)},success:function(e){d(e,n,p),l(1)},mode:f?"POST":"GET"}),void l()):se("Missing Subscribe Key"):se("Missing Publish Key"):se("Missing Channel")},unsubscribe:function(e,t){var n=e.channel,r=e.channel_group,o=e.auth_key||B,t=t||e.callback||function(){},i=e.error||function(){};G=0,n&&(n=map((n.join?n.join(","):""+n).split(","),function(e){return X[e]?e+","+e+PRESENCE_SUFFIX:void 0}).join(","),each(n.split(","),function(e){var n=!0;e&&(X[e]=0,e in Q&&delete Q[e],READY&&(n=_e.LEAVE(e,0,o,t,i)),n||t({action:"leave"}))})),r&&(r=map((r.join?r.join(","):""+r).split(","),function(e){return Y[e]?e+","+e+PRESENCE_SUFFIX:void 0}).join(","),each(r.split(","),function(e){var n=!0;e&&(Y[e]=0,e in Q&&delete Q[e],READY&&(n=_e.LEAVE_GROUP(e,0,o,t,i)),n||t({action:"leave"}))})),F()},subscribe:function(e,n){function r(e){e?timeout(F,S):(U=nextorigin(j,1),I=nextorigin(j,1),timeout(function(){_e.time(r)},SECOND)),h(function(t){return e&&t.disconnected?(t.disconnected=0,t.reconnect(t.name)):void(e||t.disconnected||(t.disconnected=1,t.disconnect(t.name)))}),f(function(t){return e&&t.disconnected?(t.disconnected=0,t.reconnect(t.name)):void(e||t.disconnected||(t.disconnected=1,t.disconnect(t.name)))})}function o(){var e=ue(),n=generate_channel_list(X).join(","),i=generate_channel_group_list(Y).join(",");if(n||i){n||(n=","),m();var s=t({uuid:le,auth:B});i&&(s["channel-group"]=i);var a=JSON.stringify(Q);a.length>2&&(s.state=JSON.stringify(Q)),Z&&(s.heartbeat=Z),fe&&(s.instanceid=he),p(),K=oe({timeout:E,callback:e,fail:function(e){e&&e.error&&e.service?(_(e,d),r(1)):_e.time(function(t){!t&&_(e,d),r(t)})},data:t(s),url:[I,"subscribe",A,encode(n),e,G],success:function(e){if(!e||"object"==typeof e&&"error"in e&&e.error)return d(e.error),timeout(F,SECOND);if(y(e[1]),G=!G&&V&&ce.get(A)||e[1],h(function(e){e.connected||(e.connected=1,e.connect(e.name))}),f(function(e){e.connected||(e.connected=1,e.connect(e.name))}),W&&!V)return G=0,W=!1,ce.set(A,0),void timeout(o,S);k&&(G=1e4,k=0),ce.set(A,e[1]);var t=function(){var t="",n="";e.length>3?(t=e[3],n=e[2]):t=e.length>2?e[2]:map(generate_channel_list(X),function(t){return map(Array(e[0].length).join(",").split(","),function(){return t})}).join(",");var r=t.split(","),o=n?n.split(","):[];return function(){var e=r.shift()||J,t=o.shift(),n={};t?(e&&e.indexOf("-pnpres")>=0&&t.indexOf("-pnpres")<0&&(t+="-pnpres"),n=Y[t]||X[t]||{callback:function(){}}):n=X[e];var i=[n.callback||z,e.split(PRESENCE_SUFFIX)[0]];return t&&i.push(t.split(PRESENCE_SUFFIX)[0]),i}}(),n=v(+e[1]);each(e[0],function(r){var o=t(),i=u(r,X[o[1]]?X[o[1]].cipher_key:null);o[0]&&o[0](i,e,o[2]||o[1],n,o[1])}),timeout(o,S)}})}}var i=e.channel,s=e.channel_group,n=n||e.callback,n=n||e.message,a=e.connect||function(){},c=e.reconnect||function(){},l=e.disconnect||function(){},d=e.error||d||function(){},y=e.idle||function(){},g=e.presence||0,b=e.noheresync||0,k=e.backfill||0,w=e.timetoken||0,E=e.timeout||C,S=e.windowing||x,R=e.state,T=e.heartbeat||e.pnexpires,O=e.heartbeat_interval,P=e.restore||V;return B=e.auth_key||B,V=P,G=w,i||s?n?A?((T||0===T||O||0===O)&&_e.set_heartbeat(T,O),i&&each((i.join?i.join(","):""+i).split(","),function(r){var o=X[r]||{};X[J=r]={name:r,connected:o.connected,disconnected:o.disconnected,subscribed:1,callback:z=n,cipher_key:e.cipher_key,connect:a,disconnect:l,reconnect:c},R&&(Q[r]=r in R?R[r]:R),g&&(_e.subscribe({channel:r+PRESENCE_SUFFIX,callback:g,restore:P}),o.subscribed||b||_e.here_now({channel:r,data:t({uuid:le,auth:B}),callback:function(e){each("uuids"in e?e.uuids:[],function(t){g({action:"join",uuid:t,timestamp:Math.floor(rnow()/1e3),occupancy:e.occupancy||1},e,r)})}}))}),s&&each((s.join?s.join(","):""+s).split(","),function(r){var o=Y[r]||{};Y[r]={name:r,connected:o.connected,disconnected:o.disconnected,subscribed:1,callback:z=n,cipher_key:e.cipher_key,connect:a,disconnect:l,reconnect:c},g&&(_e.subscribe({channel_group:r+PRESENCE_SUFFIX,callback:g,restore:P,auth_key:B}),o.subscribed||b||_e.here_now({channel_group:r,data:t({uuid:le,auth:B}),callback:function(e){each("uuids"in e?e.uuids:[],function(t){g({action:"join",uuid:t,timestamp:Math.floor(rnow()/1e3),occupancy:e.occupancy||1},e,r)})}}))}),F=function(){m(),timeout(o,S)},READY?void F():READY_BUFFER.push(F)):se("Missing Subscribe Key"):se("Missing Callback"):se("Missing Channel")},here_now:function(e,n){var n=e.callback||n,r=e.error||function(){},o=e.auth_key||B,i=e.channel,s=e.channel_group,a=ue(),u="uuids"in e?e.uuids:!0,c=e.state,p={uuid:le,auth:o};if(u||(p.disable_uuids=1),c&&(p.state=1),!n)return se("Missing Callback");if(!A)return se("Missing Subscribe Key");var l=[U,"v2","presence","sub_key",A];i&&l.push("channel")&&l.push(encode(i)),"0"!=a&&(p.callback=a),s&&(p["channel-group"]=s,!i&&l.push("channel")&&l.push(",")),fe&&(p.instanceid=he),oe({callback:a,data:t(p),success:function(e){d(e,n,r)},fail:function(e){_(e,r)},url:l})},where_now:function(e,n){var n=e.callback||n,r=e.error||function(){},o=e.auth_key||B,i=ue(),s=e.uuid||le,a={auth:o};return n?A?("0"!=i&&(a.callback=i),fe&&(a.instanceid=he),void oe({callback:i,data:t(a),success:function(e){d(e,n,r)},fail:function(e){_(e,r)},url:[U,"v2","presence","sub_key",A,"uuid",encode(s)]})):se("Missing Subscribe Key"):se("Missing Callback")},state:function(e,n){var r,n=e.callback||n||function(e){},o=e.error||function(){},i=e.auth_key||B,s=ue(),a=e.state,u=e.uuid||le,c=e.channel,p=e.channel_group,l=t({auth:i});return A?u?c||p?("0"!=s&&(l.callback=s),"undefined"!=typeof c&&X[c]&&X[c].subscribed&&a&&(Q[c]=a),"undefined"!=typeof p&&Y[p]&&Y[p].subscribed&&(a&&(Q[p]=a),l["channel-group"]=p,c||(c=",")),l.state=JSON.stringify(a),fe&&(l.instanceid=he),r=a?[U,"v2","presence","sub-key",A,"channel",c,"uuid",u,"data"]:[U,"v2","presence","sub-key",A,"channel",c,"uuid",encode(u)],void oe({callback:s,data:t(l),success:function(e){d(e,n,o)},fail:function(e){_(e,o)},url:r})):se("Missing Channel"):se("Missing UUID"):se("Missing Subscribe Key")},grant:function(e,n){var n=e.callback||n,r=e.error||function(){},o=e.channel||e.channels,s=e.channel_group,a=ue(),u=e.ttl,c=e.read?"1":"0",p=e.write?"1":"0",l=e.manage?"1":"0",f=e.auth_key||e.auth_keys;if(!n)return se("Missing Callback");if(!A)return se("Missing Subscribe Key");if(!P)return se("Missing Publish Key");if(!M)return se("Missing Secret Key");var h=Math.floor((new Date).getTime()/1e3),y=A+"\n"+P+"\ngrant\n",g={w:p,r:c,timestamp:h};e.manage&&(g.m=l),isArray(o)&&(o=o.join(",")),isArray(f)&&(f=f.join(",")),"undefined"!=typeof o&&null!=o&&o.length>0&&(g.channel=o),"undefined"!=typeof s&&null!=s&&s.length>0&&(g["channel-group"]=s),"0"!=a&&(g.callback=a),(u||0===u)&&(g.ttl=u),f&&(g.auth=f),g=t(g),f||delete g.auth,y+=i(g);var b=D(y,M);b=b.replace(/\+/g,"-"),b=b.replace(/\//g,"_"),g.signature=b,oe({callback:a,data:g,success:function(e){d(e,n,r)},fail:function(e){_(e,r)},url:[U,"v1","auth","grant","sub-key",A]})},mobile_gw_provision:function(e){var t,n,r=e.callback||function(){},o=e.auth_key||B,i=e.error||function(){},s=ue(),a=e.channel,u=e.op,c=e.gw_type,p=e.device_id;return p?c?u?a?P?A?(n=[U,"v1/push/sub-key",A,"devices",p],t={uuid:le,auth:o,type:c},"add"==u?t.add=a:"remove"==u&&(t.remove=a),fe&&(data.instanceid=he),void oe({callback:s,data:t,success:function(e){d(e,r,i)},fail:function(e){_(e,i)},url:n})):se("Missing Subscribe Key"):se("Missing Publish Key"):se("Missing gw destination Channel (channel)"):se("Missing GW Operation (op: add or remove)"):se("Missing GW Type (gw_type: gcm or apns)"):se("Missing Device ID (device_id)")},audit:function(e,n){var n=e.callback||n,r=e.error||function(){},o=e.channel,s=e.channel_group,a=e.auth_key,u=ue();if(!n)return se("Missing Callback");if(!A)return se("Missing Subscribe Key");if(!P)return se("Missing Publish Key");if(!M)return se("Missing Secret Key");var c=Math.floor((new Date).getTime()/1e3),p=A+"\n"+P+"\naudit\n",l={timestamp:c};"0"!=u&&(l.callback=u),"undefined"!=typeof o&&null!=o&&o.length>0&&(l.channel=o),"undefined"!=typeof s&&null!=s&&s.length>0&&(l["channel-group"]=s),a&&(l.auth=a),l=t(l),a||delete l.auth,p+=i(l);var f=D(p,M);f=f.replace(/\+/g,"-"),f=f.replace(/\//g,"_"),l.signature=f,oe({callback:u,data:l,success:function(e){d(e,n,r)},fail:function(e){_(e,r)},url:[U,"v1","auth","audit","sub-key",A]})},revoke:function(e,t){e.read=!1,e.write=!1,_e.grant(e,t)},set_uuid:function(e){le=e,F()},get_uuid:function(){return le},isArray:function(e){return isArray(e)},get_subscibed_channels:function(){return generate_channel_list(X,!0)},presence_heartbeat:function(e){var n=e.callback||function(){},r=e.error||function(){},o=ue(),i={uuid:le,auth:B},s=JSON.stringify(Q);s.length>2&&(i.state=JSON.stringify(Q)),Z>0&&320>Z&&(i.heartbeat=Z),"0"!=o&&(i.callback=o);var a=encode(generate_channel_list(X,!0).join(",")),u=generate_channel_group_list(Y,!0).join(",");a||(a=","),u&&(i["channel-group"]=u),fe&&(i.instanceid=he),oe({callback:o,data:t(i),timeout:5*SECOND,url:[U,"v2","presence","sub-key",A,"channel",a,"heartbeat"],success:function(e){d(e,n,r)},fail:function(e){_(e,r)}})},stop_timers:function(){clearTimeout(E),clearTimeout(S)},xdr:oe,ready:ready,db:ce,uuid:generate_uuid,map:map,each:each,"each-channel":h,grep:grep,offline:function(){m(1,{message:"Offline. Please check your network settings."})},supplant:supplant,now:rnow,unique:unique,updater:updater};return le||(le=_e.uuid()),he||(he=_e.uuid()),ce.set(A+"uuid",le),E=timeout(g,SECOND),S=timeout(b,R),$=timeout(p,(ee-3)*SECOND),w(),_e}function crypto_obj(){function e(e){return CryptoJS.SHA256(e).toString(CryptoJS.enc.Hex)}function t(e){return e=e||{},e.hasOwnProperty("encryptKey")||(e.encryptKey=p.encryptKey),e.hasOwnProperty("keyEncoding")||(e.keyEncoding=p.keyEncoding),e.hasOwnProperty("keyLength")||(e.keyLength=p.keyLength),e.hasOwnProperty("mode")||(e.mode=p.mode),-1==a.indexOf(e.keyEncoding.toLowerCase())&&(e.keyEncoding=p.keyEncoding),-1==u.indexOf(parseInt(e.keyLength,10))&&(e.keyLength=p.keyLength),-1==c.indexOf(e.mode.toLowerCase())&&(e.mode=p.mode),e}function n(e,t){return"base64"==t.keyEncoding?CryptoJS.enc.Base64.parse(e):"hex"==t.keyEncoding?CryptoJS.enc.Hex.parse(e):e}function r(t,r){return t=n(t,r),r.encryptKey?CryptoJS.enc.Utf8.parse(e(t).slice(0,32)):t}function o(e){return"ecb"==e.mode?CryptoJS.mode.ECB:CryptoJS.mode.CBC}function i(e){return"cbc"==e.mode?CryptoJS.enc.Utf8.parse(s):null}var s="0123456789012345",a=["hex","utf8","base64","binary"],u=[128,256],c=["ecb","cbc"],p={encryptKey:!0,keyEncoding:"utf8",keyLength:256,mode:"cbc"};return{encrypt:function(e,n,s){if(!n)return e;s=t(s);var a=i(s),u=o(s),c=r(n,s),p=JSON.stringify(e),l=CryptoJS.AES.encrypt(p,c,{iv:a,mode:u}).ciphertext,f=l.toString(CryptoJS.enc.Base64);return f||e},decrypt:function(e,n,s){if(!n)return e;s=t(s);var a=i(s),u=o(s),c=r(n,s);try{var p=CryptoJS.enc.Base64.parse(e),l=CryptoJS.AES.decrypt({ciphertext:p},c,{iv:a,mode:u}).toString(CryptoJS.enc.Utf8),f=JSON.parse(l);return f}catch(h){return void 0}}}}var RingCentral;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e,t){this.setPrefix(t),this._storage=e}return e.prototype.setPrefix=function(e){return this._prefix=e||"rc-",this},e.prototype.setItem=function(e,t){return this._storage[this._prefixKey(e)]=JSON.stringify(t),this},e.prototype.removeItem=function(e){return delete this._storage[this._prefixKey(e)],this},e.prototype.getItem=function(e){var t=this._storage[this._prefixKey(e)];return t?JSON.parse(t):null},e.prototype.clean=function(){for(var e in this._storage)this._storage.hasOwnProperty(e)&&0===e.indexOf(this._prefix)&&delete this._storage[e];return this},e.prototype._prefixKey=function(e){return this._prefix+e},e}();e.Cache=t}(t=e.core||(e.core={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(e){e||(e={log:function(){},warn:function(){},info:function(){},error:function(){}}),this._console=e,this.logDebug=!1,this.logInfo=!1,this.logWarnings=!1,this.logErrors=!1,this.addTimestamps=!1}return t.prototype.disableAll=function(){this.logDebug=!1,this.logInfo=!1,this.logWarnings=!1,this.logErrors=!1},t.prototype.enableAll=function(){this.logDebug=!0,this.logInfo=!0,this.logWarnings=!0,this.logErrors=!0},t.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.logDebug&&this._console.log.apply(this._console,this._parseArguments(arguments))},t.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.logInfo&&this._console.info.apply(this._console,this._parseArguments(arguments))},t.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.logWarnings&&this._console.warn.apply(this._console,this._parseArguments(arguments))},t.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.logErrors&&this._console.error.apply(this._console,this._parseArguments(arguments))},t.prototype.stack=function(){var e=new Error;return e.hasOwnProperty("stack")?e.stack.replace("Error\n","Stack Trace\n"):void 0},t.prototype._parseArguments=function(t){return t=e.utils.argumentsToArray(t),this.addTimestamps&&t.unshift((new Date).toLocaleString(),"-"),t},t}();e.Log=t,e.log=new t}(t=e.core||(e.core={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){function t(e,n){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];var i,s,a,u,l,f,h=arguments[0]||{},_=1,y=arguments.length,g=!1;for("boolean"==typeof h&&(g=h,h=arguments[_]||{},_++),"object"==typeof h||c(h)||(h={});y>_;_++)if(null!==(i=arguments[_]))for(s in i)a=h[s],u=i[s],h!==u&&(g&&u&&(d(u)||(l=p(u)))?(l?(l=!1,f=a&&p(a)?a:[]):f=a&&d(a)?a:{},h[s]=t(g,f,u)):void 0!==u&&(h[s]=u));return h}function n(e,t){for(var n in e)if(e.hasOwnProperty(n)){var r=t(e[n],n);if(r===!1)break}}function r(e){var t=[];return n(e,function(e,n){p(e)?e.forEach(function(e){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}),t.join("&")}function o(e){var t={},n=this;return e.split("&").forEach(function(e){if(e=decodeURIComponent(e),-1==e.indexOf("="))t[e.trim()]=!0;else{var r=e.split("="),o=r[0].trim(),i=r[1].trim();o in t?(o in t&&!n.isArray(t[o])&&(t[o]=[t[o]]),t[o].push(i)):t[o]=i}}),t}function i(e,t){return t?/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?[ ,;]*)+$/i.test(e):/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i.test(e)}function s(e){return/\+?1[0-9]{3}[0-9a-z]{7}/im.test(e.toString().split(/[^0-9a-z\+]/im).join(""))}function a(e){return Array.prototype.slice.call(e||[],0)}function u(e){return"date"===h(e)}function c(e){return"function"===h(e)}function p(e){return Array.isArray?Array.isArray(e):"array"===h(e)}function l(e){return e&&"object"==typeof e&&"setInterval"in e}function f(e){return null===e||!S.test(e)||isNaN(e)}function h(e){return null===e?String(e):x[E.call(e)]||"object"}function d(e){if(!e||"object"!==h(e)||e.nodeType||l(e))return!1;if(e.constructor&&!w.call(e,"constructor")&&!w.call(e.constructor.prototype,"isPrototypeOf"))return!1;var t;for(t in e);return void 0===t||w.call(e,t)}function _(e,t){return t.split(/[.[\]]/).reduce(function(e,t){return e?t?e[t]:e:void 0},e)}function y(e,t,n){g(n),t=t||1e3;var r=function(n){return n=n||t,t=n,setTimeout(function(){e(r,n)},n)};return r()}function g(e){e&&clearTimeout(e)}function b(e){return e?e.toString():""}function m(e){return e?(e=parseFloat(e),f(e)?0:e):0}function v(){return"undefined"!=typeof process}function k(){return"undefined"!=typeof window}var w=Object.prototype.hasOwnProperty,E=Object.prototype.toString,S=/\d/,x={};"Boolean Number String Function Array Date RegExp Object".split(" ").forEach(function(e){x["[object "+e+"]"]=e.toLowerCase()}),e.extend=t,e.forEach=n,e.queryStringify=r,e.parseQueryString=o,e.isEmail=i,e.isPhoneNumber=s,e.argumentsToArray=a,e.isDate=u,e.isFunction=c,e.isArray=p,e.isWindow=l,e.isNan=f,e.type=h,e.isPlainObject=d,e.getProperty=_,e.poll=y,e.stopPolling=g,e.parseString=b,e.parseNumber=m,e.isNodeJS=v,e.isBrowser=k}(t=e.utils||(e.utils={}))}(t=e.core||(e.core={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(){if(!(this instanceof t))throw new Error("Observable(): New operator was omitted");this.off()}return t.prototype.hasListeners=function(e){return e in this._listeners},t.prototype.on=function(e,t){var n=this;if("string"==typeof e&&(e=[e]),!e)throw new Error("No events to subscribe to");if("function"!=typeof t)throw new Error("Callback must be a function");return e.forEach(function(e){n.hasListeners(e)||(n._listeners[e]=[]),n._listeners[e].push(t)}),this},t.prototype.emit=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=null;return this.hasListeners(e)?(this._listeners[e].some(function(e){return o=e.apply(t,n),o===!1}),o):null},t.prototype.off=function(e,t){var n=this;if(e)if(t){if(!this.hasListeners(e))return this;this._listeners[e].forEach(function(r,o){r===t&&delete n._listeners[e][o]})}else delete this._listeners[e];else this._listeners={};return this},t.prototype.destroy=function(){return this.off(),e.log.debug("Observable.destroy(): Listeners were destroyed"),this},t}();e.Observable=t}(t=e.core||(e.core={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},RingCentral;!function(e){var t;!function(e){var t;!function(e){var t=function(e){function t(){var t=this;e.call(this),this.events={change:"change"};var n="hidden",r=function(e){e=e||window.event;var r="visible",o="hidden",i={focus:r,focusin:r,pageshow:r,blur:o,focusout:o,pagehide:o};t._visible=e.type in i?i[e.type]==r:!document[n],t.emit(t.events.change,t._visible)};this._visible=!0,"undefined"!=typeof document&&"undefined"!=typeof window&&(n in document?document.addEventListener("visibilitychange",r):(n="mozHidden")in document?document.addEventListener("mozvisibilitychange",r):(n="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",r):(n="msHidden")in document?document.addEventListener("msvisibilitychange",r):"onfocusin"in document?document.onfocusin=document.onfocusout=r:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=r)}return __extends(t,e),t.prototype.visible=function(){return this._visible},t}(e.Observable);e.PageVisibility=t}(t=e.core||(e.core={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(e,t,n,r,o,i){this._method=e.toUpperCase(),this._path=t,this._json=n||{},this._delay=i||10,this._status=r||200,this._statusText=o||"OK"}return t.prototype.path=function(){return this._path},t.prototype.method=function(){return this._method},t.prototype.test=function(e){return e.url.indexOf(this._path)>-1&&e.method.toUpperCase()==this._method},t.prototype.getResponse=function(t){var n=this;return new e.externals._Promise(function(e,t){setTimeout(function(){e(n.createResponse(n._json))},n._delay)})},t.prototype.createResponse=function(t,n){n=n||{},n.status=n.status||this._status,n.statusText=n.statusText||this._statusText;var r=JSON.stringify(t),o=e.http.Client.createResponse(r,n);return o.headers.set(e.http.ApiResponse.contentType,e.http.ApiResponse.jsonContentType),o},t}();t.Mock=n}(t=e.mocks||(e.mocks={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(){this._mocks=[]}return t.prototype.add=function(e){return this._mocks.push(e),this},t.prototype.clear=function(){return this._mocks=[],this},t.prototype.find=function(e){var t=this._mocks.shift();if(!t)throw new Error("No mock in registry for request "+e.method+" "+e.url);if(!t.test(e))throw new Error("Wrong request "+e.method+" "+e.url+" for expected mock "+t.method()+" "+t.path());return t},t.prototype.apiCall=function(t,n,r,o,i){return this.add(new e.Mock(t,n,r,o,i)),this},t.prototype.authentication=function(){return this.apiCall("POST","/restapi/oauth/token",{access_token:"ACCESS_TOKEN",token_type:"bearer",expires_in:3600,refresh_token:"REFRESH_TOKEN",refresh_token_expires_in:60480,scope:"SMS RCM Foo Boo",expireTime:(new Date).getTime()+36e5
}),this},t.prototype.logout=function(){return this.apiCall("POST","/restapi/oauth/revoke",{}),this},t.prototype.presenceLoad=function(e){return this.apiCall("GET","/restapi/v1.0/account/~/extension/"+e+"/presence",{uri:"https://platform.ringcentral.com/restapi/v1.0/account/123/extension/"+e+"/presence",extension:{uri:"https://platform.ringcentral.com/restapi/v1.0/account/123/extension/"+e,id:e,extensionNumber:"101"},activeCalls:[],presenceStatus:"Available",telephonyStatus:"Ringing",userStatus:"Available",dndStatus:"TakeAllCalls",extensionId:e}),this},t.prototype.subscribeGeneric=function(e){e=e||54e3;var t=new Date;return this.apiCall("POST","/restapi/v1.0/subscription",{eventFilters:["/restapi/v1.0/account/~/extension/~/presence"],expirationTime:new Date(t.getTime()+1e3*e).toISOString(),expiresIn:e,deliveryMode:{transportType:"PubNub",encryption:!1,address:"123_foo",subscriberKey:"sub-c-foo",secretKey:"sec-c-bar"},id:"foo-bar-baz",creationTime:t.toISOString(),status:"Active",uri:"https://platform.ringcentral.com/restapi/v1.0/subscription/foo-bar-baz"}),this},t.prototype.subscribeOnPresence=function(e,t){e=e||"1";var n=new Date;return this.apiCall("POST","/restapi/v1.0/subscription",{eventFilters:["/restapi/v1.0/account/~/extension/"+e+"/presence"+(t?"?detailedTelephonyState=true":"")],expirationTime:new Date(n.getTime()+54e6).toISOString(),deliveryMode:{transportType:"PubNub",encryption:!0,address:"123_foo",subscriberKey:"sub-c-foo",secretKey:"sec-c-bar",encryptionAlgorithm:"AES",encryptionKey:"VQwb6EVNcQPBhE/JgFZ2zw=="},creationTime:n.toISOString(),id:"foo-bar-baz",status:"Active",uri:"https://platform.ringcentral.com/restapi/v1.0/subscription/foo-bar-baz"}),this},t.prototype.tokenRefresh=function(e){return e?this.apiCall("POST","/restapi/oauth/token",{message:"Wrong token",error_description:"Wrong token",description:"Wrong token"},400):this.apiCall("POST","/restapi/oauth/token",{access_token:"ACCESS_TOKEN_FROM_REFRESH",token_type:"bearer",expires_in:3600,refresh_token:"REFRESH_TOKEN_FROM_REFRESH",refresh_token_expires_in:60480,scope:"SMS RCM Foo Boo"}),this},t}();e.Registry=t}(t=e.mocks||(e.mocks={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(e){function t(){var t=Function("return this")();return e._PUBNUB||(e._PUBNUB=t.PUBNUB),e._Promise||(e._Promise=t.Promise),e._fetch||(e._fetch=t.fetch),e._Headers||(e._Headers=t.Headers),e._Request||(e._Request=t.Request),e._Response||(e._Response=t.Response),e}e._Promise,e._fetch,e._Response,e._Request,e._Headers,e._PUBNUB,e.get=t}(t=e.externals||(e.externals={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var n=function(){function n(e,t,n){this._text=n,this._request=e,this._response=t,this._json=null,this._multipartTransactions=null}return n.prototype.response=function(){return this._response},n.prototype.request=function(){return this._request},n.prototype.ok=function(){return this._response&&this._response.ok},n.prototype.text=function(){return this._text},n.prototype.json=function(){if(!this._isJson())throw new Error("Response is not JSON");return this._json||(this._json=this._text?JSON.parse(this._text):null),this._json},n.prototype.error=function(e){if(this.ok()&&!e)return null;var t=(this._response&&this._response.status?this._response.status+" ":"")+(this._response&&this._response.statusText?this._response.statusText:"");try{var n=this.json();n.message&&(t=n.message),n.error_description&&(t=n.error_description),n.description&&(t=n.description)}catch(r){}return t},n.prototype.multipart=function(){if(!this._isMultipart())throw new Error("Response is not multipart");if(null===this._multipartTransactions){if(!this._text)throw new Error("No response body");var e=this._response.headers.get("Content-Type").match(/boundary=([^;]+)/i)[1];if(!e)throw new Error("Cannot find boundary");var t=this._text.toString().split(n.boundarySeparator+e);if(""===t[0].trim()&&t.shift(),t[t.length-1].trim()==n.boundarySeparator&&t.pop(),t.length<1)throw new Error("No parts in body");var r=n.create(t.shift(),this._response.status,this._response.statusText);this._multipartTransactions=t.map(function(e,t){var o=r.json().response[t].status;return n.create(e,o)})}return this._multipartTransactions},n.prototype.multipartJson=function(){return this.multipart().map(function(e){return e.json()})},n.prototype._isContentType=function(e){return this._getContentType().indexOf(e)>-1},n.prototype._getContentType=function(){return this._response.headers.get(n.contentType)||""},n.prototype._isMultipart=function(){return this._isContentType(n.multipartContentType)},n.prototype._isUrlEncoded=function(){return this._isContentType(n.urlencodedContentType)},n.prototype._isJson=function(){return this._isContentType(n.jsonContentType)},n.create=function(r,o,i){o=o||200,i=i||"OK",r=r.replace(/\r/g,"");var s=new e.externals._Headers,a=r.split(n.bodySeparator),u=a.length>1?a.shift():"";return r=a.join(n.bodySeparator),(u||"").split("\n").forEach(function(e){var t=e.trim().split(n.headerSeparator),r=t.shift().trim(),o=t.join(n.headerSeparator).trim();r&&s.append(r,o)}),new n(null,t.Client.createResponse(r,{headers:s,status:o,statusText:i}),r)},n.contentType="Content-Type",n.jsonContentType="application/json",n.multipartContentType="multipart/mixed",n.urlencodedContentType="application/x-www-form-urlencoded",n.headerSeparator=":",n.bodySeparator="\n\n",n.boundarySeparator="--",n}();t.ApiResponse=n}(t=e.http||(e.http={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var n=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"],r=function(r){function o(){r.apply(this,arguments),this.events={beforeRequest:"beforeRequest",requestSuccess:"requestSuccess",requestError:"requestError"}}return __extends(o,r),o.prototype.sendRequest=function(n){var r=this,i=new t.ApiResponse(n);return new e.externals._Promise(function(e){r.emit(r.events.beforeRequest,i),e(r._loadResponse(n))}).then(function(e){return i._response=o.cloneResponse(e),e.text()}).then(function(e){if(i._text=e,!i.ok())throw o.makeError(new Error("Response has unsuccessful status"),i);return r.emit(r.events.requestSuccess,i),i})["catch"](function(e){throw e.apiResponse||(e=o.makeError(e,i)),r.emit(r.events.requestError,e),e})},o.prototype._loadResponse=function(t){return e.externals._fetch.call(null,t)},o.makeError=function(e,t){var n=e;return n.hasOwnProperty("apiResponse")||n.hasOwnProperty("originalMessage")||(n.apiResponse=t,n.originalMessage=n.message,n.message=t&&t.error(!0)||n.originalMessage),n},o.cloneResponse=function(t){if(e.core.utils.isFunction(t.clone))return t.clone();var n="";t.hasOwnProperty("_bodyInit")&&(n=t._bodyInit),t.hasOwnProperty("_bodyText")&&(n=t._bodyText),t.hasOwnProperty("_bodyBlob")&&(n=t._bodyBlob.slice()),t.hasOwnProperty("_bodyFormData")&&(n=t._bodyFormData),t.hasOwnProperty("_raw")&&(n=t._raw.join(""));var r=new e.externals._Response(n,t);return t.hasOwnProperty("body")&&(r.body=t.body),r},o.createResponse=function(t,n){return n=n||{},new e.externals._Response(t,n)},o.createRequest=function(t,r){r=r||{};var o=r.body,i=new e.externals._Request(t,e.core.utils.extend({},r,{body:null}));if(!i.url)throw new Error("Url is not defined");if(i.method||(i.method="GET"),i.method&&n.indexOf(i.method)<0)throw new Error("Method has wrong value: "+i.method);if(i.headers.has("Accept")||i.headers.set("Accept","application/json"),e.core.utils.isPlainObject(r.body)||!r.body){i.headers.has("Content-Type")||i.headers.set("Content-Type","application/json");var s=i.headers.get("Content-Type");s.indexOf("application/json")>-1?o=JSON.stringify(r.body):s.indexOf("application/x-www-form-urlencoded")>-1&&(o=e.core.utils.queryStringify(r.body))}return i.credentials="include",i.mode="cors",r.query&&(i.url=i.url+(i.url.indexOf("?")>-1?"&":"?")+e.core.utils.queryStringify(r.query)),i=new e.externals._Request(i.url,e.core.utils.extend(i,{body:o})),i.body=r.body,i},o}(e.core.Observable);t.Client=r}(t=e.http||(e.http={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(e,t){this._cache=e,this._cacheId=t,this.setPollInterval(250),this.setReleaseTimeout(5e3)}return t.prototype.isPaused=function(){var e=this._cache,t=this._cacheId,n=e.getItem(t);return!!n&&Date.now()-parseInt(n)<this._releaseTimeout},t.prototype.pause=function(){return this._cache.setItem(this._cacheId,Date.now()),this},t.prototype.resume=function(){return this._cache.removeItem(this._cacheId),this},t.prototype.poll=function(){var t=this;return this._promise?this._promise:(this._promise=new e.externals._Promise(function(n,r){e.core.utils.poll(function(e){return t.isPaused()?e():(t._promise=null,t.resume(),void n(null))},t._pollInterval)}),this._promise)},t.prototype.releaseTimeout=function(){return this._releaseTimeout},t.prototype.pollInterval=function(){return this._pollInterval},t.prototype.setReleaseTimeout=function(e){return this._releaseTimeout=e,this},t.prototype.setPollInterval=function(e){return this._pollInterval=e,this},t}();t.Queue=n}(t=e.platform||(e.platform={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var n=function(n){function r(e,r,o,i,s,a){n.call(this),this._refreshDelayMs=100,this._clearCacheOnRefreshError=!0,this._cacheId="platform",this.events={accessViolation:"accessViolation",logoutSuccess:"logoutSuccess",logoutError:"logoutError",authorizeSuccess:"authorizeSuccess",authorizeError:"authorizeError",refreshSuccess:"refreshSuccess",refreshError:"refreshError"},this._server=i,this._appKey=s,this._appSecret=a,this._cache=r,this._client=e,this._queue=new t.Queue(this._cache,this._cacheId+"-refresh"),this._auth=new t.Auth(this._cache,this._cacheId)}return __extends(r,n),r.prototype.auth=function(){return this._auth},r.prototype.createUrl=function(e,t){e=e||"",t=t||{};var n="",o=-1!=e.indexOf("http://")||-1!=e.indexOf("https://");return t.addServer&&!o&&(n+=this._server),-1!=e.indexOf(r._urlPrefix)||o||(n+=r._urlPrefix+"/"+r._apiVersion),n+=e,(t.addMethod||t.addToken)&&(n+=e.indexOf("?")>-1?"&":"?"),t.addMethod&&(n+="_method="+t.addMethod),t.addToken&&(n+=(t.addMethod?"&":"")+"access_token="+this._auth.accessToken()),n},r.prototype.authUrl=function(t){return t=t||{},this.createUrl(r._authorizeEndpoint+"?"+e.core.utils.queryStringify({response_type:"code",redirect_uri:t.redirectUri||"",client_id:this._appKey,state:t.state||"",brand_id:t.brandId||"",display:t.display||"",prompt:t.prompt||""}),{addServer:!0})},r.prototype.parseAuthRedirectUrl=function(t){var n=e.core.utils.parseQueryString(t.split("?").reverse()[0]),r=n.error_description||n.error;if(r){var o=new Error(r);throw o.error=n.error,o}return n},r.prototype.loggedIn=function(){return this._ensureAuthentication().then(function(){return!0})["catch"](function(){return!1})},r.prototype.login=function(e){var t=this;e=e||{},e.remember=e.remember||!1;var n={access_token_ttl:r._accessTokenTtl,refresh_token_ttl:e.remember?r._refreshTokenTtlRemember:r._refreshTokenTtl};return e.code?e.code&&(n.grant_type="authorization_code",n.code=e.code,n.redirect_uri=e.redirectUri):(n.grant_type="password",n.username=e.username,n.password=e.password,n.extension=e.extension||""),e.endpointId&&(n.endpoint_id=e.endpointId),this._tokenRequest(r._tokenEndpoint,n).then(function(n){return t._auth.setData(n.json()).setRemember(e.remember),t.emit(t.events.authorizeSuccess,n),n})["catch"](function(e){throw t._cache.clean(),t.emit(t.events.authorizeError,e),e})},r.prototype.refresh=function(){var t=this,n=new e.externals._Promise(function(n,o){return t._queue.isPaused()?n(t._refreshPolling()):(t._queue.pause(),void setTimeout(function(){return e.core.log.debug("Platform.refresh(): Performing token refresh (access token",t._auth.accessToken(),", refresh token",t._auth.refreshToken(),")"),t._auth.refreshToken()?t._auth.refreshTokenValid()?t._queue.isPaused()?void n(t._tokenRequest(r._tokenEndpoint,{grant_type:"refresh_token",refresh_token:t._auth.refreshToken(),access_token_ttl:r._accessTokenTtl,refresh_token_ttl:t._auth.remember()?r._refreshTokenTtlRemember:r._refreshTokenTtl})):o(new Error("Queue was resumed before refresh call")):o(new Error("Refresh token has expired")):o(new Error("Refresh token is missing"))},t._refreshDelayMs))});return n.then(function(n){if(n&&n.json&&n.json()){var r=n.json();if(e.core.log.info("Platform.refresh(): Token was refreshed",n),!r.refresh_token||!r.access_token)throw e.http.Client.makeError(new Error("Malformed OAuth response"),n);t._auth.setData(r),t._queue.resume()}return t.emit(t.events.refreshSuccess,n),n})["catch"](function(n){throw n=e.http.Client.makeError(n),t._clearCacheOnRefreshError&&t._cache.clean(),t.emit(t.events.accessViolation,n),t.emit(t.events.refreshError,n),n})},r.prototype.logout=function(){var e=this;return this._queue.pause(),this._tokenRequest(r._revokeEndpoint,{token:this._auth.accessToken()}).then(function(t){return e._queue.resume(),e._cache.clean(),e.emit(e.events.logoutSuccess,t),t})["catch"](function(t){throw e._queue.resume(),e.emit(e.events.accessViolation,t),e.emit(e.events.logoutError,t),t})},r.prototype.inflateRequest=function(t,n){var r=this;return n=n||{},n.skipAuthCheck?e.externals._Promise.resolve(t):this._ensureAuthentication().then(function(){return t.headers.set("Authorization",r._authHeader()),t.url=r.createUrl(t.url,{addServer:!0}),t})},r.prototype.sendRequest=function(e,t){var n=this;return this.inflateRequest(e,t).then(function(e){return n._client.sendRequest(e)})["catch"](function(r){if(!r.apiResponse||!r.apiResponse.response()||401!=r.apiResponse.response().status)throw r;return n._auth.cancelAccessToken(),n.sendRequest(e,t)})},r.prototype.send=function(t,n){try{return t=this.createUrl(t,{addServer:!0}),this.sendRequest(e.http.Client.createRequest(t,n),n)}catch(r){return e.externals._Promise.reject(r)}},r.prototype.get=function(e,t){return t=t||{},t.method="GET",this.send(e,t)},r.prototype.post=function(e,t){return t=t||{},t.method="POST",this.send(e,t)},r.prototype.put=function(e,t){return t=t||{},t.method="PUT",this.send(e,t)},r.prototype["delete"]=function(e,t){return t=t||{},t.method="DELETE",this.send(e,t)},r.prototype._tokenRequest=function(e,t){return this.send(e,{skipAuthCheck:!0,body:t,method:"POST",headers:{Authorization:"Basic "+this._apiKey(),"Content-Type":"application/x-www-form-urlencoded"}})},r.prototype._ensureAuthentication=function(){return this._isAccessTokenValid()?e.externals._Promise.resolve(null):this.refresh()},r.prototype._isAccessTokenValid=function(){return this._auth.accessTokenValid()&&!this._queue.isPaused()},r.prototype._refreshPolling=function(){var t=this;return e.core.log.warn("Platform.refresh(): Refresh is already in progress, polling started"),this._queue.poll().then(function(){if(!t._isAccessTokenValid())throw new Error("Automatic authentification timeout");return null})},r.prototype._apiKey=function(){var e=this._appKey+":"+this._appSecret;return"function"==typeof btoa?btoa(e):new Buffer(e).toString("base64")},r.prototype._authHeader=function(){var e=this._auth.accessToken();return this._auth.tokenType()+(e?" "+e:"")},r._urlPrefix="/restapi",r._apiVersion="v1.0",r._accessTokenTtl=null,r._refreshTokenTtl=36e3,r._refreshTokenTtlRemember=604800,r._tokenEndpoint="/restapi/oauth/token",r._revokeEndpoint="/restapi/oauth/revoke",r._authorizeEndpoint="/restapi/oauth/authorize",r}(e.core.Observable);t.Platform=n}(t=e.platform||(e.platform={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(e,n){t.call(this),this._renewHandicapMs=12e4,this.events={notification:"notification",removeSuccess:"removeSuccess",removeError:"removeError",renewSuccess:"renewSuccess",renewError:"renewError",subscribeSuccess:"subscribeSuccess",subscribeError:"subscribeError"},this._pubnubFactory=e,this._platform=n,this._pubnub=null,this._eventFilters=[],this._timeout=null,this._subscription=null}return __extends(n,t),n.prototype.alive=function(){return this._subscription&&this._subscription.id&&this._subscription.deliveryMode&&this._subscription.deliveryMode.subscriberKey&&this._subscription.deliveryMode.address},n.prototype.setSubscription=function(e){return this._clearTimeout(),this._subscription=e,this._pubnub||this._subscribeAtPubnub(),this._setTimeout(),this},n.prototype.subscription=function(){return this._subscription},n.prototype.register=function(e){return this.alive()?this.renew(e):this.subscribe(e)},n.prototype.addEvents=function(e){return this._eventFilters=this._eventFilters.concat(e),this},n.prototype.setEvents=function(e){return this._eventFilters=e,this},n.prototype.subscribe=function(t){var n=this;return t=t||{},t.events&&this.setEvents(t.events),this._clearTimeout(),new e.externals._Promise(function(e,t){if(!n._eventFilters||!n._eventFilters.length)throw new Error("Events are undefined");e(n._platform.post("/restapi/v1.0/subscription",{body:{eventFilters:n._getFullEventFilters(),deliveryMode:{transportType:"PubNub"}}}))}).then(function(e){return n.setSubscription(e.json()).emit(n.events.subscribeSuccess,e),e})["catch"](function(t){throw t=e.http.Client.makeError(t),n.reset().emit(n.events.subscribeError,t),t})},n.prototype.renew=function(t){var n=this;return t=t||{},t.events&&this.setEvents(t.events),this._clearTimeout(),new e.externals._Promise(function(e,t){if(!n.alive())throw new Error("Subscription is not alive");if(!n._eventFilters||!n._eventFilters.length)throw new Error("Events are undefined");return n._platform.put("/restapi/v1.0/subscription/"+n._subscription.id,{body:{eventFilters:n._getFullEventFilters()}})}).then(function(e){return n.setSubscription(e.json()).emit(n.events.renewSuccess,e.json()),e})["catch"](function(t){throw t=e.http.Client.makeError(t),n.reset().emit(n.events.renewError,t),t})},n.prototype.remove=function(){var t=this;return new e.externals._Promise(function(e,n){if(!t._subscription||!t._subscription.id)throw new Error("Subscription ID is required");e(t._platform["delete"]("/restapi/v1.0/subscription/"+t._subscription.id))}).then(function(e){return t.reset().emit(t.events.removeSuccess,e),e})["catch"](function(n){throw n=e.http.Client.makeError(n),t.emit(t.events.removeError,n),n})},n.prototype.reset=function(){return this._clearTimeout(),this.alive()&&this._pubnub&&this._pubnub.unsubscribe({channel:this._subscription.deliveryMode.address}),this._subscription=null,this},n.prototype.destroy=function(){return this.reset(),e.core.log.info("RC.subscription.Subscription: Destroyed"),t.prototype.destroy.call(this)},n.prototype._getFullEventFilters=function(){var e=this;return this._eventFilters.map(function(t){return e._platform.createUrl(t)})},n.prototype._setTimeout=function(){var e=this;if(this._clearTimeout(),!this.alive())throw new Error("Subscription is not alive");var t=1e3*this._subscription.expiresIn-this._renewHandicapMs;return this._timeout=setTimeout(function(){e.renew({})},t),this},n.prototype._clearTimeout=function(){return clearTimeout(this._timeout),this},n.prototype._decrypt=function(e){if(!this.alive())throw new Error("Subscription is not alive");if(this._subscription.deliveryMode.encryptionKey){var t=this._pubnubFactory.getPubnub();e=t.crypto_obj.decrypt(e,this._subscription.deliveryMode.encryptionKey,{encryptKey:!1,keyEncoding:"base64",keyLength:128,mode:"ecb"})}return e},n.prototype._notify=function(e){return this.emit(this.events.notification,this._decrypt(e)),this},n.prototype._subscribeAtPubnub=function(){var t=this;if(!this.alive())throw new Error("Subscription is not alive");var n=this._pubnubFactory.getPubnub();return this._pubnub=n.init({ssl:!0,subscribe_key:this._subscription.deliveryMode.subscriberKey}),this._pubnub.ready(),this._pubnub.subscribe({channel:this._subscription.deliveryMode.address,message:function(n,r,o){e.core.log.info("RC.core.Subscription: Incoming message",n),t._notify(n)},connect:function(){e.core.log.info("RC.core.Subscription: PUBNUB connected")}}),this},n}(e.core.Observable);t.Subscription=n}(t=e.subscription||(e.subscription={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(n){t.call(this),this.options=n,this.crypto_obj=e.externals._PUBNUB.crypto_obj}return __extends(n,t),n.prototype.ready=function(){},n.prototype.subscribe=function(e){this.on("message-"+e.channel,e.message)},n.prototype.unsubscribe=function(e){this.off("message-"+e.channel)},n.prototype.receiveMessage=function(e,t){this.emit("message-"+t,e,"env",t)},n}(e.core.Observable);t.PubnubMock=n;var r=function(){function t(){this.crypto_obj=e.externals._PUBNUB.crypto_obj}return t.prototype.init=function(e){return new n(e)},t}();t.PubnubMockFactory=r}(t=e.pubnub||(e.pubnub={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var n=function(){function n(e){this._useMock=!1,this._useMock=!!e,this._mock=new t.PubnubMockFactory}return n.prototype.getPubnub=function(){return this._useMock?this._mock:e.externals._PUBNUB},n}();t.PubnubFactory=n}(t=e.pubnub||(e.pubnub={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t=function(){function t(t){t=t||{},e.externals.get(),this._mockRegistry=new e.mocks.Registry,this._cache=new e.core.Cache("undefined"!=typeof localStorage?localStorage:{},t.cachePrefix),this._queue=new e.platform.Queue(this._cache,"platform-refresh"),this._client=t.useHttpMock?new e.http.ClientMock(this._mockRegistry):new e.http.Client,this._platform=new e.platform.Platform(this._client,this._cache,this._queue,t.server,t.appKey,t.appSecret),this._pubnubFactory=new e.pubnub.PubnubFactory(t.usePubnubMock)}return t.prototype.platform=function(){return this._platform},t.prototype.cache=function(){return this._cache},t.prototype.createSubscription=function(){return new e.subscription.Subscription(this._pubnubFactory,this._platform)},t.prototype.createPageVisibility=function(){return new e.core.PageVisibility},t.prototype.createObservable=function(){return new e.core.Observable},t.prototype.log=function(){return e.core.log},t.prototype.utils=function(){return e.core.utils},t.prototype.mockRegistry=function(){return this._mockRegistry},t.version="2.0.0",t.server={sandbox:"https://platform.devtest.ringcentral.com",production:"https://platform.ringcentral.com"},t}();e.SDK=t}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var e=RingCentral.sdk.externals.get();"function"==typeof define&&define.amd?define(["pubnub"],function(t){return e._PUBNUB=t,RingCentral.sdk}):"object"==typeof module&&module.exports&&(e._PUBNUB=require("pubnub"),e._Promise="undefined"!=typeof Promise?Promise:require("es6-promise").Promise,e._fetch=require("node-fetch"),e._Request=e._fetch.Request,e._Response=e._fetch.Response,e._Headers=e._fetch.Headers,module.exports=RingCentral.sdk);var RingCentral;!function(e){var t;!function(e){var t;!function(t){var n=function(t){function n(e){t.call(this),this._registry=e}return __extends(n,t),n.prototype._loadResponse=function(t){var n=this;return new e.externals._Promise(function(r){e.core.log.debug("API REQUEST",t.method,t.url);var o=n._registry.find(t);r(o.getResponse(t))})},n}(t.Client);t.ClientMock=n}(t=e.http||(e.http={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={}));var RingCentral;!function(e){var t;!function(e){var t;!function(t){var n=function(){function t(e,t){this._cache=e,this._cacheId=t}return t.prototype.accessToken=function(){return this.data().access_token},t.prototype.refreshToken=function(){return this.data().refresh_token},t.prototype.tokenType=function(){return this.data().token_type},t.prototype.data=function(){return this._cache.getItem(this._cacheId)||{token_type:"",access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}},t.prototype.setData=function(t){var n=this.data();return t=e.core.utils.extend({},n,t),t.expire_time=Date.now()+1e3*t.expires_in,t.refresh_token_expire_time=Date.now()+1e3*t.refresh_token_expires_in,e.core.log.info("Auth.setData(): Tokens were updated, new:",t,", old:",n),this._cache.setItem(this._cacheId,t),this},t.prototype.accessTokenValid=function(){var e=this.data();return e.token_type===t.forcedTokenType||e.expire_time-t.refreshHandicapMs>Date.now()},t.prototype.refreshTokenValid=function(){return this.data().refresh_token_expire_time>Date.now()},t.prototype.cancelAccessToken=function(){return this.setData({access_token:"",expires_in:0})},t.prototype.forceAuthentication=function(){return this.setData({token_type:t.forcedTokenType,access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}),this},t.prototype.setRemember=function(e){return this.setData({remember:e})},t.prototype.remember=function(){return!!this.data().remember},t.refreshHandicapMs=6e4,t.forcedTokenType="forced",t}();t.Auth=n}(t=e.platform||(e.platform={}))}(t=e.sdk||(e.sdk={}))}(RingCentral||(RingCentral={})),function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function t(e){return"function"==typeof e}function n(e){return"object"==typeof e&&null!==e}function r(e,t){Q[J]=e,Q[J+1]=t,J+=2,2===J&&(L?L(p):q())}function o(e){L=e}function i(){var e=process.nextTick,t=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(t)&&"0"===t[1]&&"10"===t[2]&&(e=setImmediate),function(){e(p)}}function s(){return function(){H(p)}}function a(){var e=0,t=new W(p),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function u(){var e=new MessageChannel;return e.port1.onmessage=p,function(){e.port2.postMessage(0)}}function c(){return function(){setTimeout(p,1)}}function p(){for(var e=0;J>e;e+=2){var t=Q[e],n=Q[e+1];t(n),Q[e]=void 0,Q[e+1]=void 0}J=0}function l(){try{var e=require,t=e("vertx");return H=t.runOnLoop||t.runOnContext,s()}catch(n){return c()}}function f(){}function h(){return new TypeError("You cannot resolve a promise with itself")}function d(){return new TypeError("A promises callback cannot return that same promise.")}function _(e){try{return e.then}catch(t){return te.error=t,te}}function y(e,t,n,r){try{e.call(t,n,r)}catch(o){return o}}function g(e,t,n){K(function(e){var r=!1,o=y(n,t,function(n){r||(r=!0,t!==n?v(e,n):w(e,n))},function(t){r||(r=!0,E(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,E(e,o))},e)}function b(e,t){t._state===Z?w(e,t._result):t._state===ee?E(e,t._result):S(t,void 0,function(t){v(e,t)},function(t){E(e,t)})}function m(e,n){if(n.constructor===e.constructor)b(e,n);else{var r=_(n);r===te?E(e,te.error):void 0===r?w(e,n):t(r)?g(e,n,r):w(e,n)}}function v(t,n){t===n?E(t,h()):e(n)?m(t,n):w(t,n)}function k(e){e._onerror&&e._onerror(e._result),x(e)}function w(e,t){e._state===$&&(e._result=t,e._state=Z,0!==e._subscribers.length&&K(x,e))}function E(e,t){e._state===$&&(e._state=ee,e._result=t,K(k,e))}function S(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+Z]=n,o[i+ee]=r,0===i&&e._state&&K(x,e)}function x(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r,o,i=e._result,s=0;s<t.length;s+=3)r=t[s],o=t[s+n],r?T(n,r,o,i):o(i);e._subscribers.length=0}}function C(){this.error=null}function R(e,t){try{return e(t)}catch(n){return ne.error=n,ne}}function T(e,n,r,o){var i,s,a,u,c=t(r);if(c){if(i=R(r,o),i===ne?(u=!0,s=i.error,i=null):a=!0,n===i)return void E(n,d())}else i=o,a=!0;n._state!==$||(c&&a?v(n,i):u?E(n,s):e===Z?w(n,i):e===ee&&E(n,i))}function O(e,t){try{t(function(t){v(e,t)},function(t){E(e,t)})}catch(n){E(e,n)}}function P(e,t){var n=this;n._instanceConstructor=e,n.promise=new e(f),n._validateInput(t)?(n._input=t,n.length=t.length,n._remaining=t.length,n._init(),0===n.length?w(n.promise,n._result):(n.length=n.length||0,n._enumerate(),0===n._remaining&&w(n.promise,n._result))):E(n.promise,n._validationError())}function A(e){return new re(this,e).promise}function B(e){function t(e){v(o,e)}function n(e){E(o,e)}var r=this,o=new r(f);if(!z(e))return E(o,new TypeError("You must pass an array to race.")),o;for(var i=e.length,s=0;o._state===$&&i>s;s++)S(r.resolve(e[s]),void 0,t,n);return o}function M(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(f);return v(n,e),n}function D(e){var t=this,n=new t(f);return E(n,e),n}function N(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function j(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function U(e){this._id=ue++,this._state=void 0,this._result=void 0,this._subscribers=[],f!==e&&(t(e)||N(),this instanceof U||j(),O(this,e))}function I(){var e;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;(!n||"[object Promise]"!==Object.prototype.toString.call(n.resolve())||n.cast)&&(e.Promise=ce)}var F;F=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var H,L,q,z=F,J=0,K=({}.toString,r),V="undefined"!=typeof window?window:void 0,G=V||{},W=G.MutationObserver||G.WebKitMutationObserver,X="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Y="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Q=new Array(1e3);q=X?i():W?a():Y?u():void 0===V&&"function"==typeof require?l():c();var $=void 0,Z=1,ee=2,te=new C,ne=new C;P.prototype._validateInput=function(e){return z(e)},P.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},P.prototype._init=function(){this._result=new Array(this.length)};var re=P;P.prototype._enumerate=function(){for(var e=this,t=e.length,n=e.promise,r=e._input,o=0;n._state===$&&t>o;o++)e._eachEntry(r[o],o)},P.prototype._eachEntry=function(e,t){var r=this,o=r._instanceConstructor;n(e)?e.constructor===o&&e._state!==$?(e._onerror=null,r._settledAt(e._state,t,e._result)):r._willSettleAt(o.resolve(e),t):(r._remaining--,r._result[t]=e)},P.prototype._settledAt=function(e,t,n){var r=this,o=r.promise;o._state===$&&(r._remaining--,e===ee?E(o,n):r._result[t]=n),0===r._remaining&&w(o,r._result)},P.prototype._willSettleAt=function(e,t){var n=this;S(e,void 0,function(e){n._settledAt(Z,t,e)},function(e){n._settledAt(ee,t,e)})};var oe=A,ie=B,se=M,ae=D,ue=0,ce=U;U.all=oe,U.race=ie,U.resolve=se,U.reject=ae,U._setScheduler=o,U._asap=K,U.prototype={constructor:U,then:function(e,t){var n=this,r=n._state;if(r===Z&&!e||r===ee&&!t)return this;var o=new this.constructor(f),i=n._result;if(r){var s=arguments[r-1];K(function(){T(r,o,s,i)})}else S(n,o,e,t);return o},"catch":function(e){return this.then(null,e)}};var pe=I,le={Promise:ce,polyfill:pe};"function"==typeof define&&define.amd?define(function(){return le}):"undefined"!=typeof module&&module.exports?module.exports=le:"undefined"!=typeof this&&(this.ES6Promise=le),pe()}.call(this),function(){"use strict";function e(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function t(e){return"string"!=typeof e&&(e=String(e)),e}function n(e){this.map={},e instanceof n?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function r(e){return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function o(e){return new Promise(function(t,n){
e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function i(e){var t=new FileReader;return t.readAsArrayBuffer(e),o(t)}function s(e){var t=new FileReader;return t.readAsText(e),o(t)}function a(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,"string"==typeof e)this._bodyText=e;else if(h.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(h.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else{if(e)throw new Error("unsupported BodyInit type");this._bodyText=""}},h.blob?(this.blob=function(){var e=r(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(i)},this.text=function(){var e=r(this);if(e)return e;if(this._bodyBlob)return s(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var e=r(this);return e?e:Promise.resolve(this._bodyText)},h.formData&&(this.formData=function(){return this.text().then(p)}),this.json=function(){return this.text().then(JSON.parse)},this}function u(e){var t=e.toUpperCase();return d.indexOf(t)>-1?t:e}function c(e,t){t=t||{};var r=t.body;if(c.prototype.isPrototypeOf(e)){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new n(e.headers)),this.method=e.method,this.mode=e.mode,r||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=e;if(this.credentials=t.credentials||this.credentials||"omit",(t.headers||!this.headers)&&(this.headers=new n(t.headers)),this.method=u(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function p(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(o))}}),t}function l(e){var t=new n,r=e.getAllResponseHeaders().trim().split("\n");return r.forEach(function(e){var n=e.trim().split(":"),r=n.shift().trim(),o=n.join(":").trim();t.append(r,o)}),t}function f(e,t){t||(t={}),this._initBody(e),this.type="default",this.url=null,this.status=t.status,this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof n?t.headers:new n(t.headers),this.url=t.url||""}if(!self.fetch){n.prototype.append=function(n,r){n=e(n),r=t(r);var o=this.map[n];o||(o=[],this.map[n]=o),o.push(r)},n.prototype["delete"]=function(t){delete this.map[e(t)]},n.prototype.get=function(t){var n=this.map[e(t)];return n?n[0]:null},n.prototype.getAll=function(t){return this.map[e(t)]||[]},n.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},n.prototype.set=function(n,r){this.map[e(n)]=[t(r)]},n.prototype.forEach=function(e,t){Object.getOwnPropertyNames(this.map).forEach(function(n){this.map[n].forEach(function(r){e.call(t,r,n,this)},this)},this)};var h={blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in self},d=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];a.call(c.prototype),a.call(f.prototype),self.Headers=n,self.Request=c,self.Response=f,self.fetch=function(e,t){var n;return n=c.prototype.isPrototypeOf(e)&&!t?e:new c(e,t),new Promise(function(e,t){function r(){return"responseURL"in o?o.responseURL:/^X-Request-URL:/m.test(o.getAllResponseHeaders())?o.getResponseHeader("X-Request-URL"):void 0}var o=new XMLHttpRequest;o.onload=function(){var n=1223===o.status?204:o.status;if(100>n||n>599)return void t(new TypeError("Network request failed"));var i={status:n,statusText:o.statusText,headers:l(o),url:r()},s="response"in o?o.response:o.responseText;e(new f(s,i))},o.onerror=function(){t(new TypeError("Network request failed"))},o.open(n.method,n.url,!0),"include"===n.credentials&&(o.withCredentials=!0),"responseType"in o&&h.blob&&(o.responseType="blob"),n.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),o.send("undefined"==typeof n._bodyInit?null:n._bodyInit)})},self.fetch.polyfill=!0}}(),window.JSON&&window.JSON.stringify||function(){function toJSON(e){try{return this.valueOf()}catch(t){return null}}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,o,i,s,a=gap,u=t[e];switch(u&&"object"==typeof u&&(u=toJSON.call(u,e)),"function"==typeof rep&&(u=rep.call(t,e,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(u)){for(i=u.length,n=0;i>n;n+=1)s[n]=str(n,u)||"null";return o=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,o}if(rep&&"object"==typeof rep)for(i=rep.length,n=0;i>n;n+=1)r=rep[n],"string"==typeof r&&(o=str(r,u),o&&s.push(quote(r)+(gap?": ":":")+o));else for(r in u)Object.hasOwnProperty.call(u,r)&&(o=str(r,u),o&&s.push(quote(r)+(gap?": ":":")+o));return o=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,o}}window.JSON||(window.JSON={});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;n>r;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text){return eval("("+text+")")})}();var NOW=1,READY=!1,READY_BUFFER=[],PRESENCE_SUFFIX="-pnpres",DEF_WINDOWING=10,DEF_TIMEOUT=1e4,DEF_SUB_TIMEOUT=310,DEF_KEEPALIVE=60,SECOND=1e3,URLBIT="/",PARAMSBIT="&",PRESENCE_HB_THRESHOLD=5,PRESENCE_HB_DEFAULT=30,SDK_VER="3.7.13",REPL=/{([\w\-]+)}/g,nextorigin=function(){var e=20,t=Math.floor(Math.random()*e);return function(n,r){return n.indexOf("pubsub.")>0&&n.replace("pubsub","ps"+(r?generate_uuid().split("-")[0]:++t<e?t:t=1))||n}}();window.PUBNUB||function(){function e(e,t){var n=CryptoJS.HmacSHA256(e,t);return n.toString(CryptoJS.enc.Base64)}function t(e){return document.getElementById(e)}function n(e){console.error(e)}function r(e,t){var n=[];return each(e.split(/\s+/),function(e){each((t||document).getElementsByTagName(e),function(e){n.push(e)})}),n}function o(e,t,n){each(e.split(","),function(e){var r=function(e){e||(e=window.event),n(e)||(e.cancelBubble=!0,e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation())};t.addEventListener?t.addEventListener(e,r,!1):t.attachEvent?t.attachEvent("on"+e,r):t["on"+e]=r})}function i(){return r("head")[0]}function s(e,t,n){return n?void e.setAttribute(t,n):e&&e.getAttribute&&e.getAttribute(t)}function a(e,t){for(var n in t)if(t.hasOwnProperty(n))try{e.style[n]=t[n]+("|width|height|top|left|".indexOf(n)>0&&"number"==typeof t[n]?"px":"")}catch(r){}}function u(e){return document.createElement(e)}function c(){return b||h()?0:unique()}function p(e){if(b||h())return l(e);var n=u("script"),r=e.callback,o=unique(),a=0,c=e.timeout||DEF_TIMEOUT,p=timeout(function(){m(1,{message:"timeout"})},c),f=e.fail||function(){},d=e.data||{},y=e.success||function(){},g=function(){i().appendChild(n)},m=function(e,r){a||(a=1,n.onerror=null,clearTimeout(p),e||!r||y(r),timeout(function(){e&&f();var n=t(o),r=n&&n.parentNode;r&&r.removeChild(n)},SECOND))};return window[r]=function(e){m(0,e)},e.blocking||(n[_]=_),n.onerror=function(){m(1)},n.src=build_url(e.url,d),s(n,"id",o),g(),m}function l(e){var t,n,r=function(){if(!i){i=1,clearTimeout(a);try{n=JSON.parse(t.responseText)}catch(e){return d(1)}o=1,l(n)}},o=0,i=0,s=e.timeout||DEF_TIMEOUT,a=timeout(function(){d(1,{message:"timeout"})},s),u=e.fail||function(){},c=e.data||{},l=e.success||function(){},f=!e.blocking,d=function(e,n){o||(o=1,clearTimeout(a),t&&(t.onerror=t.onload=null,t.abort&&t.abort(),t=null),e&&u(n))};try{t=h()||window.XDomainRequest&&new XDomainRequest||new XMLHttpRequest,t.onerror=t.onabort=function(e){d(1,e||t&&t.responseText||{error:"Network Connection Error"})},t.onload=t.onloadend=r,t.onreadystatechange=function(){if(t&&4==t.readyState)switch(t.status){case 200:break;default:try{n=JSON.parse(t.responseText),d(1,n)}catch(e){return d(1,{status:t.status,payload:null,message:t.responseText})}return}};var _=build_url(e.url,c);t.open("GET",_,f),f&&(t.timeout=s),t.send()}catch(y){return d(0),b=0,p(e)}return d}function f(){if(!("onLine"in navigator))return 1;try{return navigator.onLine}catch(e){return!0}}function h(){if(!S||!S.get)return 0;var e={id:h.id++,send:function(){},abort:function(){e.id={}},open:function(t,n){h[e.id]=e,S.get(e.id,n)}};return e}var d="https://pubnub.a.ssl.fastly.net/pubnub.swf",_="async",y=navigator.userAgent,g="PubNub-JS-Web/3.7.13",b=-1==y.indexOf("MSIE 6");window.console||(window.console=window.console||{}),console.log||(console.log=console.error=(window.opera||{}).postError||function(){});var m=function(){var e={},t=!1;try{t=window.localStorage}catch(n){}var r=function(e){return-1==document.cookie.indexOf(e)?null:((document.cookie||"").match(RegExp(e+"=([^;]+)"))||[])[1]||null},o=function(e,t){document.cookie=e+"="+t+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"},i=function(){try{return o("pnctest","1"),"1"===r("pnctest")}catch(e){return!1}}();return{get:function(n){try{return t?t.getItem(n):i?r(n):e[n]}catch(o){return e[n]}},set:function(n,r){try{if(t)return t.setItem(n,r)&&0;i&&o(n,r),e[n]=r}catch(s){e[n]=r}}}}(),v={list:{},unbind:function(e){v.list[e]=[]},bind:function(e,t){(v.list[e]=v.list[e]||[]).push(t)},fire:function(e,t){each(v.list[e]||[],function(e){e(t)})}},k=t("pubnub")||0,w=function(l){b=l.jsonp?0:-1==y.indexOf("MSIE 6");var h=l.subscribe_key||"",d=((+l.keepalive||DEF_KEEPALIVE)*SECOND,l.uuid||m.get(h+"uuid")||"",l.leave_on_unload||0);l.xdr=p,l.db=m,l.error=l.error||n,l._is_online=f,l.jsonp_cb=c,l.hmac_SHA256=e,l.crypto_obj=crypto_obj(),l.params={pnsdk:g};var _=function(e){return w(e)},k=PN_API(l);for(var E in k)k.hasOwnProperty(E)&&(_[E]=k[E]);return _.css=a,_.$=t,_.create=u,_.bind=o,_.head=i,_.search=r,_.attr=s,_.events=v,_.init=_,_.secure=_,_.crypto_obj=crypto_obj(),o("beforeunload",window,function(){return d&&_["each-channel"](function(e){_.LEAVE(e.name,0)}),!0}),l.notest?_:(o("offline",window,_.offline),o("offline",document,_.offline),_)};w.init=w,w.secure=w,w.crypto_obj=crypto_obj(),"complete"===document.readyState?timeout(ready,0):o("load",window,function(){timeout(ready,0)});var E=k||{};PUBNUB=w({notest:1,publish_key:s(E,"pub-key"),subscribe_key:s(E,"sub-key"),ssl:!document.location.href.indexOf("https")||"on"==s(E,"ssl"),origin:s(E,"origin"),uuid:s(E,"uuid")}),window.jQuery&&(window.jQuery.PUBNUB=w),"undefined"!=typeof module&&(module.exports=PUBNUB)&&ready();var S=t("pubnubs")||0;k&&(a(k,{position:"absolute",top:-SECOND}),("opera"in window||s(k,"flash"))&&(k.innerHTML="<object id=pubnubs data="+d+"><param name=movie value="+d+"><param name=allowscriptaccess value=always></object>"),PUBNUB.rdx=function(e,t){return t?(h[e].responseText=unescape(t),void h[e].onload()):h[e].onerror()},h.id=SECOND)}(),function(){var e=PUBNUB.ws=function(t,n){if(!(this instanceof e))return new e(t,n);var r=this,t=r.url=t||"",o=(r.protocol=n||"Sec-WebSocket-Protocol",t.split("/")),i={ssl:"wss:"===o[0],origin:o[2],publish_key:o[3],subscribe_key:o[4],channel:o[5]};return r.CONNECTING=0,r.OPEN=1,r.CLOSING=2,r.CLOSED=3,r.CLOSE_NORMAL=1e3,r.CLOSE_GOING_AWAY=1001,r.CLOSE_PROTOCOL_ERROR=1002,r.CLOSE_UNSUPPORTED=1003,r.CLOSE_TOO_LARGE=1004,r.CLOSE_NO_STATUS=1005,r.CLOSE_ABNORMAL=1006,r.onclose=r.onerror=r.onmessage=r.onopen=r.onsend=function(){},r.binaryType="",r.extensions="",r.bufferedAmount=0,r.trasnmitting=!1,r.buffer=[],r.readyState=r.CONNECTING,t?(r.pubnub=PUBNUB.init(i),r.pubnub.setup=i,r.setup=i,void r.pubnub.subscribe({restore:!1,channel:i.channel,disconnect:r.onerror,reconnect:r.onopen,error:function(){r.onclose({code:r.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!1})},callback:function(e){r.onmessage({data:e})},connect:function(){r.readyState=r.OPEN,r.onopen()}})):(r.readyState=r.CLOSED,r.onclose({code:r.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!0}),r)};e.prototype.send=function(e){var t=this;t.pubnub.publish({channel:t.pubnub.setup.channel,message:e,callback:function(e){t.onsend({data:e})}})},e.prototype.close=function(){var e=this;e.pubnub.unsubscribe({channel:e.pubnub.setup.channel}),e.readyState=e.CLOSED,e.onclose({})}}();var CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},o=function(){},i=r.Base={extend:function(e){o.prototype=this;var t=new o;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=r.WordArray=i.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var o=0;e>o;o++)t[r+o>>>2]|=(n[o>>>2]>>>24-8*(o%4)&255)<<24-8*((r+o)%4);else if(65535<n.length)for(o=0;e>o;o+=4)t[r+o>>>2]=n[o>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;t>r;r+=4)n.push(4294967296*e.random()|0);return new s.init(n,t)}}),a=n.enc={},u=a.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;e>r;r++){var o=t[r>>>2]>>>24-8*(r%4)&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;t>r;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new s.init(n,t/2)}},c=a.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;e>r;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;t>r;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-8*(r%4);return new s.init(n,t)}},p=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},l=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,o=n.sigBytes,i=this.blockSize,a=o/(4*i),a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0);if(t=a*i,o=e.min(4*t,o),t){for(var u=0;t>u;u+=i)this._doProcessBlock(r,u);u=r.splice(0,t),n.sigBytes-=o}return new s.init(u,o)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}});var f=n.algo={};return n}(Math);!function(e){for(var t=CryptoJS,n=t.lib,r=n.WordArray,o=n.Hasher,n=t.algo,i=[],s=[],a=function(e){return 4294967296*(e-(0|e))|0},u=2,c=0;64>c;){var p;e:{p=u;for(var l=e.sqrt(p),f=2;l>=f;f++)if(!(p%f)){p=!1;break e}p=!0}p&&(8>c&&(i[c]=a(e.pow(u,.5))),s[c]=a(e.pow(u,1/3)),c++),u++}var h=[],n=n.SHA256=o.extend({_doReset:function(){this._hash=new r.init(i.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],a=n[3],u=n[4],c=n[5],p=n[6],l=n[7],f=0;64>f;f++){if(16>f)h[f]=0|e[t+f];else{var d=h[f-15],_=h[f-2];h[f]=((d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3)+h[f-7]+((_<<15|_>>>17)^(_<<13|_>>>19)^_>>>10)+h[f-16]}d=l+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&c^~u&p)+s[f]+h[f],_=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&o^r&i^o&i),l=p,p=c,c=u,u=a+d|0,a=i,i=o,o=r,r=d+_|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+a|0,n[4]=n[4]+u|0,n[5]=n[5]+c|0,n[6]=n[6]+p|0,n[7]=n[7]+l|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;return n[o>>>5]|=128<<24-o%32,n[(o+64>>>9<<4)+14]=e.floor(r/4294967296),n[(o+64>>>9<<4)+15]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(n),t.HmacSHA256=o._createHmacHelper(n)}(Math),function(){var e=CryptoJS,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,n){e=this._hasher=new e.init,"string"==typeof n&&(n=t.parse(n));var r=e.blockSize,o=4*r;n.sigBytes>o&&(n=e.finalize(n)),n.clamp();for(var i=this._oKey=n.clone(),s=this._iKey=n.clone(),a=i.words,u=s.words,c=0;r>c;c++)a[c]^=1549556828,u[c]^=909522486;i.sigBytes=s.sigBytes=o,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),function(){var e=CryptoJS,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp(),e=[];for(var o=0;n>o;o+=3)for(var i=(t[o>>>2]>>>24-8*(o%4)&255)<<16|(t[o+1>>>2]>>>24-8*((o+1)%4)&255)<<8|t[o+2>>>2]>>>24-8*((o+2)%4)&255,s=0;4>s&&n>o+.75*s;s++)e.push(r.charAt(i>>>6*(3-s)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var n=e.length,r=this._map,o=r.charAt(64);o&&(o=e.indexOf(o),-1!=o&&(n=o));for(var o=[],i=0,s=0;n>s;s++)if(s%4){var a=r.indexOf(e.charAt(s-1))<<2*(s%4),u=r.indexOf(e.charAt(s))>>>6-2*(s%4);o[i>>>2]|=(a|u)<<24-8*(i%4),i++}return t.create(o,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,n,r,o,i,s){return e=e+(t&n|~t&r)+o+s,(e<<i|e>>>32-i)+t}function n(e,t,n,r,o,i,s){return e=e+(t&r|n&~r)+o+s,(e<<i|e>>>32-i)+t}function r(e,t,n,r,o,i,s){return e=e+(t^n^r)+o+s,(e<<i|e>>>32-i)+t}function o(e,t,n,r,o,i,s){return e=e+(n^(t|~r))+o+s,(e<<i|e>>>32-i)+t}for(var i=CryptoJS,s=i.lib,a=s.WordArray,u=s.Hasher,s=i.algo,c=[],p=0;64>p;p++)c[p]=4294967296*e.abs(e.sin(p+1))|0;s=s.MD5=u.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,i){for(var s=0;16>s;s++){var a=i+s,u=e[a];e[a]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}var s=this._hash.words,a=e[i+0],u=e[i+1],p=e[i+2],l=e[i+3],f=e[i+4],h=e[i+5],d=e[i+6],_=e[i+7],y=e[i+8],g=e[i+9],b=e[i+10],m=e[i+11],v=e[i+12],k=e[i+13],w=e[i+14],E=e[i+15],S=s[0],x=s[1],C=s[2],R=s[3],S=t(S,x,C,R,a,7,c[0]),R=t(R,S,x,C,u,12,c[1]),C=t(C,R,S,x,p,17,c[2]),x=t(x,C,R,S,l,22,c[3]),S=t(S,x,C,R,f,7,c[4]),R=t(R,S,x,C,h,12,c[5]),C=t(C,R,S,x,d,17,c[6]),x=t(x,C,R,S,_,22,c[7]),S=t(S,x,C,R,y,7,c[8]),R=t(R,S,x,C,g,12,c[9]),C=t(C,R,S,x,b,17,c[10]),x=t(x,C,R,S,m,22,c[11]),S=t(S,x,C,R,v,7,c[12]),R=t(R,S,x,C,k,12,c[13]),C=t(C,R,S,x,w,17,c[14]),x=t(x,C,R,S,E,22,c[15]),S=n(S,x,C,R,u,5,c[16]),R=n(R,S,x,C,d,9,c[17]),C=n(C,R,S,x,m,14,c[18]),x=n(x,C,R,S,a,20,c[19]),S=n(S,x,C,R,h,5,c[20]),R=n(R,S,x,C,b,9,c[21]),C=n(C,R,S,x,E,14,c[22]),x=n(x,C,R,S,f,20,c[23]),S=n(S,x,C,R,g,5,c[24]),R=n(R,S,x,C,w,9,c[25]),C=n(C,R,S,x,l,14,c[26]),x=n(x,C,R,S,y,20,c[27]),S=n(S,x,C,R,k,5,c[28]),R=n(R,S,x,C,p,9,c[29]),C=n(C,R,S,x,_,14,c[30]),x=n(x,C,R,S,v,20,c[31]),S=r(S,x,C,R,h,4,c[32]),R=r(R,S,x,C,y,11,c[33]),C=r(C,R,S,x,m,16,c[34]),x=r(x,C,R,S,w,23,c[35]),S=r(S,x,C,R,u,4,c[36]),R=r(R,S,x,C,f,11,c[37]),C=r(C,R,S,x,_,16,c[38]),x=r(x,C,R,S,b,23,c[39]),S=r(S,x,C,R,k,4,c[40]),R=r(R,S,x,C,a,11,c[41]),C=r(C,R,S,x,l,16,c[42]),x=r(x,C,R,S,d,23,c[43]),S=r(S,x,C,R,g,4,c[44]),R=r(R,S,x,C,v,11,c[45]),C=r(C,R,S,x,E,16,c[46]),x=r(x,C,R,S,p,23,c[47]),S=o(S,x,C,R,a,6,c[48]),R=o(R,S,x,C,_,10,c[49]),C=o(C,R,S,x,w,15,c[50]),x=o(x,C,R,S,h,21,c[51]),S=o(S,x,C,R,v,6,c[52]),R=o(R,S,x,C,l,10,c[53]),C=o(C,R,S,x,b,15,c[54]),x=o(x,C,R,S,u,21,c[55]),S=o(S,x,C,R,y,6,c[56]),R=o(R,S,x,C,E,10,c[57]),C=o(C,R,S,x,d,15,c[58]),x=o(x,C,R,S,k,21,c[59]),S=o(S,x,C,R,f,6,c[60]),R=o(R,S,x,C,m,10,c[61]),C=o(C,R,S,x,p,15,c[62]),x=o(x,C,R,S,g,21,c[63]);s[0]=s[0]+S|0,s[1]=s[1]+x|0,s[2]=s[2]+C|0,s[3]=s[3]+R|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;n[o>>>5]|=128<<24-o%32;var i=e.floor(r/4294967296);for(n[(o+64>>>9<<4)+15]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[(o+64>>>9<<4)+14]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process(),t=this._hash,n=t.words,r=0;4>r;r++)o=n[r],n[r]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8);return t},clone:function(){var e=u.clone.call(this);return e._hash=this._hash.clone(),e}}),i.MD5=u._createHelper(s),i.HmacMD5=u._createHmacHelper(s)}(Math),function(){var e=CryptoJS,t=e.lib,n=t.Base,r=t.WordArray,t=e.algo,o=t.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,o=n.hasher.create(),i=r.create(),s=i.words,a=n.keySize,n=n.iterations;s.length<a;){u&&o.update(u);var u=o.update(e).finalize(t);o.reset();for(var c=1;n>c;c++)u=o.finalize(u),o.reset();i.concat(u)}return i.sigBytes=4*a,i}});e.EvpKDF=function(e,t,n){return o.create(n).compute(e,t)}}(),CryptoJS.lib.Cipher||function(e){var t=CryptoJS,n=t.lib,r=n.Base,o=n.WordArray,i=n.BufferedBlockAlgorithm,s=t.enc.Base64,a=t.algo.EvpKDF,u=n.Cipher=i.extend({cfg:r.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,r){return("string"==typeof n?d:h).encrypt(e,t,n,r)},decrypt:function(t,n,r){return("string"==typeof n?d:h).decrypt(e,t,n,r)}}}});n.StreamCipher=u.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=t.mode={},p=function(t,n,r){var o=this._iv;o?this._iv=e:o=this._prevBlock;for(var i=0;r>i;i++)t[n+i]^=o[i]},l=(n.BlockCipherMode=r.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();l.Encryptor=l.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;p.call(this,e,t,r),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),l.Decryptor=l.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,o=e.slice(t,t+r);n.decryptBlock(e,t),p.call(this,e,t,r),this._prevBlock=o}}),c=c.CBC=l,l=(t.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,n=n-e.sigBytes%n,r=n<<24|n<<16|n<<8|n,i=[],s=0;n>s;s+=4)i.push(r);n=o.create(i,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},n.BlockCipher=u.extend({cfg:u.cfg.extend({mode:c,padding:l}),reset:function(){u.reset.call(this);var e=this.cfg,t=e.iv,e=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=e.createEncryptor;else n=e.createDecryptor,this._minBufferSize=1;this._mode=n.call(e,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var f=n.CipherParams=r.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),c=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return e=e.salt,(e?o.create([1398893684,1701076831]).concat(e).concat(t):t).toString(s)},parse:function(e){e=s.parse(e);var t=e.words;if(1398893684==t[0]&&1701076831==t[1]){var n=o.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return f.create({ciphertext:e,salt:n})}},h=n.SerializableCipher=r.extend({cfg:r.extend({format:c}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var o=e.createEncryptor(n,r);return t=o.finalize(t),o=o.cfg,f.create({ciphertext:t,key:n,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),t=(t.kdf={}).OpenSSL={execute:function(e,t,n,r){return r||(r=o.random(8)),e=a.create({keySize:t+n}).compute(e,r),n=o.create(e.words.slice(t),4*n),e.sigBytes=4*t,f.create({key:e,iv:n,salt:r})}},d=n.PasswordBasedCipher=h.extend({cfg:h.cfg.extend({kdf:t}),encrypt:function(e,t,n,r){return r=this.cfg.extend(r),n=r.kdf.execute(n,e.keySize,e.ivSize),r.iv=n.iv,e=h.encrypt.call(this,e,t,n.key,r),e.mixIn(n),e},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt),r.iv=n.iv,h.decrypt.call(this,e,t,n.key,r)}})}(),function(){for(var e=CryptoJS,t=e.lib.BlockCipher,n=e.algo,r=[],o=[],i=[],s=[],a=[],u=[],c=[],p=[],l=[],f=[],h=[],d=0;256>d;d++)h[d]=128>d?d<<1:d<<1^283;for(var _=0,y=0,d=0;256>d;d++){var g=y^y<<1^y<<2^y<<3^y<<4,g=g>>>8^255&g^99;r[_]=g,o[g]=_;var b=h[_],m=h[b],v=h[m],k=257*h[g]^16843008*g;i[_]=k<<24|k>>>8,s[_]=k<<16|k>>>16,a[_]=k<<8|k>>>24,u[_]=k,k=16843009*v^65537*m^257*b^16843008*_,c[g]=k<<24|k>>>8,p[g]=k<<16|k>>>16,l[g]=k<<8|k>>>24,f[g]=k,_?(_=b^h[h[h[v^b]]],y^=h[h[y]]):_=y=1}var w=[0,1,2,4,8,16,32,64,128,27,54],n=n.AES=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes/4,e=4*((this._nRounds=n+6)+1),o=this._keySchedule=[],i=0;e>i;i++)if(n>i)o[i]=t[i];else{var s=o[i-1];i%n?n>6&&4==i%n&&(s=r[s>>>24]<<24|r[s>>>16&255]<<16|r[s>>>8&255]<<8|r[255&s]):(s=s<<8|s>>>24,s=r[s>>>24]<<24|r[s>>>16&255]<<16|r[s>>>8&255]<<8|r[255&s],s^=w[i/n|0]<<24),o[i]=o[i-n]^s}for(t=this._invKeySchedule=[],n=0;e>n;n++)i=e-n,s=n%4?o[i]:o[i-4],t[n]=4>n||4>=i?s:c[r[s>>>24]]^p[r[s>>>16&255]]^l[r[s>>>8&255]]^f[r[255&s]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,i,s,a,u,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,c,p,l,f,o),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,o,i,s,a){for(var u=this._nRounds,c=e[t]^n[0],p=e[t+1]^n[1],l=e[t+2]^n[2],f=e[t+3]^n[3],h=4,d=1;u>d;d++)var _=r[c>>>24]^o[p>>>16&255]^i[l>>>8&255]^s[255&f]^n[h++],y=r[p>>>24]^o[l>>>16&255]^i[f>>>8&255]^s[255&c]^n[h++],g=r[l>>>24]^o[f>>>16&255]^i[c>>>8&255]^s[255&p]^n[h++],f=r[f>>>24]^o[c>>>16&255]^i[p>>>8&255]^s[255&l]^n[h++],c=_,p=y,l=g;_=(a[c>>>24]<<24|a[p>>>16&255]<<16|a[l>>>8&255]<<8|a[255&f])^n[h++],y=(a[p>>>24]<<24|a[l>>>16&255]<<16|a[f>>>8&255]<<8|a[255&c])^n[h++],g=(a[l>>>24]<<24|a[f>>>16&255]<<16|a[c>>>8&255]<<8|a[255&p])^n[h++],f=(a[f>>>24]<<24|a[c>>>16&255]<<16|a[p>>>8&255]<<8|a[255&l])^n[h++],e[t]=_,e[t+1]=y,e[t+2]=g,e[t+3]=f},keySize:8});e.AES=t._createHelper(n)}(),CryptoJS.mode.ECB=function(){var e=CryptoJS.lib.BlockCipherMode.extend();return e.Encryptor=e.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),e.Decryptor=e.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),e}();
//# sourceMappingURL=ringcentral-bundle.min.js.map